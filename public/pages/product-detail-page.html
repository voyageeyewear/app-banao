<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoEye Store</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fff;
            overflow: hidden;
        }

        /* Product Detail Page Styles */
        .product-detail-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 1000;
            overflow: hidden;
        }
        
        .product-detail-container {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
            padding-top: 25px;
        }
        
        /* Top Navigation */
        .product-top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            height: 52px;
        }
        
        .nav-button {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            text-decoration: none;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .nav-button:active {
            transform: scale(0.95);
        }
        
        .nav-button svg {
            width: 22px;
            height: 22px;
            color: #1B224B;
            stroke-width: 2.5;
        }
        
        .product-title-header {
            color: #1B224B;
            font-size: 16px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            margin-right: auto;
            max-width: calc(100% - 200px);
            overflow: hidden;
            text-overflow: ellipsis;
            margin-left: 12px;
        }
        
        .nav-right {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            align-items: center;
        }
        
        .cart-button {
            position: relative;
        }
        
        .cart-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #E73C17;
            color: white;
            font-size: 12px;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            line-height: 1;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .cart-count:empty {
            display: none;
        }
        
        /* Product Media */
        .product-media {
            width: 100%;
            padding-top: 52px;
            position: relative;
            flex: 0 0 auto;
            margin-top: 0;
        }
        
        .product-image-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            background: #ffffff;
            border-radius: 0;
        }
        
        .product-image-slider {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .product-main-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .product-main-image.active {
            opacity: 1;
        }
        
        /* Rating Overlay */
        .rating-overlay-widget {
            position: absolute;
            right: 16px;
            bottom: 16px;
            z-index: 6;
            pointer-events: none;
        }
        
        .rating-overlay-content {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            border-radius: 16px;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 2px;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .rating-value {
            color: #333;
            font-size: 14px;
            font-weight: 600;
        }
        
        .rating-star {
            color: #22C55E;
            font-size: 14px;
            margin: 0 1px;
        }
        
        .rating-count {
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* New Launch Badge */
        .new-launch-badge {
            position: absolute;
            top: 60px;
            left: 10px;
            background: #E73C17;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 5;
        }
        
        /* Image Pagination */
        .image-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px 0;
            gap: 6px;
        }
        
        .pagination-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #D8D8D8;
            display: inline-block;
            transition: background 0.2s ease;
            cursor: pointer;
            padding: 4px;
        }
        
        .pagination-dot:hover {
            background: #999;
        }
        
        .pagination-dot.active {
            background: #1B224B;
        }
        
        /* Product Info */
        .product-info {
            height: auto;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 16px;
            background: #fff;
        }
        
        .product-info__content {
            padding: 0;
            margin: 0;
        }
        
        .product-title {
            font-size: 20px;
            line-height: 1.2;
            color: #1B224B;
            margin: 0 0 8px 0;
            padding: 0;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .product-title h1 {
            margin: 0;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            flex: 1;
        }
        
        .wishlist-button {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .wishlist-button:active {
            transform: scale(0.9);
        }
        
        .heart-icon {
            width: 24px;
            height: 24px;
            color: #1B224B;
            transition: fill 0.2s ease;
        }
        
        .wishlist-button.active .heart-icon {
            fill: #E73C17;
            color: #E73C17;
        }
        
        .product-subtitle {
            color: #666;
            font-size: 13px;
            margin: 0 0 4px 0;
            font-weight: 400;
        }
        
        .product-feature {
            color: #2E8B57;
            font-size: 13px;
            margin: 0 0 12px 0;
            font-weight: 500;
        }
        
        .product-rating-block {
            margin: 12px 0;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            color: #333368;
        }
        
        .rating-stars {
            color: #ffc107;
            font-size: 14px;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 12px 0;
        }
        
        .price-current {
            font-size: 20px;
            font-weight: 600;
            color: #1B224B;
        }
        
        .price-original {
            text-decoration: line-through;
            color: #666;
            font-size: 13px;
        }
        
        .price-discount {
            color: #E73C17;
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Product Actions */
        .product-actions {
            display: flex;
            gap: 6px;
            padding: 0;
            margin: 16px 0 24px 0;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px 8px;
            border: 1px solid #E8E8E8;
            border-radius: 12px;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:active {
            transform: scale(0.95);
            background: #f5f5f5;
        }
        
        .action-btn svg {
            width: 24px;
            height: 24px;
            color: #1B224B;
        }
        
        .action-btn span {
            font-size: 12px;
            color: #1B224B;
            font-weight: 500;
            text-align: center;
        }
        
        /* Bottom Purchase Section */
        .buy-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            padding: 0;
            background: transparent;
            z-index: 999;
            pointer-events: auto;
            transform: translateZ(0);
            will-change: transform;
            max-height: 140px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
        }
        
        .promo-banner {
            background: #1B224B;
            color: #fff;
            text-align: center;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 12px 12px 0 0;
        }
        
        .price-container {
            background: #fff;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding-bottom: env(safe-area-inset-bottom, 0);
        }
        
        .product-price-info {
            padding: 8px 12px 4px;
            display: flex;
            flex-wrap: wrap;
            align-items: baseline;
            gap: 6px;
        }
        
        .main-price {
            font-size: 22px;
            font-weight: 600;
            color: #1B224B;
        }
        
        .price-details {
            display: flex;
            gap: 8px;
        }
        
        .original-price {
            font-size: 13px;
            color: #666;
            text-decoration: line-through;
        }
        
        .discount-percent {
            font-size: 13px;
            color: #4CAF50;
            font-weight: 500;
        }
        
        .tax-info {
            font-size: 11px;
            color: #666;
            margin-left: auto;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            padding: 8px 12px 12px;
        }
        
        .buy-now,
        .add-to-cart {
            flex: 1;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .buy-now {
            background: #1B224B;
            color: white;
        }
        
        .buy-now:active {
            transform: scale(0.95);
        }
        
        .add-to-cart {
            background: #000;
            color: white;
        }
        
        .add-to-cart .button-text,
        .add-to-cart .success-text {
            display: inline-block;
            transition: opacity 0.3s ease;
        }
        
        .add-to-cart.success .button-text {
            opacity: 0;
            visibility: hidden;
            position: absolute;
        }
        
        .add-to-cart.success .success-text {
            opacity: 1;
            visibility: visible;
        }
        
        .add-to-cart.success {
            background: #22C55E;
            animation: successPulse 0.3s ease;
        }
        
        .add-to-cart.loading,
        .buy-now.loading {
            opacity: 0.7;
            cursor: not-allowed;
            position: relative;
        }
        
        .buy-now.loading::after {
            content: '';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: translateY(-50%) rotate(360deg); }
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* WhatsApp Chat Button */
        .whatsapp-chat {
            position: fixed;
            bottom: 160px;
            right: 20px;
            background: #25D366;
            color: white;
            padding: 8px 16px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
            cursor: pointer;
            transition: transform 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .whatsapp-chat:active {
            transform: scale(0.95);
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #fff;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1B224B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Mobile Responsive */
        @media (max-width: 767px) {
            .nav-button {
                width: 36px;
                height: 36px;
            }
            
            .nav-button svg {
                width: 20px;
                height: 20px;
            }
            
            .product-title-header {
                font-size: 15px;
            }
            
            .product-media {
                padding-top: 48px;
            }
            
            .product-image-container {
                height: 350px;
            }
            
            .rating-overlay-widget {
                right: 12px;
                bottom: 12px;
            }
            
            .rating-overlay-content {
                padding: 4px 8px;
            }
            
            .rating-value,
            .rating-star,
            .rating-count {
                font-size: 13px;
            }
            
            .whatsapp-chat {
                bottom: 140px;
                right: 16px;
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .action-btn {
                padding: 10px 6px;
            }
            
            .action-btn span {
                font-size: 11px;
            }
        }
        
        /* Scroll behavior */
        .product-detail-container {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <!-- Loading State -->
    <div id="loadingState" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- Product Detail Page -->
    <div id="productDetailPage" class="product-detail-page" style="display: none;">
        <!-- Content will be dynamically generated -->
    </div>

    <script>
        // API Configuration - Smart URL detection
                const API_BASE = window.location.protocol === 'file:'
            ? 'https://app-banao-2jaq7x5ik-voyageeyewears-projects.vercel.app'  // Your live Vercel deployment
            : window.location.origin;
        
        // Global variables
        let productData = {};
        let cart = [];
        let pdpConfig = {};

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProductData();
        });

        // Load product data and PDP configuration
        async function loadProductData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const productHandle = urlParams.get('handle') || 'default';
                
                console.log('ðŸ” Loading product data for:', productHandle);
                
                // Always try to load from API first (like original behavior)
                try {
                    console.log('ðŸŒ Making API calls to:', API_BASE);
                    
                    const [pdpResponse, productResponse] = await Promise.all([
                        fetch(`${API_BASE}/api/pdp-config`),
                        fetch(`${API_BASE}/api/product-detail?handle=${productHandle}`)
                    ]);

                    console.log('ðŸ“¡ API responses:', {
                        pdpStatus: pdpResponse.status,
                        productStatus: productResponse.status
                    });

                    // Load PDP configuration
                    if (pdpResponse.ok) {
                        pdpConfig = await pdpResponse.json();
                        console.log('âœ… PDP config loaded from API');
                    } else {
                        pdpConfig = getDefaultPDPConfig();
                        console.log('ðŸ“‹ Using default PDP config, response status:', pdpResponse.status);
                    }

                    // Load product data
                    if (productResponse.ok) {
                        const productApiData = await productResponse.json();
                        console.log('ðŸ“¦ Raw API response:', productApiData);
                        
                        if (productApiData.success && productApiData.product) {
                            productData = productApiData.product;
                            console.log('âœ… Product data loaded from API:', productData.title);
                            console.log('ðŸ–¼ï¸ Product images from API:', productData.images);
                            console.log('ðŸŽ¯ Using REAL product data - not calling tryGetAnyProduct()');
                        } else {
                            console.warn('âš ï¸ API returned success=false or no product:', productApiData);
                            // Try to get any available product instead of falling back to fake data
                            productData = await tryGetAnyProduct();
                        }
                    } else {
                        console.warn('âŒ Product API failed with status:', productResponse.status);
                        const responseText = await productResponse.text();
                        console.log('ðŸ“„ Response body:', responseText);
                        // Try to get any available product instead of falling back to fake data
                        productData = await tryGetAnyProduct();
                    }
                } catch (apiError) {
                    console.warn('âš ï¸ API requests failed:', apiError);
                    pdpConfig = getDefaultPDPConfig();
                    // Try to get any real product instead of fake data
                    console.log('âš ï¸ Falling back to tryGetAnyProduct due to API error');
                    productData = await tryGetAnyProduct();
                }

                console.log('âœ… Data loaded:', { productData: productData.title, pdpConfig });
                createProductDetailPage(productData);
                
            } catch (error) {
                console.error('âŒ Error loading data:', error);
                // Use fallback data
                pdpConfig = getDefaultPDPConfig();
                productData = await tryGetAnyProduct();
                createProductDetailPage(productData);
            }
        }

        // Default PDP configuration
        function getDefaultPDPConfig() {
            return {
                subtitleText: "Premium Eyewear Collection",
                featureText: "Anti-reflective coating & UV protection",
                promoBannerText: "ðŸšš Free Shipping | ðŸ’³ Easy Returns | ðŸ”’ Secure Checkout",
                whatsappNumber: "+919999999999",
                taxText: "incl. of taxes",
                showNewBadge: true,
                showWhatsAppChat: true,
                actionButtons: {
                    sizeGuide: "Size Guide",
                    tryOn: "Try On", 
                    reviews: "Reviews"
                }
            };
        }

        // Default product data
        function getDefaultProductData() {
            return {
                title: "Eyejack Black Square Polarized Sunglasses for Men & Women",
                price: "â‚¹799",
                originalPrice: "â‚¹1039",
                discount: "23",
                rating: "4.5",
                ratingCount: "260",
                image: "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop&q=80",
                images: [
                    "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop&q=80",
                    "https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=400&fit=crop&q=80",
                    "https://images.unsplash.com/photo-1556306535-38febf6782e7?w=400&h=400&fit=crop&q=80",
                    "https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=400&h=400&fit=crop&q=80"
                ],
                handle: "eyejack-black-square-polarized-sunglasses",
                id: "gid://shopify/Product/123456789",
                isNew: true
            };
        }

        // Try to get any available product from Shopify instead of using fake data
        async function tryGetAnyProduct() {
            try {
                console.log('ðŸ”„ Trying to get any available product from store...');
                
                // Try to get a known real product directly
                const knownProduct = 'eyejack-black-square-polarized-sunglasses-for-men-women-1905pcl2075';
                console.log('ðŸŽ¯ Trying known real product:', knownProduct);
                const response = await fetch(`${API_BASE}/api/product-detail?handle=${knownProduct}`);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ðŸ“¦ Known product API response:', data);
                    if (data.success && data.product) {
                        console.log('âœ… Got real product with images:', data.product.title);
                        console.log('ðŸ–¼ï¸ Real product images:', data.product.images);
                        return data.product;
                    }
                }
                
                // If that fails, try getting available products list
                console.log('ðŸ” Trying to get available products list...');
                const listResponse = await fetch(`${API_BASE}/api/product-detail`);
                if (listResponse.ok) {
                    const listData = await listResponse.json();
                    console.log('ðŸ“‹ Available products response:', listData);
                    if (listData.availableProducts && listData.availableProducts.length > 0) {
                        const firstProduct = listData.availableProducts[0];
                        console.log('âœ… Using first available product:', firstProduct.handle);
                        
                        // Try to load that specific product
                        const specificResponse = await fetch(`${API_BASE}/api/product-detail?handle=${firstProduct.handle}`);
                        if (specificResponse.ok) {
                            const specificData = await specificResponse.json();
                            if (specificData.success && specificData.product) {
                                console.log('âœ… Got specific product with images:', specificData.product.images);
                                return specificData.product;
                            }
                        }
                    }
                }
                
                console.warn('âš ï¸ Could not get any real product, using fallback');
                return getDefaultProductData();
                
            } catch (error) {
                console.error('âŒ Error trying to get real product:', error);
                return getDefaultProductData();
            }
        }

        // Format product handle into readable title
        function formatProductTitle(handle) {
            if (!handle || handle === 'default') {
                return "Eyejack Black Square Polarized Sunglasses for Men & Women";
            }
            
            // Convert handle to title format
            return handle
                .split('-')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Create Product Detail Page
        function createProductDetailPage(product) {
            const productDetailPage = document.getElementById('productDetailPage');
            productDetailPage.innerHTML = generateProductDetailHTML(product);
            
            // Hide loading, show content
            document.getElementById('loadingState').style.display = 'none';
            productDetailPage.style.display = 'block';
            
            // Initialize functionality
            initializeProductDetailPage(product);
            
            // Initialize image slider after DOM is ready
            setTimeout(() => {
                initializeImageSlider();
            }, 100);
        }

        // Generate Product Detail HTML
        function generateProductDetailHTML(product) {
            const rating = product.rating || 4.5;
            const ratingCount = product.ratingCount || Math.floor(Math.random() * 500) + 100;
            const originalPrice = product.originalPrice || (parseFloat(product.price.replace(/[^\d.]/g, '')) * 1.3).toFixed(0);
            const discount = product.discount || Math.floor(((originalPrice - parseFloat(product.price.replace(/[^\d.]/g, ''))) / originalPrice) * 100);
            
            return `
                <!-- Product Detail Page Container -->
                <div class="product-detail-container">
                    <!-- Top Navigation -->
                    <div class="product-top-nav">
                        <button class="nav-button back-button" onclick="goBack()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        
                        <div class="product-title-header" id="product-nav-title">
                            ${product.title}
                        </div>
                        
                        <div class="nav-right">
                            <button class="nav-button share-button" onclick="shareProduct('${product.handle}')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                            </button>
                            
                            <button class="nav-button cart-button" onclick="showCartPage()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="9" cy="21" r="1"></circle>
                                    <circle cx="20" cy="21" r="1"></circle>
                                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                </svg>
                                <span class="cart-count" id="product-cart-count">${cart.length || ''}</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Product Media -->
                    <div class="product-media">
                        <div class="product-image-container" id="product-image-container">
                            <div class="product-image-slider" id="product-image-slider">
                                ${(product.images && product.images.length > 0 ? product.images : [product.image]).map((imageUrl, index) => `
                                    <img src="${imageUrl}" alt="${product.title}" class="product-main-image ${index === 0 ? 'active' : ''}" data-index="${index}">
                                `).join('')}
                            </div>
                            
                            <!-- Rating Overlay -->
                            <div class="rating-overlay-widget">
                                <div class="rating-overlay-content">
                                    <span class="rating-value">${rating}</span>
                                    <span class="rating-star">â˜…</span>
                                    <span class="rating-count">(${ratingCount})</span>
                                </div>
                            </div>
                            
                            <!-- New Launch Badge (conditional) -->
                            ${pdpConfig.showNewBadge && product.isNew ? '<div class="new-launch-badge">NEW LAUNCH</div>' : ''}
                        </div>
                        
                        <!-- Image Pagination Dots -->
                        <div class="image-pagination" id="image-pagination">
                            ${(product.images && product.images.length > 0 ? product.images : [product.image]).map((_, index) => `
                                <span class="pagination-dot ${index === 0 ? 'active' : ''}" data-index="${index}" onclick="showImage(${index})"></span>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Product Info -->
                    <div class="product-info">
                        <div class="product-info__content">
                            <!-- Product Title & Wishlist -->
                            <div class="product-title">
                                <h1>${product.title}</h1>
                                <button class="wishlist-button" onclick="toggleWishlist('${product.handle}')">
                                    <svg class="heart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Product Subtitle -->
                            <p class="product-subtitle">${pdpConfig.subtitleText || 'Premium Eyewear Collection'}</p>
                            
                            <!-- Product Features -->
                            <p class="product-feature">âœ“ ${pdpConfig.featureText || 'Anti-reflective coating & UV protection'}</p>
                            
                            <!-- Rating Display -->
                            <div class="product-rating-block">
                                <div class="product-rating">
                                    <span class="rating-stars">â˜…â˜…â˜…â˜…â˜…</span>
                                    <span class="rating-value">${rating}</span>
                                    <span class="rating-count">(${ratingCount} reviews)</span>
                                </div>
                            </div>
                            
                            <!-- Price Section -->
                            <div class="product-price">
                                <span class="price-current">${product.price}</span>
                                ${originalPrice ? `<span class="price-original">â‚¹${originalPrice}</span>` : ''}
                                ${discount ? `<span class="price-discount">${discount}% OFF</span>` : ''}
                            </div>
                            
                            <!-- Product Actions -->
                            <div class="product-actions">
                                <button class="action-btn" onclick="viewSizeGuide()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                    </svg>
                                    <span>${pdpConfig.actionButtons?.sizeGuide || 'Size Guide'}</span>
                                </button>
                                
                                <button class="action-btn" onclick="tryVirtual('${product.handle}')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                    </svg>
                                    <span>${pdpConfig.actionButtons?.tryOn || 'Try On'}</span>
                                </button>
                                
                                <button class="action-btn" onclick="viewReviews()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                                    </svg>
                                    <span>${pdpConfig.actionButtons?.reviews || 'Reviews'}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bottom Purchase Section -->
                    <div class="buy-buttons">
                        <!-- Promo Banner -->
                        <div class="promo-banner">
                            ${pdpConfig.promoBannerText || 'ðŸšš Free Shipping | ðŸ’³ Easy Returns | ðŸ”’ Secure Checkout'}
                        </div>
                        
                        <!-- Price & Action Buttons -->
                        <div class="price-container">
                            <div class="product-price-info">
                                <span class="main-price">${product.price}</span>
                                <div class="price-details">
                                    ${originalPrice ? `<span class="original-price">â‚¹${originalPrice}</span>` : ''}
                                    ${discount ? `<span class="discount-percent">${discount}% OFF</span>` : ''}
                                </div>
                                <span class="tax-info">${pdpConfig.taxText || 'incl. of taxes'}</span>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="add-to-cart" onclick="addProductToCart('${product.handle}', '${product.id}', '${product.title}', '${product.price}', '${product.image}')">
                                    <span class="button-text">Add to Cart</span>
                                    <span class="success-text">Added âœ“</span>
                                </button>
                                
                                <button class="buy-now" onclick="buyProductNow('${product.handle}', '${product.id}', '${product.title}', '${product.price}', '${product.image}')">
                                    Buy Now
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- WhatsApp Chat Button -->
                    ${pdpConfig.showWhatsAppChat ? `
                    <div class="whatsapp-chat" onclick="openWhatsAppChat()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                        </svg>
                        Chat with us
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Initialize Product Detail Page functionality
        function initializeProductDetailPage(product) {
            // Setup scroll behavior for title header
            setupProductScrollBehavior();
            
            // Load cart data
            loadCart();
            
            // Update cart count display
            updateCartCount();
            
            // Initialize wishlist state
            updateWishlistState(product.handle);
        }

        // Setup scroll behavior for product page
        function setupProductScrollBehavior() {
            const productContainer = document.querySelector('.product-detail-container');
            const titleHeader = document.getElementById('product-nav-title');
            
            if (productContainer && titleHeader) {
                productContainer.addEventListener('scroll', function() {
                    if (this.scrollTop > 100) {
                        titleHeader.style.opacity = '1';
                        titleHeader.style.visibility = 'visible';
                    } else {
                        titleHeader.style.opacity = '0';
                        titleHeader.style.visibility = 'hidden';
                    }
                });
            }
        }

        // Navigation functions
        function goBack() {
            console.log('ðŸ”™ Going back from product page');
            
            // Clean up image slider
            stopAutoSlide();
            
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({ action: 'goBack' }, '*');
            } else {
                history.back();
            }
        }

        function shareProduct(handle) {
            console.log('ðŸ”— Sharing product:', handle);
            
            if (navigator.share) {
                navigator.share({
                    title: productData.title,
                    text: `Check out this amazing product: ${productData.title}`,
                    url: window.location.href
                });
            } else {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(window.location.href);
                showToast('ðŸ”— Product link copied!');
            }
        }

        function showCartPage() {
            console.log('ðŸ›’ Showing cart page');
            showToast('ðŸ›’ Cart feature integration ready');
        }

        // Cart functions
        function loadCart() {
            try {
                cart = JSON.parse(localStorage.getItem('goeye-cart')) || [];
            } catch (e) {
                cart = [];
            }
        }

        function updateCartCount() {
            const cartCountElement = document.getElementById('product-cart-count');
            if (cartCountElement) {
                cartCountElement.textContent = cart.length > 0 ? cart.length : '';
            }
        }

        // Add Product to Cart with Shopify Integration
        async function addProductToCart(handle, productId, title, price, image) {
            console.log('ðŸ›’ Adding product to cart:', { handle, productId, title, price });
            
            try {
                // Show loading state
                const addButton = document.querySelector('.add-to-cart');
                if (addButton) {
                    addButton.classList.add('loading');
                    addButton.disabled = true;
                }
                
                // Create variant ID (simplified for demo)
                const variantId = `gid://shopify/ProductVariant/${productId}_001`;
                
                // Add to Shopify cart using existing cart system
                const success = await addToShopifyCart(variantId, 1, title, price, image);
                
                if (success) {
                    // Show success state
                    if (addButton) {
                        addButton.classList.remove('loading');
                        addButton.classList.add('success');
                        
                        setTimeout(() => {
                            addButton.classList.remove('success');
                            addButton.disabled = false;
                        }, 2000);
                    }
                    
                    // Update cart count in product page
                    updateCartCount();
                    
                    // Show success message
                    showToast(`${title} added to cart!`);
                    
                } else {
                    throw new Error('Failed to add to cart');
                }
                
            } catch (error) {
                console.error('Error adding to cart:', error);
                
                // Reset button state
                const addButton = document.querySelector('.add-to-cart');
                if (addButton) {
                    addButton.classList.remove('loading');
                    addButton.disabled = false;
                }
                
                // Show error message
                showToast('Failed to add to cart. Please try again.');
            }
        }

        // Buy Product Now with Shopify Draft Order Integration
        async function buyProductNow(handle, productId, title, price, image) {
            console.log('ðŸš€ Buy now clicked - Creating draft order for:', { handle, productId, title, price });
            
            try {
                // Show loading state
                const buyButton = document.querySelector('.buy-now');
                if (buyButton) {
                    buyButton.classList.add('loading');
                    buyButton.disabled = true;
                    buyButton.textContent = 'Creating Order...';
                }
                
                // Create draft order payload - FIXED VERSION
                const draftOrderData = {
                    draft_order: {
                        line_items: [
                            {
                                title: title,
                                price: extractPrice(price).toFixed(2),
                                quantity: 1,
                                requires_shipping: true,
                                taxable: true,
                                fulfillment_service: "manual",
                                custom_attributes: [
                                    {
                                        key: "product_handle",
                                        value: handle
                                    },
                                    {
                                        key: "product_image",
                                        value: image
                                    },
                                    {
                                        key: "product_id",
                                        value: productId
                                    }
                                ]
                            }
                        ],
                        note: `Mobile app order - Product: ${title}`,
                        email: "", // Customer email if available
                        shipping_address: {
                            first_name: "Mobile",
                            last_name: "Customer",
                            address1: "To be provided",
                            city: "To be provided",
                            province: "To be provided",
                            country: "India",
                            zip: "000000"
                        },
                        billing_address: {
                            first_name: "Mobile",
                            last_name: "Customer",
                            address1: "To be provided",
                            city: "To be provided",
                            province: "To be provided",
                            country: "India",
                            zip: "000000"
                        },
                        currency: "INR",
                        invoice_sent_at: null,
                        invoice_url: null,
                        tags: "mobile-app,buy-now"
                    }
                };
                
                console.log('ðŸ“‹ Draft order payload:', draftOrderData);
                
                // Always try to call draft order API first (like original behavior)
                const response = await fetch(`${API_BASE}/api/draft-orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'create',
                        draftOrderData: draftOrderData
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… Draft order created:', result);
                    
                    if (result.success && result.draftOrder) {
                        // Reset button state
                        if (buyButton) {
                            buyButton.classList.remove('loading');
                            buyButton.disabled = false;
                            buyButton.textContent = 'Buy Now';
                        }
                        
                        // Show success message with option to complete order
                        showToast('ðŸŽ‰ Order created successfully!');
                        
                        // Ask user if they want to complete the order now
                        setTimeout(() => {
                            if (confirm('Order created! Would you like to complete the checkout now?')) {
                                completeDraftOrder(result.draftOrder.id);
                            } else {
                                goBack();
                            }
                        }, 1000);
                        
                        console.log('ðŸ“§ Draft Order ID:', result.draftOrder.id);
                        console.log('ðŸ”— Invoice URL:', result.draftOrder.invoice_url);
                        
                    } else {
                        throw new Error(result.error || 'Failed to create draft order');
                    }
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to create draft order');
                }
                
            } catch (error) {
                console.error('âŒ Error creating draft order:', error);
                
                // Reset button state
                const buyButton = document.querySelector('.buy-now');
                if (buyButton) {
                    buyButton.classList.remove('loading');
                    buyButton.disabled = false;
                    buyButton.textContent = 'Buy Now';
                }
                
                // Show error message
                showToast('Failed to create order. Please try again.');
            }
        }

        // Action button functions
        function viewSizeGuide() {
            console.log('ðŸ“ Viewing size guide');
            showToast('ðŸ“ Size guide feature ready');
        }

        function tryVirtual(handle) {
            console.log('ðŸ‘“ Try virtual:', handle);
            showToast('ðŸ‘“ Virtual try-on feature ready');
        }

        function viewReviews() {
            console.log('ðŸ’¬ Viewing reviews');
            showToast('ðŸ’¬ Reviews feature ready');
        }

        // Wishlist functions
        function toggleWishlist(handle) {
            console.log('â¤ï¸ Toggle wishlist:', handle);
            
            const button = document.querySelector('.wishlist-button');
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                showToast('â¤ï¸ Added to wishlist');
            } else {
                showToast('ðŸ’” Removed from wishlist');
            }
        }

        function updateWishlistState(handle) {
            // Check if product is in wishlist
            const wishlist = JSON.parse(localStorage.getItem('goeye-wishlist')) || [];
            const button = document.querySelector('.wishlist-button');
            
            if (wishlist.includes(handle)) {
                button.classList.add('active');
            }
        }

        // WhatsApp chat
        function openWhatsAppChat() {
            console.log('ðŸ’¬ Opening WhatsApp chat');
            
            const message = encodeURIComponent(`Hi! I'm interested in ${productData.title}`);
            const whatsappUrl = `https://wa.me/${pdpConfig.whatsappNumber || '+919999999999'}?text=${message}`;
            window.open(whatsappUrl, '_blank');
        }

        // Complete Draft Order function
        async function completeDraftOrder(draftOrderId) {
            console.log('ðŸŽ¯ Completing draft order:', draftOrderId);
            
            try {
                showToast('Processing checkout...');
                
                const response = await fetch(`${API_BASE}/api/draft-orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'complete',
                        draftOrderId: draftOrderId
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… Draft order completed:', result);
                    
                    if (result.success && result.orderId) {
                        showToast('ðŸŽ‰ Order placed successfully!');
                        console.log('ðŸ“¦ Order ID:', result.orderId);
                        
                        // Close product detail page after successful order
                        setTimeout(() => {
                            goBack();
                        }, 2000);
                        
                    } else {
                        throw new Error(result.error || 'Failed to complete order');
                    }
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to complete order');
                }
                
            } catch (error) {
                console.error('âŒ Error completing draft order:', error);
                showToast('Failed to complete checkout. Please try again.');
            }
        }

        // Add to Shopify Cart Function (integrates with existing cart system)
        async function addToShopifyCart(variantId, quantity, title, price, image) {
            try {
                console.log('ðŸ›’ Adding to Shopify cart:', { variantId, quantity, title, price });
                
                // Always try API first (like original behavior), fallback to local if it fails
                const response = await fetch(`${API_BASE}/api/cart`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'add',
                        variantId: variantId,
                        quantity: quantity,
                        properties: {
                            title: title,
                            price: price,
                            image: image
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… Cart API response:', data);
                    
                    if (data.success && data.cart) {
                        // Update localStorage with new cart
                        localStorage.setItem('shopify-cart', JSON.stringify(data.cart));
                        
                        // Update local cart array
                        cart = convertShopifyCartToLocal(data.cart);
                        
                        return true;
                    } else {
                        console.error('Cart API error:', data.error);
                        return false;
                    }
                } else {
                    console.error('Cart API request failed:', response.status);
                    return false;
                }
                
            } catch (error) {
                console.error('addToShopifyCart error:', error);
                
                // Fallback to local cart if API fails
                return addToLocalCart(variantId, quantity, title, price, image);
            }
        }

        // Fallback: Add to Local Cart
        function addToLocalCart(variantId, quantity, title, price, image) {
            console.log('ðŸ“± Adding to local cart as fallback');
            
            try {
                // Add to local cart array
                const newItem = {
                    variant_id: variantId,
                    quantity: quantity,
                    title: title,
                    price: extractPrice(price),
                    image: image,
                    handle: productData.handle
                };
                
                cart.push(newItem);
                
                // Save to localStorage
                localStorage.setItem('goeye-cart', JSON.stringify(cart));
                
                return true;
            } catch (error) {
                console.error('Error adding to local cart:', error);
                return false;
            }
        }

        // Convert Shopify cart format to local format
        function convertShopifyCartToLocal(shopifyCart) {
            if (!shopifyCart || !shopifyCart.items) return [];
            
            return shopifyCart.items.map(item => ({
                id: item.id,
                title: item.product_title,
                price: (item.price / 100).toFixed(2),
                quantity: item.quantity,
                image: item.image,
                variant_id: item.variant_id
            }));
        }

        // Helper function to extract variant ID
        function extractVariantId(productId) {
            // For REST Admin API, return numeric variant ID as string
            // In production, this should be the actual variant ID from your product data
            // For now, using a base number + productId to create unique variant IDs
            const baseVariantId = 40000000000; // Base Shopify variant ID
            const numericId = parseInt(productId) || 1;
            return String(baseVariantId + numericId);
        }

        // Helper function to extract price value
        function extractPrice(priceString) {
            // Extract numeric value from price string like "â‚¹2,499"
            const numericPrice = priceString.replace(/[^\d.]/g, '');
            return parseFloat(numericPrice) || 0;
        }

        // Image Slider Functions
        let currentImageIndex = 0;
        let autoSlideInterval = null;
        let totalImages = 0;

        // Initialize image slider
        function initializeImageSlider() {
            const images = document.querySelectorAll('.product-main-image');
            const dots = document.querySelectorAll('.pagination-dot');
            totalImages = images.length;
            
            if (totalImages <= 1) return; // No need for slider if only one image
            
            // Start auto-slide
            startAutoSlide();
            
            // Add touch/swipe support
            addSwipeSupport();
        }

        // Show specific image
        function showImage(index) {
            if (index < 0 || index >= totalImages) return;
            
            // Update images
            const images = document.querySelectorAll('.product-main-image');
            images.forEach((img, i) => {
                img.classList.toggle('active', i === index);
            });
            
            // Update dots
            const dots = document.querySelectorAll('.pagination-dot');
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            currentImageIndex = index;
            
            // Restart auto-slide
            restartAutoSlide();
        }

        // Go to next image
        function nextImage() {
            const nextIndex = (currentImageIndex + 1) % totalImages;
            showImage(nextIndex);
        }

        // Go to previous image
        function prevImage() {
            const prevIndex = (currentImageIndex - 1 + totalImages) % totalImages;
            showImage(prevIndex);
        }

        // Start auto-slide
        function startAutoSlide() {
            if (totalImages <= 1) return;
            
            autoSlideInterval = setInterval(() => {
                nextImage();
            }, 3000); // Change image every 3 seconds
        }

        // Stop auto-slide
        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
                autoSlideInterval = null;
            }
        }

        // Restart auto-slide
        function restartAutoSlide() {
            stopAutoSlide();
            startAutoSlide();
        }

        // Add swipe support for mobile
        function addSwipeSupport() {
            const container = document.getElementById('product-image-container');
            if (!container) return;
            
            let startX = 0;
            let startY = 0;
            let isDragging = false;
            
            container.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                isDragging = true;
                stopAutoSlide();
            });
            
            container.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
            });
            
            container.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const diffX = startX - endX;
                const diffY = startY - endY;
                
                // Only trigger swipe if horizontal movement is greater than vertical
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (diffX > 0) {
                        nextImage(); // Swipe left - next image
                    } else {
                        prevImage(); // Swipe right - previous image
                    }
                }
                
                restartAutoSlide();
            });
            
            // Pause auto-slide on hover (desktop)
            container.addEventListener('mouseenter', stopAutoSlide);
            container.addEventListener('mouseleave', startAutoSlide);
        }

        // Utility functions
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                font-size: 14px;
                z-index: 9999;
                pointer-events: none;
                transition: opacity 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 2500);
        }

        console.log('ðŸ“± Product Detail Page Script Loaded');
    </script>
</body>
</html> 