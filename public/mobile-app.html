<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>GoEye Store</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: white;
            color: #333;
            line-height: 1.6;
            padding-bottom: 80px; /* Space for bottom navigation */
            /* No padding-top needed since header is now fixed */
            /* Ensure smooth scrolling */
            overflow-x: hidden;
            overflow-y: auto;
        }

        /* Announcement Bar Styles */
        .announcement-bar {
            background: var(--announcement-background-color, #1E1B4B);
            color: var(--announcement-text-color, #ffffff);
            padding: 8px 0;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            position: relative;
            z-index: 998;
            overflow: hidden;
            width: 100%;
        }

        .announcement-content {
            position: relative;
            display: inline-block;
            animation: scrollText var(--announcement-scroll-speed, 5000ms) infinite linear;
        }

        .announcement-text {
            white-space: nowrap;
            display: inline-block;
        }

        @keyframes scrollText {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        @media screen and (min-width: 768px) {
            .announcement-bar {
                display: none;
            }
        }

        /* Custom Header - Advanced Liquid Template Based */
        .custom-header {
            position: relative;
            top: 0;
            z-index: 20;
            width: 100%;
            overflow: visible;
            display: block;
            background: transparent;
            /* Removed duplicate safe area - wrapper handles it */
        }

        /* Fixed Header Wrapper - Extends into safe area for black background */
        .custom-header-wrapper {
            position: fixed;
            top: 0; /* Start at very top */
            left: 0;
            right: 0;
            z-index: 2000; /* High enough to be on top */
            background: var(--header-background-color, #fff);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding-top: env(safe-area-inset-top, 0); /* Add safe area as padding */
            padding-left: 0;
            padding-right: 0;
            padding-bottom: 0;
            width: 100%;
            /* Force hardware acceleration for smooth scrolling */
            will-change: transform;
            transform: translateZ(0);
        }

        /* Header Content Padding - for the main header content only */
        .custom-header-wrapper .custom-header-top,
        .custom-header-wrapper .custom-header-search,
        .custom-header-wrapper .custom-header-nav {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .custom-header-wrapper .custom-header-top {
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        /* Content below fixed header needs margin to avoid being hidden */
        .trending-section {
            position: relative;
            z-index: 15;
            background: var(--trending-background, #f8f9fa);
            margin-top: calc(250px + env(safe-area-inset-top, 0)) !important; /* Increased header height + safe area + buffer */
            padding-top: 20px !important; /* Additional padding for safety */
        }

        /* Alternative: Use padding-top on first content section */
        .page-content {
            padding-top: calc(250px + env(safe-area-inset-top, 0)) !important; /* Space for fixed header + safe area + buffer */
        }
        
        /* Fixed header extends into safe area - adjust content spacing */
        .trending-section {
            position: relative;
            z-index: 15;
            background: var(--trending-background, #f8f9fa);
            margin-top: calc(180px + env(safe-area-inset-top, 0)) !important;
        }
        
        /* Alternative: Use padding-top on first content section */
        .page-content {
            padding-top: calc(180px + env(safe-area-inset-top, 0)) !important;
        }

        @media screen and (min-width: 768px) {
            .custom-header {
                display: none;
            }
        }

        /* Tablet and Desktop Support - safe area handled by wrapper only */
        @media screen and (min-width: 768px) and (max-width: 1024px) {
            /* No additional safe area - wrapper handles it */
                }
        
        /* Permanent Safe Area Spacer - ALWAYS VISIBLE */
        .safe-area-spacer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: env(safe-area-inset-top, 0);
            z-index: 9999;
            pointer-events: none;
            background: transparent;
        }
        
        /* Back to simple approach */
        
        /* Hide header content but NOT wrapper (preserves safe area) */
        body.hide-header .custom-header-top,
        body.hide-header .custom-header-search,
        body.hide-header .custom-header-nav,
        body.hide-header .announcement-bar,
        body.hide-header .categories-section,
        body.hide-header #sunglasses-categories-section,
        body.hide-header .shark-tank-section {
            display: none;
        }

        /* Keep wrapper visible to preserve safe area */
        body.hide-header .custom-header-wrapper {
            background: transparent;
            box-shadow: none;
        }
        
        /* Adjust content spacing when header is hidden - safe area still extends */
        body.hide-header .trending-section {
            margin-top: calc(40px + env(safe-area-inset-top, 0)) !important;
        }
        
        body.hide-header .page-content {
            padding-top: calc(40px + env(safe-area-inset-top, 0)) !important;
        }



        .custom-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .custom-header-left {
            flex: 1;
            display: flex;
            justify-content: flex-start;
            gap: 1rem;
            align-items: center;
        }

        .custom-header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .custom-header-right {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .custom-header-logo {
            flex-shrink: 0;
        }

        .custom-header-logo img {
            height: auto;
            max-height: 50px;
            width: auto;
            max-width: 50px;
            margin: 0 auto;
        }

        .custom-header-search {
            width: 100%;
            position: relative;
            margin-bottom: 1px;
        }

        .custom-header-search input {
            width: 100%;
            padding: 10px 2.5rem 10px 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            background: #f5f5f5;
        }

        .custom-header-search input::placeholder {
            opacity: 0;
        }

        .search-placeholder-text {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            color: #666;
            pointer-events: none;
            white-space: nowrap;
            animation: cycleText 4s linear infinite;
            opacity: 0;
        }

        .search-placeholder-text:nth-child(2) {
            animation-delay: 2s;
        }

        @keyframes cycleText {
            0%, 45% {
                opacity: 0;
                transform: translateY(-50%) translateX(10px);
            }
            50%, 95% {
                opacity: 1;
                transform: translateY(-50%) translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50%) translateX(-10px);
            }
        }

        .custom-header-search button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            padding: 0;
            display: flex;
            align-items: center;
        }

        .custom-header-icons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .custom-header-icons a,
        .custom-header-icons button,
        .custom-header-left button,
        .custom-header-right a {
            position: relative;
            background: none;
            border: none;
            font-size: 20px;
            padding: 0;
            display: flex;
            align-items: center;
            color: var(--icon-color, #ffffff);
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .custom-header-icons a:hover,
        .custom-header-icons button:hover,
        .custom-header-left button:hover,
        .custom-header-right a:hover {
            color: var(--icon-hover-color, #1E1B4B);
        }

        .custom-header-nav {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .custom-header-nav::-webkit-scrollbar {
            display: none;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            margin: 0;
            list-style: none;
            white-space: nowrap;
            background: var(--nav-background-color, #fff);
        }

        .nav-tabs li {
            display: inline-block;
            position: relative;
        }

        .nav-tabs a {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 16px;
            text-decoration: none;
            color: var(--nav-text-color, #6B7280);
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            position: relative;
        }

        .nav-tabs a.active {
            color: var(--nav-active-color, #1E1B4B);
            font-weight: 600;
            background: var(--nav-active-background, transparent);
        }

        .nav-tabs a.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--nav-active-color, #1E1B4B);
            border-radius: 2px 2px 0 0;
        }

        .nav-tabs a:hover:not(.active) {
            color: var(--nav-hover-color, #1E1B4B);
        }

        .nav-indicator {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: var(--nav-indicator-color, #F97316);
            border-radius: 50%;
            top: 8px;
            right: 8px;
        }

        .nav-tab-icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-tab-icon svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
        }

        /* Offer Button Styles */
        .offer-button {
            background: linear-gradient(135deg, var(--offer-button-color, #FF6B6B) 0%, var(--offer-button-color-end, #FF8E8E) 100%);
            border: none;
            border-radius: 50px;
            padding: 5px 12px;
            font-size: 12px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.2);
            position: relative;
            overflow: hidden;
            text-decoration: none;
            white-space: nowrap;
            margin-left: 8px;
        }

        .offer-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .offer-button:hover:before {
            left: 100%;
        }

        .offer-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .offer-button svg {
            width: 14px;
            height: 14px;
            stroke: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .offer-button.pulse {
            animation: pulse 2s infinite;
        }

        /* Menu Drawer */
        .menu-drawer {
            position: fixed;
            top: 0;
            left: 0;
            width: 85%;
            max-width: 360px;
            height: 100vh;
            background: var(--drawer-background, #fff);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
        }

        body.menu-open .menu-drawer {
            transform: translateX(0);
        }

        .menu-drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
            z-index: 999;
        }

        body.menu-open .menu-drawer-overlay {
            opacity: 1;
            visibility: visible;
        }

        .menu-drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--drawer-border-color, #e5e7eb);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .menu-drawer-close {
            background: none;
            border: none;
            padding: 5px;
            color: var(--drawer-text-color, #1f2937);
            cursor: pointer;
        }

        .menu-drawer-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--drawer-text-color, #1f2937);
            margin: 0;
        }

        .gender-selector {
            display: flex;
            padding: 12px 16px;
            gap: 1px;
            background: var(--drawer-border-color, #e5e7eb);
        }

        .gender-tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            background: var(--drawer-background, #fff);
            border: none;
            color: var(--drawer-text-color, #1f2937);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .gender-tab:first-child {
            border-radius: 6px 0 0 6px;
        }

        .gender-tab:last-child {
            border-radius: 0 6px 6px 0;
        }

        .gender-tab.active {
            background: var(--drawer-active-background, #1f2937);
            color: white;
        }

        /* Trending Section */
        .trending-section {
            background: var(--trending-background, #f8f9fa);
            padding-bottom: 16px;
            margin-top: -16px;
        }

        .trending-header {
            display: flex;
            align-items: center;
            padding: 16px;
        }

        .trending-title {
            font-size: 18px;
            font-weight: 600;
            color: #1E1B4B;
            margin: 0;
        }

        .trending-title span {
            color: var(--nav-active-color, #1E1B4B);
        }

        .trending-slider {
            position: relative;
            overflow: hidden;
        }

        .trending-items {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px;
            margin-left: 15px;
        }

        .trending-items::-webkit-scrollbar {
            display: none;
        }

        .trending-item:first-child {
            margin-left: 8px;
        }

        .trending-item {
            flex: 0 0 auto;
            width: 220px;
            height: 270px;
            scroll-snap-align: start;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .trending-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .trending-item img,
        .trending-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .trending-item-link {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .trending-item-title {
            position: absolute;
            bottom: 12px;
            left: 12px;
            right: 12px;
            font-size: 14px;
            font-weight: 500;
            color: white;
            margin: 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            z-index: 2;
        }

        /* Cart Count Bubble */
        .cart-count-bubble {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--cart-count-background, #EF4444);
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            transform-origin: center;
            animation: cartBounce 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            line-height: 1;
            z-index: 1;
        }

        @keyframes cartBounce {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* Categories Section */
        .categories-section {
            padding: 0 0px;
            margin: 0 0 12px 0;
        }

        .category-block {
            margin-bottom: 0px;
        }

        .category-header {
            margin-bottom: 12px;
        }

        .category-title {
            font-size: 18px;
            font-weight: 600;
            color: #02003D;
            margin: 0 0 12px 16px;
            display: flex;
            align-items: center;
        }

        .subcategories {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0px;
            padding: 0 16px;
        }

        .subcategory-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: inherit;
            
            border-radius: 12px;
            background: white;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .subcategory-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .subcategory-image {
            width: 85px;
            height: 85px;
            border-radius: 10%;
            overflow: hidden;
            margin-bottom: 8px;
            border: 2px solid #f0f0f0;
        }

        .subcategory-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .subcategory-title {
            font-size: 12px;
            font-weight: 500;
            color: #02003D;
            text-align: center;
        }



        /* Category Drawer Styles */
        .category-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .category-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .category-drawer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 75vh;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 24px 24px 0 0;
            z-index: 999;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow: hidden;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.12);
            backdrop-filter: blur(10px);
        }

        .category-drawer.active {
            transform: translateY(0);
        }

        .drawer-header {
            padding: 24px 20px;
            border-bottom: 1px solid #e8ecf0;
            background: #000000;
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(20px);
        }

        .drawer-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drawer-title span {
            font-size: 22px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .close-drawer {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 12px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            color: white;
            width: 44px;
            height: 44px;
        }

        .close-drawer:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .drawer-content {
            padding: 20px;
            height: calc(70vh - 80px);
            overflow-y: auto;
        }

        .category-product-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px;
            max-height: calc(75vh - 100px);
            overflow-y: auto;
        }

        .category-product-grid.show-all {
            /* Keep same layout */
        }





        .category-product-card {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
            background: white;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #e8ecf0;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            position: relative;
            overflow: hidden;
        }

        .category-product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .category-product-card::before {
            display: none;
        }

        .category-product-image {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }

        .category-product-image::after {
            display: none;
        }

        .category-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .category-product-card:hover .category-product-image img {
            transform: scale(1.05);
        }

        .category-product-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            position: relative;
        }

        .category-product-brand {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .category-product-price {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 2px 0;
        }

        .category-product-offer {
            font-size: 14px;
            color: #667eea;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .category-product-offer::before {
            content: '✓';
            background: #667eea;
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .category-product-card::after {
            content: '›';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #9ca3af;
            font-weight: 300;
        }

        .category-product-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #1a1a1a;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-product-badge.premium {
            background: #fbbf24;
            color: #1a1a1a;
        }

        .category-product-badge.shark-tank {
            background: #ef4444;
            color: white;
        }

        /* Sale banner styles */
        .sale-banner {
            background: #dc2626; /* fallback color */
            color: white;
            text-align: center;
            padding: 15px 0;
            margin: 0;
            position: sticky;
            top: 0;
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            z-index: 1001;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border: none;
            overflow: visible;
            display: block !important;
            visibility: visible !important;
        }
        
        /* Ensure dynamic background color always applies */
        .sale-banner[style] {
            background: inherit !important;
        }

        .sale-banner .sale-text-1 {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            opacity: 0.9;
        }

        .sale-banner .sale-text-2 {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Shark Tank Section */
        .shark-tank-section {
            padding: 0 16px;
            margin: 0 0 12px 0;
        }

        .section-header {
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #02003D;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .section-subtitle {
            font-size: 12px;
            color: #666B7A;
            margin: 2px 0 0;
            font-weight: 500;
        }

        .shark-tank-slider {
            position: relative;
            margin: 0 -16px;
            padding: 0 16px 8px;
        }

        .shark-tank-slider__track {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
            padding: 0 0 8px;
        }

        .shark-tank-slider__track::-webkit-scrollbar {
            display: none;
        }

        .shark-tank-slide {
            flex: 0 0 calc(30% - 6px);
            scroll-snap-align: start;
        }

        .shark-tank-card {
            position: relative;
            width: 200px;
            height: 250px;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 1/1;
            background: #000;
        }

        .shark-tank-card__media {
            width: 100%;
            height: 100%;
        }

        .shark-tank-card__media img,
        .shark-tank-card__media video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .shark-tank-card__overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0) 50%, rgba(0,0,0,0.7) 100%);
        }

        .shark-tank-card__tag {
            position: absolute;
            top: 16px;
            left: 16px;
            background: #00FF47;
            padding: 4px 12px;
            border-radius: 4px;
            color: #000;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .shark-tank-card__content {
            position: absolute;
            bottom: 16px;
            left: 16px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .shark-tank-card__brand {
            color: #fff;
            font-size: 24px;
            font-weight: 600;
            margin: 0;
            text-transform: uppercase;
        }

        .shark-tank-card__brand.phonic {
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            color: #4AFF73;
            letter-spacing: -0.5px;
        }

        .shark-tank-card__title {
            color: rgba(255,255,255,0.9);
            font-size: 16px;
            font-weight: 500;
            margin: 0;
        }

        .shark-tank-card__button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
        }

        .shark-tank-card__button svg {
            width: 16px;
            height: 16px;
            margin-left: -4px;
            fill: currentColor;
        }

        /* New Drops Section Styles */
        .new-drops-section {
            padding: 0 16px;
            margin-bottom: 16px;
            margin-top: -8px;
            background: #FFFFFF;
            max-width: 800px;
            margin: 0 auto;
        }

        .new-drops-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            margin-top: 15px;
        }

        .new-drops-title {
            font-size: 18px;
            font-weight: 600;
            color: #141C57;
            margin: 0;
            padding: 0;
        }

        .new-drops-subtitle {
            font-size: 13px;
            color: #666666;
            margin: 4px 0 12px;
            line-height: 1.4;
            opacity: 0.85;
        }

        .banner-card {
            border-radius: 24px;
            overflow: hidden;
            position: relative;
            text-decoration: none;
            display: block;
            background: #000000;
        }

        .banner-slideshow {
            position: relative;
            width: 100%;
            margin: 0;
            overflow: hidden;
        }

        .banner-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
            text-decoration: none;
            display: block;
        }

        .banner-slide.active {
            opacity: 1;
            visibility: visible;
            position: relative;
        }

        .banner-image {
            width: 100%;
            aspect-ratio: 358/480;
            object-fit: cover;
            display: block;
        }

        .banner-progress-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 24px 16px;
            z-index: 2;
        }

        .progress-dash {
            width: 24px;
            height: 2px;
            background: rgba(255, 255, 255, 0.5);
            transition: background-color 0.3s ease;
            box-shadow: 0 0 1px 1px rgba(0, 0, 0, 0.3);
        }

        .progress-dash.active {
            background: #FFFFFF;
            box-shadow: 0 0 1px 1px rgba(0, 0, 0, 0.5);
        }

        .banner-image-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .banner-logo {
            position: absolute;
            z-index: 2;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .banner-logo.position-top-left {
            top: 12px;
            left: 12px;
        }

        .banner-logo.position-top-center {
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
        }

        .banner-logo.position-top-right {
            top: 12px;
            right: 12px;
        }

        .banner-logo.position-bottom-left {
            bottom: 12px;
            left: 12px;
        }

        .banner-logo.position-bottom-right {
            bottom: 12px;
            right: 12px;
        }

        .banner-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-divider {
            margin: 0 8px;
            color: #FFFFFF;
            font-size: 20px;
            font-weight: 300;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .logo-container {
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
        }

        .banner-content-overlay {
            position: absolute;
            bottom: 36px;
            left: 24px;
            right: 24px;
            z-index: 2;
            text-align: center;
        }

        .banner-slide-heading {
            font-size: 22px;
            font-weight: 700;
            color: #FFFFFF;
            margin: 0 0 8px;
            line-height: 1.2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            text-align: center;
        }

        .banner-slide-subheading {
            font-size: 12px;
            color: #FFFFFF;
            line-height: 1.4;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            text-align: center;
        }

        .shop-now-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 12px;
            background: #FFFFFF;
            color: #000000;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .shop-now-button:hover {
            transform: translateY(-2px);
            background: #F5F5F5;
        }

        /* Looks Section Styles */
        .looks-section {
            padding: 16px 0;
            background: #ffffff;
            margin: 16px 0;
        }

        .looks-header {
            margin-bottom: 16px;
            text-align: left;
            padding: 0 16px;
        }

        .looks-title {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 2px;
        }

        .looks-title-cursive {
            font-family: 'Satisfy', cursive;
            font-size: 28px;
            font-style: italic;
            color: #000;
        }

        .looks-title-bold {
           
            color: #000;
            padding: 3px 10px;
            border-radius: 6px;
            font-family: sans-serif;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .looks-subtitle {
            font-size: 16px;
            color: #666B7E;
            margin: 0;
            font-weight: 400;
        }

        .looks-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .looks-row {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 4px 0;
            margin: 0 -16px;
        }

        .looks-row::-webkit-scrollbar {
            display: none;
        }

        .looks-grid {
            display: flex;
            gap: 8px;
            min-width: max-content;
            padding: 0 26px;
        }

        .looks-card {
            position: relative;
            border-radius: 28px;
            overflow: hidden;
            width: 100px;
            height: 120px;
            text-decoration: none;
            color: inherit;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .looks-card.explore {
            padding: 16px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 20px;
            height: 120px;
            min-width: 100px;
        }

        .looks-card.explore.men {
            background: #F0F1FF;
        }

        .looks-card.explore.women {
            background: #FFF0F0;
        }

        .looks-explore-title {
            font-size: 24px;
            font-weight: 700;
            color: #1B224B;
            margin: 0 0 2px;
            line-height: 1;
            white-space: nowrap;
        }

        .looks-explore-subtitle {
            font-size: 13px;
            color: #1B224B;
            margin: 0;
            font-weight: 500;
            opacity: 0.8;
        }

        .looks-explore-arrow {
            width: 28px;
            height: 28px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .looks-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top center;
        }

        .looks-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 32px 12px 12px;
            color: #fff;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
        }

        .looks-card-title {
            font-size: 12px;
            font-weight: 900;
            margin: 0;
            text-align: center;
            line-height: 1.2;
        }

        /* Collections Section */
        .collections-section {
            padding: 0px;
            background: white;
        }

        .collections-title {
            font-size: 18px;
            font-weight: 600;
            color: #02003D;
            margin: 0 0 12px 16px;
            display: flex;
            align-items: center;
        }

        .collections-grid {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            gap: 16px;
            padding: 0 16px;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }

        .collections-grid::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .collection-card {
            display: block;
            text-decoration: none;
            color: inherit;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            transition: transform 0.2s ease;
            text-align: center;
            padding: 16px;
            min-width: 120px;
            flex-shrink: 0;
        }

        .collection-card:hover {
            transform: translateY(-2px);
        }

        .collection-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            margin: 0 auto 12px;
            border: 3px solid #f0f0f0;
        }

        .collection-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .collection-title {
            font-size: 16px;
            font-weight: 600;
            color: #02003D;
            margin: 0;
        }

        .collection-count {
            font-size: 12px;
            font-weight: 400;
            color: #666;
            margin: 4px 0 0 0;
        }

        /* Products Section */
        .products-section {
            padding: 0px;
            background: white;
        }

        .products-title {
            font-size: 18px;
            font-weight: 600;
            color: #02003D;
            margin: 0 0 12px 16px;
            display: flex;
            align-items: center;
        }

        /* New Featured Products Design - Horizontal Scrolling */
        .products-grid {
            display: flex;
            gap: 16px;
            padding: 0 16px;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        
        .products-grid::-webkit-scrollbar {
            display: none; /* Chrome, Safari and Opera */
        }

        /* Modern Product Card Design */
        .product-card {
            display: block;
            text-decoration: none;
            color: inherit;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-width: 280px;
            max-width: 280px;
            flex-shrink: 0;
            scroll-snap-align: start;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        /* Product Image */
        .product-image {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Color Indicator - Top Left */
        .color-indicator {
            position: absolute;
            top: 16px;
            left: 16px;
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 4px 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            z-index: 2;
        }
        
        .color-segments {
            display: flex;
            gap: 2px;
            margin-right: 6px;
        }
        
        .color-segment {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }
        
        .segment-blue { background: #3b82f6; }
        .segment-orange { background: #f97316; }
        .segment-gray { background: #6b7280; }
        
        /* Product Info Section */
        .product-info {
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 140px; /* Fixed height for consistent layout */
        }
        
        .product-code {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .product-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin: 0 0 16px 0;
            line-height: 1.4;
        }
        
        /* Pricing and Add to Bag Section */
        .product-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
        }
        
        .add-to-bag-btn {
            background: #111827;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .add-to-bag-btn:hover {
            background: #374151;
        }
        
        .add-to-bag-icon {
            width: 14px;
            height: 14px;
        }
        
        .product-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .product-card:hover .product-actions {
            opacity: 1;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s ease;
            backdrop-filter: blur(10px);
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 1);
        }
        
        .action-btn svg {
            width: 18px;
            height: 18px;
            color: #374151;
        }

        /* Collections Full Page Styles */
        .collections-page-header {
            padding: 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 1rem;
        }
        
        .collections-page-header h2 {
            margin: 0 0 0.5rem 0;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .collections-page-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .collections-full-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }
        
        .collection-full-card {
            display: block;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-decoration: none;
            color: inherit;
        }
        
        .collection-full-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        
        .collection-full-image {
            position: relative;
            height: 180px;
            overflow: hidden;
        }
        
        .collection-full-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .collection-full-card:hover .collection-full-image img {
            transform: scale(1.05);
        }
        
        .collection-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 1rem;
            color: white;
        }
        
        .collection-products-count {
            font-size: 0.85rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .collection-full-info {
            padding: 1rem;
        }
        
        .collection-full-info h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .collection-full-info p {
            margin: 0;
            font-size: 0.9rem;
            color: #6b7280;
            line-height: 1.4;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }
        
        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: #374151;
        }
        
        .retry-btn {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .retry-btn:hover {
            background: #1d4ed8;
        }

        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .splash-screen.fade-out {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }
        
        .splash-content {
            text-align: center;
            color: white;
            animation: splashFadeIn 1s ease-out;
        }
        
        .splash-logo {
            margin-bottom: 2rem;
        }
        
        .logo-animation {
            display: inline-block;
            margin-bottom: 1rem;
            animation: logoFloat 2s ease-in-out infinite;
        }
        
        .logo-svg {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }
        
        .logo-circle {
            fill: none;
            stroke: white;
            stroke-width: 2;
            stroke-dasharray: 126;
            stroke-dashoffset: 126;
            animation: drawCircle 2s ease-out forwards;
        }
        
        .logo-diamond {
            fill: white;
            opacity: 0;
            animation: diamondAppear 1s ease-out 1s forwards;
        }
        
        .splash-title {
            font-size: 2rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: titleSlideIn 1s ease-out 0.5s both;
        }
        
        .splash-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
            animation: subtitleSlideIn 1s ease-out 0.7s both;
        }
        
        .splash-loading {
            margin-top: 2rem;
        }
        
        .loading-spinner {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 1rem;
        }
        
        .spinner-circle {
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            animation: spinnerBounce 1.4s ease-in-out infinite both;
        }
        
        .spinner-circle:nth-child(1) { animation-delay: -0.32s; }
        .spinner-circle:nth-child(2) { animation-delay: -0.16s; }
        
        .loading-text {
            font-size: 0.9rem;
            opacity: 0.8;
            margin: 0 0 1.5rem 0;
            animation: loadingTextPulse 2s ease-in-out infinite;
            transition: opacity 0.3s ease;
            min-height: 1.2rem;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            width: 100%;
            max-width: 280px;
        }
        
        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fff, #f0f0f0, #fff);
            background-size: 200% 100%;
            border-radius: 2px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            animation: progressShimmer 2s ease-in-out infinite;
        }
        
        .progress-percent {
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 35px;
            text-align: right;
            animation: percentPulse 1.5s ease-in-out infinite;
        }
        
        .loading-steps {
            margin-top: 0.5rem;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .step-dot.active {
            background: white;
            transform: scale(1.3);
            box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
        }
        
        /* Splash Screen Animations */
        @keyframes splashFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes logoFloat {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes drawCircle {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes diamondAppear {
            to {
                opacity: 1;
            }
        }
        
        @keyframes titleSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes subtitleSlideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes spinnerBounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        @keyframes loadingTextPulse {
            0%, 100% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
        }
        
        @keyframes progressShimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }
        
        @keyframes percentPulse {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }
        
        @keyframes sparkleFloat {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.5);
            }
            50% {
                opacity: 1;
                transform: translateY(-10px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px) scale(0.8);
            }
        }
        
        @keyframes logoComplete {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 6px 16px rgba(255, 255, 255, 0.4));
            }
            100% {
                transform: scale(1);
                filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            }
        }
        
        @keyframes stepComplete {
            0% {
                transform: scale(1);
                box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
            }
            50% {
                transform: scale(1.5);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            }
            100% {
                transform: scale(1.3);
                box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
            }
        }

        .product-image {
            width: 100%;
            height: 200px;
            overflow: hidden;
            background: #f8f8f8;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 12px;
        }

        .product-title {
            font-size: 14px;
            font-weight: 600;
            color: #02003D;
            margin: 0 0 4px 0;
            line-height: 1.3;
        }

        .product-price {
            font-size: 16px;
            font-weight: 700;
            color: #007C89;
            margin: 4px 0;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0 8px;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            transition: color 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .nav-item.active {
            color: #1E1B4B;
        }

        .nav-item:hover {
            color: #1E1B4B;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            fill: currentColor;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }

        .cart-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
        }

        /* Cart Sidebar */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 350px;
            max-width: 90vw;
            height: 100%;
            background: white;
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            transform: translateX(0);
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            margin: 0;
            font-size: 18px;
            color: #02003D;
        }

        .cart-close {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-items {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .empty-cart {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-details {
            flex: 1;
            min-width: 0;
        }

        .cart-item-brand {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin: 0 0 4px 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .cart-item-price {
            font-size: 16px;
            font-weight: 700;
            color: #1E1B4B;
            margin-bottom: 8px;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            border-color: #1E1B4B;
            color: #1E1B4B;
        }

        .quantity-btn:active {
            transform: scale(0.95);
        }

        .quantity {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            min-width: 20px;
            text-align: center;
        }

        .remove-item-btn {
            position: absolute;
            top: 16px;
            right: 0;
            width: 32px;
            height: 32px;
            border: none;
            background: #f5f5f5;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            transition: all 0.2s ease;
        }

        .remove-item-btn:hover {
            background: #ff4444;
            color: white;
        }

        .cart-total {
            padding: 20px;
            border-top: 1px solid #e5e5e5;
            background: #f8f8f8;
        }

        .cart-total-amount {
            font-size: 18px;
            font-weight: 600;
            color: #02003D;
            margin-bottom: 16px;
        }

        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: #1E1B4B;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .checkout-btn:hover {
            background: #2D2A5A;
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .loading::after {
            content: "";
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1E1B4B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 375px) {
            .custom-header-wrapper {
                padding: 0.75rem;
            }
            
            .category-title,
            .collections-title,
            .products-title,
            .section-title {
                font-size: 18px;
                
                font-weight: 600;
            }
            
            .subcategories,
            .collections-grid,
            .products-grid {
                padding: 0 12px;
            }
            
            .product-title {
                font-size: 13px;
            }
            
            .product-price {
                font-size: 15px;
            }
        }

        @media (max-width: 320px) {
            .custom-header-wrapper {
                padding: 0.5rem;
            }
            
            .category-title,
            .collections-title,
            .products-title,
            .section-title {
                font-size: 15px;
                margin-left: 8px;
            }
            
            .subcategories,
            .collections-grid,
            .products-grid {
                padding: 0 8px;
                gap: 8px;
            }
            
            .product-title {
                font-size: 12px;
            }
            
            .product-price {
                font-size: 14px;
            }
            
            .nav-label {
                font-size: 11px;
            }
        }

        /* Image slider (hidden by default) */
        .image-slider {
            display: none;
        }

        /* Error handling */
        .error-message {
            text-align: center;
            padding: 20px;
            color: #ff4444;
            background: #fff5f5;
            border: 1px solid #ffebee;
            border-radius: 8px;
            margin: 16px;
        }

        /* Success message */
        .success-message {
            text-align: center;
            padding: 20px;
            color: #00aa44;
            background: #f0fff4;
            border: 1px solid #c6f6d5;
            border-radius: 8px;
            margin: 16px;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            z-index: 10000;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Hide elements when needed */
        .hidden {
            display: none !important;
        }

        /* Ensure proper spacing */
        .main-content {
            padding-bottom: 100px;
        }

        /* Smooth transitions */
        * {
            transition: color 0.2s ease, background-color 0.2s ease, transform 0.2s ease;
        }

        /* Fix any overflow issues */
        html, body {
            overflow-x: hidden;
        }

        /* Ensure grids are properly aligned */
        .products-grid,
        .collections-grid {
            align-items: start;
        }

        /* Make sure all clickable elements have proper touch targets */
        .nav-item,
        .product-card,
        .collection-card,
        .subcategory-card,
        .category-product-card,
        .shark-tank-card {
            min-height: 44px;
            min-width: 44px;
        }

        /* Improved focus states for accessibility */
        .nav-item:focus,
        .product-card:focus,
        .collection-card:focus,
        .subcategory-card:focus,
        .category-product-card:focus {
            outline: 2px solid #1E1B4B;
            outline-offset: 2px;
        }

        /* Ensure proper contrast */
        .product-title,
        .collection-title,
        .category-title,
        .products-title,
        .collections-title,
            .section-title {
            color: #02003D;
        }

        /* Fix any z-index issues */
        .bottom-nav {
            z-index: 1000;
        }

        .cart-sidebar {
            z-index: 1001;
        }

        .cart-overlay {
            z-index: 1000;
        }

        .category-drawer {
            z-index: 1001;
        }

        .category-overlay {
            z-index: 1000;
        }

        /* Responsive Design for Category Drawer */
        @media (max-width: 480px) {
            .category-drawer {
                height: 80vh;
            }
            
            .category-product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                padding: 20px 16px;
            }
            
            .drawer-header {
                padding: 20px 16px;
            }
            
            .drawer-title span {
                font-size: 20px;
            }
            
            .shark-tank-card {
                width: 160px;
                height: 200px;
            }
            
            .shark-tank-card__brand {
                font-size: 20px;
            }
            
            .shark-tank-card__title {
                font-size: 14px;
            }
        }

        @media (max-width: 360px) {
            .category-product-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .category-product-card {
                max-width: 280px;
                margin: 0 auto;
            }
        }
        /* Smooth Scrollbar for Category Drawer */
        .category-drawer::-webkit-scrollbar {
            width: 6px;
        }

        .category-drawer::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        .category-drawer::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
        }

        .category-drawer::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }

        .category-product-grid::-webkit-scrollbar {
            width: 4px;
        }

        .category-product-grid::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        .category-product-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        /* Product Modal Styles */
        .product-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .product-modal-content {
            background: white;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .product-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-modal-header h2 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .close-button:hover {
            background: #f0f0f0;
        }

        .product-modal-body {
            padding: 20px;
        }

        .product-modal-image {
            text-align: center;
            margin-bottom: 20px;
        }

        .product-modal-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .product-modal-info h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: #333;
        }

        .product-modal-price {
            font-size: 24px;
            font-weight: bold;
            color: #1E1B4B;
            margin: 10px 0;
        }

        .product-modal-offer {
            color: #666;
            margin: 10px 0 20px 0;
            font-size: 14px;
        }

        .add-to-cart-btn {
            background: #1E1B4B;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s ease;
        }

        .add-to-cart-btn:hover {
            background: #2D2A5B;
        }

        .add-to-cart-btn:active {
            transform: translateY(1px);
        }

        /* External Page Overlay Styles */
        .external-page-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .external-page-container {
            width: 95%;
            height: 95%;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .external-page-header {
            background: linear-gradient(135deg, #c1ea3d 0%, #ffffff 100%);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .external-page-title {
            color: #1a1a1a;
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(255, 255, 255, 0.5);
            margin-left: 15px;
            margin-right: auto;
        }

        .external-page-close {
            background: rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(0, 0, 0, 0.2);
            color: #1a1a1a;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .external-page-close:hover {
            background: rgba(0, 0, 0, 0.2);
            border-color: rgba(0, 0, 0, 0.4);
            transform: rotate(90deg);
        }

        .external-page-close svg {
            width: 20px;
            height: 20px;
        }

        .external-page-iframe {
            flex: 1;
            width: 100%;
            border: none;
            background: white;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .external-page-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }
        }
        /* NEW COLLECTION PAGE STYLES - Based on main-collection.liquid */
        .collection-page-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px;
            z-index: 1000;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            height: 52px;
        }

        .collection-back-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .collection-back-btn svg {
            width: 20px;
            height: 20px;
            color: #1B224B;
        }

        .collection-title-info {
            flex: 1;
            text-align: center;
            min-width: 0;
        }

        .collection-page-title {
            color: #1B224B;
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            text-transform: capitalize;
        }

        .collection-product-count {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }

        .collection-actions {
            display: flex;
            gap: 8px;
        }

        .collection-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .collection-action-btn svg {
            width: 20px;
            height: 20px;
            color: #1B224B;
        }

        .collection-product-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 72px 12px 12px 12px; /* Top padding for fixed header */
            background: #ffffff;
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .collection-product-card {
            display: flex;
            background: white;
            border-radius: 8px;
            padding: 0;
            margin: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #E5E7EB;
        }

        .collection-product-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .product-image-area {
            position: relative;
            width: 140px;
            height: 140px;
            flex-shrink: 0;
            padding: 8px;
            overflow: hidden;
            border-radius: 8px 0 0 8px;
        }

        .product-image-area img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Show full product without cropping */
            background: #f8f9fa; /* Light background for better contrast */
            border-radius: 6px;
            transition: transform 0.3s ease;
        }

        .collection-product-card:hover .product-image-area img {
            transform: scale(1.05);
        }

        .product-quick-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .collection-product-card:hover .product-quick-actions {
            opacity: 1;
        }

        .quick-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .quick-action-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .quick-action-btn svg {
            width: 14px;
            height: 14px;
            color: #1B224B;
        }

        .wishlist-btn.active {
            background: #FEF2F2;
        }

        .wishlist-btn.active svg {
            color: #E73C17;
            fill: #E73C17;
        }

        .product-details-area {
            flex: 1;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-width: 0;
        }

        .product-details-top {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .product-brand-name {
            font-size: 14px;
            font-weight: 600;
            color: #1B224B;
            margin: 0;
        }

        .product-item-title {
            font-size: 13px;
            color: #6B7280;
            margin: 0;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price-section {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .product-current-price {
            font-size: 18px;
            font-weight: 600;
            color: #1B224B;
        }

        .product-original-price {
            font-size: 12px;
            color: #9CA3AF;
            text-decoration: line-through;
        }

        .product-discount {
            font-size: 10px;
            color: #059669;
            font-weight: 600;
            background: #ECFDF5;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .product-feature-list {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .product-feature-list::-webkit-scrollbar {
            display: none;
        }

        .product-feature {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #6B7280;
            padding: 4px 8px;
            background: #F9FAFB;
            border-radius: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .product-feature svg {
            width: 12px;
            height: 12px;
            color: #059669;
            flex-shrink: 0;
        }

        .product-action-section {
            margin-top: 8px;
        }

        .collection-add-to-cart {
            width: 100%;
            background: #1B224B;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .collection-add-to-cart:hover {
            background: #2A3362;
        }

        .collection-add-to-cart svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

                 /* MOBILE COLLECTION PAGE - Full Screen Experience */
         .collection-page-mode {
             overflow: hidden;
         }

         .collection-page-mode > *:not(#collection-full-page) {
             display: none !important;
         }

         .collection-full-page {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: #ffffff;
             z-index: 10000;
             transform: translateX(100%);
             transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
             display: flex;
             flex-direction: column;
             /* Safe area support for collection page */
             padding-top: env(safe-area-inset-top, 0);
             padding-left: env(safe-area-inset-left, 0);
             padding-right: env(safe-area-inset-right, 0);
             padding-bottom: env(safe-area-inset-bottom, 0);
         }

         .collection-full-page.active {
             transform: translateX(0);
         }

         .collection-mobile-header {
             position: sticky;
             top: 0;
             background: #ffffff;
             padding: 12px 16px;
             display: flex;
             align-items: center;
             justify-content: space-between;
             border-bottom: 1px solid #e5e7eb;
             box-shadow: 0 1px 3px rgba(0,0,0,0.1);
             z-index: 100;
             /* Ensure header stays on top and works with safe area */
             min-height: 60px;
             flex-shrink: 0;
         }

         .collection-mobile-back {
             display: flex;
             align-items: center;
             gap: 8px;
             background: none;
             border: none;
             font-size: 16px;
             font-weight: 500;
             color: #1B224B;
             cursor: pointer;
             padding: 8px;
             border-radius: 8px;
             transition: background 0.2s ease;
         }

         .collection-mobile-back:hover {
             background: #f3f4f6;
         }

         .collection-mobile-back svg {
             width: 20px;
             height: 20px;
         }

         .collection-mobile-title {
             flex: 1;
             text-align: center;
             font-size: 18px;
             font-weight: 700;
             color: #1B224B;
             margin: 0;
             padding: 0 16px;
         }

         .collection-mobile-actions {
             display: flex;
             gap: 8px;
         }

         .collection-mobile-btn {
             width: 40px;
             height: 40px;
             border-radius: 50%;
             background: #f8f9fa;
             border: none;
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             transition: all 0.2s ease;
             position: relative;
         }

         .collection-mobile-btn:hover {
             background: #e9ecef;
             transform: scale(1.05);
         }

         .collection-mobile-btn svg {
             width: 20px;
             height: 20px;
             color: #1B224B;
         }

         .collection-mobile-content {
             flex: 1;
             overflow-y: auto;
             padding: 16px;
             background: #f8f9fa;
         }

         .collection-mobile-grid {
             display: grid;
             grid-template-columns: 1fr;
             gap: 12px;
             max-width: 400px;
             margin: 0 auto;
         }

         .collection-mobile-card {
             background: white;
             border-radius: 16px;
             overflow: hidden;
             box-shadow: 0 4px 12px rgba(0,0,0,0.06);
             border: 1px solid #f1f3f4;
             transition: all 0.3s ease;
             cursor: pointer;
             position: relative;
         }

         .collection-mobile-card:hover {
             transform: translateY(-4px);
             box-shadow: 0 8px 24px rgba(0,0,0,0.12);
             border-color: #e0e4e7;
         }

         .collection-mobile-card:active {
             transform: translateY(-2px);
             transition: transform 0.1s ease;
         }

         .product-mobile-image {
             position: relative;
             width: calc(100% - 24px);
             height: 140px; /* Much more compact for maximum screen utilization */
             overflow: hidden;
             margin: 12px;
             border-radius: 10px;
             background: #ffffff;
         }

         /* Image Slider for Products */
         .product-image-slider {
             position: relative;
             width: 100%;
             height: 100%;
             overflow: hidden;
             border-radius: 12px;
             cursor: pointer;
         }
         
         /* Auto-slide indicator removed as requested */
         
         @keyframes pulse {
             0%, 100% { opacity: 0.6; }
             50% { opacity: 1; }
         }
         
         .product-images-container {
             display: flex;
             width: 100%;
             height: 100%;
             transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
             will-change: transform;
         }
         
         .product-slide-image {
             flex: 0 0 100%;
             width: 100%;
             height: 100%;
             object-fit: contain; /* Show full product without cropping */
             object-position: center; /* Center the full image */
             background: #ffffff; /* Clean white background */
             padding: 8px; /* Add small padding to ensure full visibility */
             transition: opacity 0.3s ease, transform 0.3s ease;
             user-select: none;
             -webkit-user-drag: none;
         }
         
         .collection-mobile-card:hover .product-slide-image {
             transform: scale(1.05);
         }
         
         /* Slide indicators */
         .image-indicators {
             position: absolute;
             bottom: 12px;
             left: 50%;
             transform: translateX(-50%);
             display: flex;
             gap: 6px;
             padding: 4px 8px;
             background: rgba(0, 0, 0, 0.2);
             border-radius: 12px;
             backdrop-filter: blur(10px);
         }
         
         .image-indicator {
             width: 8px;
             height: 8px;
             border-radius: 50%;
             background: rgba(255, 255, 255, 0.6);
             transition: all 0.3s ease;
             cursor: pointer;
             border: 1px solid rgba(255, 255, 255, 0.3);
         }
         
         .image-indicator:hover {
             background: rgba(255, 255, 255, 0.8);
             transform: scale(1.2);
         }
         
         .image-indicator.active {
             background: rgba(255, 255, 255, 1);
             transform: scale(1.3);
             box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
         }



         .product-mobile-info {
             padding: 0 12px 12px 12px;
         }

         .product-mobile-brand {
             font-size: 12px;
             font-weight: 400;
             color: #6b7280;
             margin: 0 0 4px 0;
             letter-spacing: 0.3px;
         }

         .product-mobile-title {
             font-size: 14px;
             font-weight: 400;
             color: #374151;
             margin: 0 0 8px 0;
             line-height: 1.2;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             -webkit-box-orient: vertical;
             overflow: hidden;
         }

         .product-mobile-price {
             display: flex;
             align-items: center;
             gap: 8px;
             margin-bottom: 12px;
             flex-wrap: wrap;
         }

         .mobile-current-price {
             font-size: 20px;
             font-weight: 400;
             color: #111827;
         }

         .mobile-original-price {
             font-size: 14px;
             color: #9ca3af;
             text-decoration: line-through;
         }

         .mobile-discount {
             font-size: 12px;
             color: #059669;
             font-weight: 500;
         }

         .product-mobile-status-line {
             display: flex;
             align-items: center;
             gap: 8px;
             margin-bottom: 8px;
             font-size: 11px;
             flex-wrap: wrap;
         }

         .mobile-stock-status {
             display: flex;
             align-items: center;
             gap: 4px;
             color: #059669;
             font-weight: 500;
         }

         .mobile-delivery-info {
             display: flex;
             align-items: center;
             gap: 4px;
             color: #6b7280;
         }

         .mobile-rating-info {
             display: flex;
             align-items: center;
             gap: 6px;
             color: #6b7280;
         }

         .mobile-stars {
             display: flex;
             gap: 1px;
             color: #fbbf24;
             font-size: 12px;
         }

         .mobile-rating-count {
             font-size: 13px;
             color: #6b7280;
         }

         .status-divider {
             color: #d1d5db;
             font-weight: 300;
         }

         .product-mobile-actions {
             display: flex;
             gap: 8px;
             align-items: center;
         }

         .mobile-add-to-cart {
             flex: 1;
             background: #1f2937;
             color: white;
             border: none;
             border-radius: 10px;
             padding: 8px 12px;
             font-size: 13px;
             font-weight: 500;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 4px;
             cursor: pointer;
             transition: all 0.2s ease;
             position: relative;
             z-index: 10;
         }

         .mobile-add-to-cart:hover {
             background: #111827;
             transform: translateY(-1px);
         }

         .mobile-add-to-cart svg {
             width: 16px;
             height: 16px;
         }

         .mobile-action-btn {
             width: 32px;
             height: 32px;
             border-radius: 8px;
             background: #f9fafb;
             border: 1px solid #e5e7eb;
             display: flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             transition: all 0.2s ease;
             position: relative;
             z-index: 10;
         }

         .mobile-action-btn:hover {
             background: #f3f4f6;
             border-color: #d1d5db;
             transform: translateY(-1px);
         }

         .mobile-action-btn svg {
             width: 18px;
             height: 18px;
             color: #6b7280;
         }

         .mobile-action-btn.wishlist-active {
             background: #fef2f2;
             border-color: #fecaca;
         }

         .mobile-action-btn.wishlist-active svg {
             color: #dc2626;
             fill: #dc2626;
         }

         /* Collection Banner Cards */
         .collection-banner-card {
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             border-radius: 16px;
             overflow: hidden;
             margin: 10px 0;
             position: relative;
             cursor: pointer;
             transition: all 0.3s ease;
         }

         .collection-banner-card:hover {
             transform: translateY(-2px);
             box-shadow: 0 8px 24px rgba(0,0,0,0.15);
         }

         .collection-banner-content {
             padding: 16px;
             color: white;
             position: relative;
             z-index: 2;
         }

         .banner-title {
             font-size: 16px;
             font-weight: 600;
             margin-bottom: 6px;
         }

         .banner-subtitle {
             font-size: 13px;
             opacity: 0.9;
             margin-bottom: 10px;
         }

         .banner-cta {
             background: rgba(255, 255, 255, 0.2);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: white;
             padding: 6px 12px;
             border-radius: 16px;
             font-size: 11px;
             font-weight: 500;
             backdrop-filter: blur(10px);
             display: inline-block;
         }

         .collection-banner-card::before {
             content: '';
             position: absolute;
             top: 0;
             right: 0;
             width: 100px;
             height: 100px;
             background: rgba(255, 255, 255, 0.1);
             border-radius: 50%;
             transform: translate(30px, -30px);
         }

         /* Collection Controls - Sort, Filter, View */
         .collection-controls {
             background: white;
             padding: 12px 16px;
             border-bottom: 1px solid #f1f3f4;
             display: flex;
             align-items: center;
             justify-content: space-between;
             gap: 12px;
             position: sticky;
             top: 70px;
             z-index: 15;
         }

         .control-group {
             display: flex;
             align-items: center;
             gap: 8px;
         }

         .control-btn {
             background: #f8f9fa;
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             padding: 8px 12px;
             font-size: 13px;
             color: #374151;
             cursor: pointer;
             transition: all 0.2s ease;
             display: flex;
             align-items: center;
             gap: 6px;
             position: relative;
         }

         .control-btn:hover {
             background: #e5e7eb;
         }

         .control-btn.active {
             background: #1f2937;
             color: white;
             border-color: #1f2937;
         }

         .control-btn svg {
             width: 14px;
             height: 14px;
         }

         /* Sort Dropdown */
         .sort-dropdown {
             position: relative;
         }

         .sort-options {
             position: absolute;
             top: 100%;
             left: 0;
             right: 0;
             background: white;
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             box-shadow: 0 4px 12px rgba(0,0,0,0.1);
             z-index: 20;
             display: none;
             min-width: 150px;
         }

         .sort-options.show {
             display: block;
         }

         .sort-option {
             padding: 10px 12px;
             cursor: pointer;
             font-size: 13px;
             color: #374151;
             border-bottom: 1px solid #f1f3f4;
         }

         .sort-option:last-child {
             border-bottom: none;
         }

         .sort-option:hover {
             background: #f8f9fa;
         }

         .sort-option.selected {
             background: #1f2937;
             color: white;
         }

         /* Filter Modal */
         .filter-modal {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: rgba(0,0,0,0.5);
             z-index: 1000;
             display: none;
             align-items: center;
             justify-content: center;
         }

         .filter-modal.show {
             display: flex;
         }

         .filter-content {
             background: white;
             width: 90%;
             max-width: 400px;
             max-height: 80vh;
             border-radius: 16px;
             overflow: hidden;
         }

         .filter-header {
             background: #1f2937;
             color: white;
             padding: 16px;
             display: flex;
             align-items: center;
             justify-content: space-between;
         }

         .filter-close {
             background: none;
             border: none;
             color: white;
             font-size: 18px;
             cursor: pointer;
             padding: 4px;
         }

         .filter-body {
             padding: 20px;
             max-height: 60vh;
             overflow-y: auto;
         }

         .filter-section {
             margin-bottom: 24px;
         }

         .filter-section h4 {
             font-size: 14px;
             font-weight: 600;
             color: #1f2937;
             margin: 0 0 12px 0;
         }

         .filter-options {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }

         .filter-option {
             display: flex;
             align-items: center;
             gap: 8px;
             cursor: pointer;
         }

         .filter-option input[type="checkbox"] {
             margin: 0;
         }

         .filter-option label {
             font-size: 13px;
             color: #374151;
             cursor: pointer;
         }

         .filter-actions {
             padding: 16px;
             background: #f8f9fa;
             display: flex;
             gap: 12px;
         }

         .filter-btn {
             flex: 1;
             padding: 12px;
             border-radius: 8px;
             font-size: 14px;
             font-weight: 500;
             cursor: pointer;
             border: none;
             transition: all 0.2s ease;
         }

         .filter-btn.clear {
             background: white;
             color: #6b7280;
             border: 1px solid #e5e7eb;
         }

         .filter-btn.apply {
             background: #1f2937;
             color: white;
         }

         /* View Toggle Tabs at Bottom */
         .view-toggle-container {
             position: fixed;
             bottom: 0;
             left: 0;
             right: 0;
             background: white;
             border-top: 1px solid #e5e7eb;
             padding: 16px;
             z-index: 20;
             box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
         }

         .view-toggle {
             display: flex;
             background: #f8f9fa;
             border-radius: 10px;
             padding: 4px;
             gap: 4px;
         }

         .view-tab {
             flex: 1;
             background: transparent;
             border: none;
             border-radius: 8px;
             padding: 12px;
             font-size: 14px;
             font-weight: 500;
             color: #6b7280;
             cursor: pointer;
             transition: all 0.2s ease;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 8px;
         }

         .view-tab.active {
             background: white;
             color: #1f2937;
             box-shadow: 0 2px 4px rgba(0,0,0,0.1);
         }

         .view-tab svg {
             width: 16px;
             height: 16px;
         }

         /* List View Styles */
         .collection-mobile-grid.list-view {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }

         .collection-mobile-card.list-view {
             display: flex;
             flex-direction: row;
             align-items: center;
             padding: 12px;
             gap: 12px;
             border-radius: 12px;
             box-shadow: 0 2px 8px rgba(0,0,0,0.06);
             border: 1px solid #f1f3f4;
             background: white;
         }

         .product-mobile-image.list-view {
             width: 80px;
             height: 80px;
             margin: 0;
             border-radius: 8px;
             flex-shrink: 0;
         }

         .product-mobile-info.list-view {
             flex: 1;
             padding: 0;
             display: flex;
             flex-direction: column;
             gap: 4px;
         }

         .product-mobile-actions.list-view {
             flex-direction: column;
             gap: 6px;
             align-items: stretch;
             min-width: 60px;
         }

         .mobile-add-to-cart.list-view {
             padding: 6px 8px;
             font-size: 12px;
         }

         .mobile-action-btn.list-view {
             width: 28px;
             height: 28px;
         }

         /* Add bottom padding to content when view toggle is visible */
         .collection-mobile-content.with-view-toggle {
             padding-bottom: 100px;
         }

         /* Mobile responsive adjustments */
         @media screen and (max-width: 480px) {
             .collection-mobile-grid {
                 grid-template-columns: 1fr;
             }

             .product-mobile-image {
                 height: auto;
             }

             .collection-mobile-title {
                 font-size: 16px;
             }
         }

         /* Legacy mobile responsiveness for old collection cards */
         @media screen and (max-width: 749px) {
             .collection-product-card {
                 flex-direction: column;
             }

             .product-image-area {
                 width: 100%;
                 height: 200px;
                 border-radius: 8px 8px 0 0;
                 padding: 12px;
             }

             .product-details-area {
                 padding: 12px;
                 gap: 10px;
             }

             .product-details-top {
                 gap: 8px;
             }

             .product-feature-list {
                 gap: 8px;
             }

             .product-feature {
                 font-size: 10px;
                 padding: 3px 6px;
             }

             .product-feature svg {
                 width: 10px;
                 height: 10px;
             }

             .collection-add-to-cart {
                 padding: 10px 14px;
                 font-size: 13px;
             }

             .product-quick-actions {
                 opacity: 1; /* Always visible on mobile */
             }
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <div class="logo-animation">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="20" class="logo-circle"/>
                        <path d="M30 50 L50 30 L70 50 L50 70 Z" class="logo-diamond"/>
                    </svg>
                </div>
                <h1 class="splash-title">GoEye Store</h1>
                <p class="splash-subtitle">Premium Eyewear Collection</p>
            </div>
            <div class="splash-loading">
                <div class="loading-spinner">
                    <div class="spinner-circle"></div>
                    <div class="spinner-circle"></div>
                    <div class="spinner-circle"></div>
                </div>
                <p class="loading-text">Loading your experience...</p>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-bar-fill"></div>
                    </div>
                    <span class="progress-percent">0%</span>
                </div>
                <div class="loading-steps">
                    <div class="step-indicator">
                        <span class="step-dot active"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                        <span class="step-dot"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
            <!-- Permanent Safe Area Spacer (NEVER HIDDEN) -->
        <div class="safe-area-spacer"></div>
    
    <!-- Custom Header - Advanced Liquid Template Based -->
    <header class="custom-header" style="
      --header-background-color: #FFFFFF;
      --nav-background-color: #FFFFFF;
      --nav-text-color: #6B7280;
      --nav-active-color: #1E1B4B;
      --nav-hover-color: #1E1B4B;
      --nav-indicator-color: #F97316;
      --icon-color: #000000;
      --icon-hover-color: #1E1B4B;
      --drawer-background: #FFFFFF;
      --drawer-text-color: #1f2937;
      --drawer-border-color: #e5e7eb;
      --cart-count-background: #EF4444;
      --offer-button-color: #FF6B6B;
      --offer-button-color-end: #FF8E8E;">

      <!-- Menu Drawer -->
      <div class="menu-drawer">
        <div class="menu-drawer-header">
          <h2 class="menu-drawer-title">Menu</h2>
          <button type="button" class="menu-drawer-close" onclick="document.querySelector('body').classList.remove('menu-open')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            </button>
        </div>

        <div class="gender-selector">
          <button class="gender-tab active" data-gender="men">
            <span>Men</span>
          </button>
          <button class="gender-tab" data-gender="women">
            <span>Women</span>
          </button>
            </div>
      </div>
      <div class="menu-drawer-overlay" onclick="document.querySelector('body').classList.remove('menu-open')"></div>
      
      <!-- Sticky Header Container -->
      <div class="custom-header-wrapper">
      <!-- Announcement Bar -->
      <div class="announcement-bar" id="announcement-bar" style="display: block;">
        <div class="announcement-content">
          <span class="announcement-text" id="announcement-text">Free shipping on orders over $50! 🚚</span>
        </div>
      </div>
        <div class="custom-header-top">
          <div class="custom-header-left">
            <button type="button" onclick="document.querySelector('body').classList.toggle('menu-open')" title="Menu">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            
            <a href="#" class="offer-button pulse">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
              </svg>
              <span>50% OFF</span>
            </a>
        </div>
        
          <div class="custom-header-center">
            <div class="custom-header-logo">
              <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=100&h=50&fit=crop&q=80" alt="GoEye Logo" loading="lazy">
            </div>
          </div>

          <div class="custom-header-right">
            <a href="/pages/wishlist" title="Wishlist">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
            </a>

            <a href="/account" title="Account">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
            </a>

            <a href="#" class="header-cart-link" title="Cart" onclick="toggleCart()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
              <span class="cart-count-bubble" style="display: none;">0</span>
            </a>
            </div>
        </div>

        <div class="custom-header-search">
          <form action="/search" method="get">
            <input type="text" name="q" value="">
            <span class="search-placeholder-text">Search products...</span>
            <span class="search-placeholder-text">Free Cash on Delivery</span>
            <button type="submit">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z" />
                </svg>
            </button>
          </form>
        </div>

        <nav class="custom-header-nav">
          <ul class="nav-tabs" id="nav-tabs">
            <li>
              <a href="#" class="active">
                <span class="nav-tab-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                </span>
                All
              </a>
            </li>
            <li>
              <a href="#">
                <span class="nav-tab-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                </svg>
                </span>
                Classic
                <span class="nav-indicator"></span>
              </a>
            </li>
            <li>
              <a href="#">
                <span class="nav-tab-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                </span>
                Premium
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Trending Section - Outside of sticky header -->
      <div class="trending-section" style="--trending-background: #f8f9fa;">
        <div class="trending-header">
          <h2 class="trending-title">#Trending On <span>GoEye</span></h2>
        </div>
        
        <div class="trending-slider">
          <div class="trending-items">
            <!-- Trending slides will be loaded dynamically from admin settings -->
          </div>
        </div>
      </div>

    <!-- Product Categories Section -->
    <div class="categories-section" id="categories-section">
        <div class="category-block">
            <div class="category-header">
                <h2 class="category-title">Eyeglasses</h2>
            </div>
            
            <div class="subcategories">
                <a href="#" class="subcategory-card" data-category="men">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/men.jpg?v=1750675041" alt="Men Eyeglasses">
                    </div>
                    <div class="subcategory-title">Men</div>
                </a>
                
                <a href="#" class="subcategory-card" data-category="women">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/women.jpg?v=1750675041" alt="Women Eyeglasses">
                    </div>
                    <div class="subcategory-title">Women</div>
                </a>
                
                <a href="#" class="subcategory-card" data-category="kids">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/kid-1.jpg?v=1750675041" alt="Kids Eyeglasses">
                    </div>
                    <div class="subcategory-title">Kids</div>
                </a>
                
                <a href="#" class="subcategory-card essentials-card" data-category="essentials">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/kid_copy_2.jpg?v=1750675041" alt="Essentials Eyeglasses">
                    </div>
                    <div class="subcategory-title">Essentials</div>
                </a>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div class="category-overlay" id="category-overlay"></div>

    <!-- Category Drawer -->
    <div class="category-drawer" id="category-drawer">
        <div class="drawer-header">
            <div class="drawer-title">
                <span id="drawer-category-title">Category Title</span>
                <button class="close-drawer" type="button" onclick="closeCategoryDrawer()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                </button>
            </div>
        </div>
        <div class="drawer-content">
            <!-- Men's Products -->
            <div class="category-product-grid" id="men-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=100&h=100&fit=crop&crop=center&q=80" alt="John Jacobs">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">John Jacobs</div>
                        <div class="category-product-price">Starts at ₹3500</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=100&h=100&fit=crop&crop=center&q=80" alt="Vincent Chase">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Vincent Chase</div>
                        <div class="category-product-price">Starts at ₹1500</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
            </div>

            <!-- Women's Products -->
            <div class="category-product-grid" id="women-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=100&h=100&fit=crop&crop=center&q=80" alt="Vincent Chase">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Vincent Chase</div>
                        <div class="category-product-price">Starts at ₹1500</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=100&h=100&fit=crop&crop=center&q=80" alt="Lenskart Air">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Lenskart Air</div>
                        <div class="category-product-price">Starts at ₹2000</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
            </div>

            <!-- Kids' Products -->
            <div class="category-product-grid" id="kids-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=100&h=100&fit=crop&crop=center&q=80" alt="Hustlr">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Hustlr</div>
                        <div class="category-product-price">Starts at ₹1500</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1508296695146-257a814070b4?w=100&h=100&fit=crop&crop=center&q=80" alt="Kids Special">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Kids Special</div>
                        <div class="category-product-price">Starts at ₹1200</div>
                        <div class="category-product-offer">Free lenses + Extra ₹333 Off</div>
                    </div>
                </a>
            </div>

            <!-- Essentials Products -->
            <div class="category-product-grid" id="essentials-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1508296695146-257a814070b4?w=100&h=100&fit=crop&crop=center&q=80" alt="Essentials">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Essentials</div>
                        <div class="category-product-price">Starts at ₹800</div>
                        <div class="category-product-offer">60% Off + Free lenses</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=100&h=100&fit=crop&crop=center&q=80" alt="Budget Frames">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Budget Frames</div>
                        <div class="category-product-price">Starts at ₹600</div>
                        <div class="category-product-offer">60% Off + Free lenses</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Sunglasses Categories Section -->
    <div class="categories-section" id="sunglasses-categories-section">
        <div class="category-block">
            <div class="category-header">
                <h2 class="category-title">Sunglasses</h2>
            </div>
            
            <div class="subcategories">
                <a href="#" class="subcategory-card" data-category="men-sunglasses">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/men_copy.jpg?v=1750675042" alt="Men Sunglasses">
                    </div>
                    <div class="subcategory-title">Men</div>
                </a>
                
                <a href="#" class="subcategory-card" data-category="women-sunglasses">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/women_copy_2.jpg?v=1750675041" alt="Women Sunglasses">
                    </div>
                    <div class="subcategory-title">Women</div>
                </a>
                
                <a href="#" class="subcategory-card" data-category="kids-sunglasses">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/kid.jpg?v=1750675041" alt="Kids Sunglasses">
                    </div>
                    <div class="subcategory-title">Kids</div>
                </a>
                
                <a href="#" class="subcategory-card essentials-card" data-category="essentials-sunglasses">
                    <div class="subcategory-image">
                        <img src="https://goeye.in/cdn/shop/files/kid_copy_3.jpg?v=1750675040" alt="Essentials Sunglasses">
                    </div>
                    <div class="subcategory-title">Essentials</div>
                </a>
            </div>
        </div>
    </div>

    <!-- Sunglasses Overlay -->
    <div class="category-overlay" id="sunglasses-category-overlay"></div>

    <!-- Sunglasses Category Drawer -->
    <div class="category-drawer" id="sunglasses-category-drawer">
        <div class="drawer-header">
            <div class="drawer-title">
                <span id="sunglasses-drawer-category-title">Category Title</span>
                <button class="close-drawer" type="button" onclick="closeSunglassesCategoryDrawer()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                </button>
            </div>
        </div>
        <div class="drawer-content">
            <!-- Men's Sunglasses Products -->
            <div class="category-product-grid" id="men-sunglasses-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1473496169904-658ba7c44d8a?w=100&h=100&fit=crop&crop=center&q=80" alt="Ray-Ban">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Ray-Ban</div>
                        <div class="category-product-price">Starts at ₹4500</div>
                        <div class="category-product-offer">Free case + Extra ₹500 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1508296695146-257a814070b4?w=100&h=100&fit=crop&crop=center&q=80" alt="Oakley">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Oakley</div>
                        <div class="category-product-price">Starts at ₹3200</div>
                        <div class="category-product-offer">Free case + Extra ₹500 Off</div>
                    </div>
                </a>
            </div>

            <!-- Women's Sunglasses Products -->
            <div class="category-product-grid" id="women-sunglasses-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1508296695146-257a814070b4?w=100&h=100&fit=crop&crop=center&q=80" alt="Vincent Chase">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Vincent Chase</div>
                        <div class="category-product-price">Starts at ₹2500</div>
                        <div class="category-product-offer">Free case + Extra ₹500 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=100&h=100&fit=crop&crop=center&q=80" alt="Lenskart Air">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Lenskart Air</div>
                        <div class="category-product-price">Starts at ₹2800</div>
                        <div class="category-product-offer">Free case + Extra ₹500 Off</div>
                    </div>
                </a>
            </div>

            <!-- Kids' Sunglasses Products -->
            <div class="category-product-grid" id="kids-sunglasses-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=100&h=100&fit=crop&crop=center&q=80" alt="Kids Fun">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Kids Fun</div>
                        <div class="category-product-price">Starts at ₹1800</div>
                        <div class="category-product-offer">Free case + Extra ₹400 Off</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1583394838336-acd977736f90?w=100&h=100&fit=crop&crop=center&q=80" alt="Junior Shades">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Junior Shades</div>
                        <div class="category-product-price">Starts at ₹1500</div>
                        <div class="category-product-offer">Free case + Extra ₹400 Off</div>
                    </div>
                </a>
            </div>

            <!-- Essentials Sunglasses Products -->
            <div class="category-product-grid" id="essentials-sunglasses-products" style="display: none;">
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1583394838336-acd977736f90?w=100&h=100&fit=crop&crop=center&q=80" alt="Budget Sunglasses">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Budget Sunglasses</div>
                        <div class="category-product-price">Starts at ₹1200</div>
                        <div class="category-product-offer">70% Off + Free case</div>
                    </div>
                </a>
                <a href="#" class="category-product-card">
                    <div class="category-product-image">
                        <img src="https://images.unsplash.com/photo-1473496169904-658ba7c44d8a?w=100&h=100&fit=crop&crop=center&q=80" alt="Summer Shades">
                    </div>
                    <div class="category-product-info">
                        <div class="category-product-brand">Summer Shades</div>
                        <div class="category-product-price">Starts at ₹900</div>
                        <div class="category-product-offer">70% Off + Free case</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

            <!-- Shark Tank Products Section -->
        <div class="shark-tank-section" id="shark-tank-section">
            <div class="section-header">
                <h2 class="section-title" id="shark-tank-title">As Seen on Shark Tank India</h2>
                <p class="section-subtitle" id="shark-tank-subtitle">Style it like the Sharks!</p>
            </div>
            
            <div class="shark-tank-slider">
                <div class="shark-tank-slider__track" id="shark-tank-track">
                    <!-- Dynamic Shark Tank products will be loaded here -->
                    <div class="loading">Loading Shark Tank products...</div>
                </div>
            </div>
        </div>

        <!-- Looks Section -->
        <div class="looks-section" id="looks-section">
            <div class="looks-header" id="looks-header">
                <h2 class="looks-title">
                    <span class="looks-title-cursive" id="looks-title-cursive">Style</span>
                    <strong class="looks-title-bold" id="looks-title-bold">FINDER</strong>
                </h2>
                <p class="looks-subtitle" id="looks-subtitle">Discover every look, for every you</p>
            </div>

            <div class="looks-content">
                <!-- Men's Row -->
                <div class="looks-row">
                    <div class="looks-grid" id="men-looks-grid">
                        <!-- Men's explore card and style cards will be loaded here -->
                        <div class="loading">Loading men's looks...</div>
                    </div>
                </div>

                <!-- Women's Row -->
                <div class="looks-row">
                    <div class="looks-grid" id="women-looks-grid">
                        <!-- Women's explore card and style cards will be loaded here -->
                        <div class="loading">Loading women's looks...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Drops Section -->
        <div class="new-drops-section" id="new-drops-section">
            <div class="new-drops-header">
                <h2 class="new-drops-title" id="new-drops-title">New Drops</h2>
                <p class="new-drops-subtitle" id="new-drops-subtitle">Fresh collections every 15 days</p>
            </div>
            
            <div class="banner-card" id="banner-card">
                <div class="banner-slideshow" id="banner-slideshow">
                    <!-- Slides will be populated by JavaScript -->
                </div>
            </div>
        </div>

    <!-- Collections Section -->
    <div class="collections-section">
        <h2 class="collections-title">Collections</h2>
        <div class="collections-grid" id="collections-grid">
            <div class="loading">Loading collections...</div>
        </div>
    </div>

    <!-- Products Section -->
    <div class="products-section" id="home-content">
        <h2 class="products-title">Featured Products</h2>
        <div class="products-grid" id="products-grid">
            <div class="loading">Loading products...</div>
        </div>
    </div>

    <!-- Collection Content -->
    <div class="collection-content" id="collection-content" style="display: none;">
        <div class="products-grid" id="collection-products-grid">
            <div class="loading">Loading collection...</div>
        </div>
    </div>

    <!-- Collections Content -->
    <div class="collections-content" id="collections-content" style="display: none;">
        <div class="collections-grid" id="collections-grid-page">
            <div class="loading">Loading collections...</div>
        </div>
    </div>

    <!-- Account Content -->
    <div class="account-content" id="account-content" style="display: none;">
        <div class="account-info">
            <h2>Account</h2>
            <p>Coming soon!</p>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cart-overlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2>Shopping Cart</h2>
            <button class="cart-close" onclick="toggleCart()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        <div class="cart-items" id="cart-items">
            <div class="empty-cart">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin-bottom: 16px;">
                    <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                    <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                    <path d="M1 1H5L7.68 14.39A2 2 0 009.65 16H19.4A2 2 0 0021.36 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
                </svg>
                <p>Your cart is empty</p>
                <p style="font-size: 0.9em; opacity: 0.7;">Add some eyewear to get started</p>
            </div>
        </div>
        <div class="cart-total" id="cart-total" style="display: none;">
            <div class="cart-total-amount">Total: ₹<span id="total-amount">0</span></div>
            <button class="checkout-btn" onclick="checkout()">Proceed to Checkout</button>
        </div>
    </div>

    <!-- Image Slider -->
    <div class="image-slider" id="image-slider">
        <div class="slider-container">
            <div class="slider-track" id="slider-track">
                <!-- Slides will be generated by JavaScript -->
            </div>
            
            <!-- Navigation arrows -->
            <button class="slider-nav slider-prev" id="slider-prev" onclick="previousSlide()" style="display: none;">
                ‹
            </button>
            <button class="slider-nav slider-next" id="slider-next" onclick="nextSlide()" style="display: none;">
                ›
            </button>
            
            <!-- Dots indicator -->
            <div class="slider-dots" id="slider-dots" style="display: none;">
                <!-- Dots will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-page="home" onclick="showPage('home')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9.5L12 3L21 9.5V20.5A1 1 0 0120 21.5H4A1 1 0 013 20.5V9.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <polyline points="9,22 9,12 15,12 15,22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="nav-label">Home</span>
        </a>
        <a href="#" class="nav-item" data-page="collections" onclick="showPage('collections')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                <rect x="14" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                <rect x="3" y="14" width="7" height="7" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span class="nav-label">Collections</span>
        </a>
        <a href="#" class="nav-item" data-page="cart" onclick="toggleCart()">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                <path d="M1 1H5L7.68 14.39A2 2 0 009.65 16H19.4A2 2 0 0021.36 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="nav-label">Cart</span>
            <span class="cart-badge" id="cart-badge" style="display: none;">0</span>
        </a>
        <a href="#" class="nav-item" data-page="account" onclick="showPage('account')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21V19A4 4 0 0016 15H8A4 4 0 004 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
            <span class="nav-label">Account</span>
        </a>
    </nav>

    <!-- External Page Overlay -->
    <div id="externalPageOverlay" class="external-page-overlay" style="display: none;">
        <div class="external-page-container">
            <div class="external-page-header" id="externalPageHeader" style="display: none;">
                <div class="external-page-title" id="externalPageTitle">Classic</div>
                <button class="external-page-close" onclick="closeExternalPage()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <iframe id="externalPageFrame" class="external-page-iframe" frameborder="0"></iframe>
        </div>
    </div>

    <script>
        // Global variables
        let currentView = 'home';
        let collections = [];
        let products = [];
        let cart = [];
        let sliderSettings = {
            enabled: false,
            slides: [],
            autoPlay: false,
            autoPlaySpeed: 5000,
            showArrows: false,
            showDots: false
        };

        // API Configuration - Updated Vercel URL for APK
        // Fixed API Base for Mobile Apps - Always use HTTPS
        const API_BASE = 'https://app-banao-git-main-voyageeyewears-projects.vercel.app';
        console.log('🔗 API_BASE set to:', API_BASE);

                // CSS-only solution - no JavaScript needed
        console.log('📱 Using pure CSS solution for header spacing');

        // Dynamic Header Height Adjustment for Fixed Header
        function adjustContentForFixedHeader() {
            console.log('📏 Content adjustment disabled - using static spacing to avoid safe area duplication');
            // Removed dynamic spacing that was causing triple safe area application
        }

        // Zero body manipulation approach to preserve safe area completely
        
        // Helper functions to show/hide main content sections
        function hideMainContent(useOpacity = false) {
            const sections = [
                document.querySelector('.trending-section'),
                document.getElementById('home-content'),
                document.querySelector('.categories-section'),
                document.querySelector('.looks-section'),
                document.querySelector('.shark-tank-section'),
                document.querySelector('.new-drops-section')
            ];
            
            sections.forEach(element => {
                if (element) {
                    if (useOpacity) {
                        element.style.opacity = '0';
                    } else {
                        element.style.display = 'none';
                        element.style.visibility = 'hidden';
                    }
                }
            });
        }
        
        function showMainContent() {
            // CRITICAL FIX: Remove hide-header class when showing main content
            document.body.classList.remove('hide-header');
            console.log('🏠 HOMEPAGE FIX: Removed hide-header class');
            
            const sections = [
                document.querySelector('.trending-section'),
                document.getElementById('home-content'),
                document.querySelector('.categories-section'),
                document.querySelector('.looks-section'),
                document.querySelector('.shark-tank-section'),
                document.querySelector('.new-drops-section')
            ];
            
            sections.forEach(element => {
                if (element) {
                    element.style.display = '';
                    element.style.visibility = '';
                    element.style.opacity = '';
                }
            });
        }
        
        // Fallback URLs to try if main API fails
        const FALLBACK_APIS = [
            'https://app-banao.vercel.app',
            'https://app-banao-2jaq7x5ik-voyageeyewears-projects.vercel.app'
        ];
        const STOREFRONT_ACCESS_TOKEN = 'your-storefront-access-token';
        const SHOP_DOMAIN = 'your-shop.myshopify.com';
        
        // Debug API_BASE
        console.log('API_BASE:', API_BASE);
        console.log('Protocol:', window.location.protocol);
        console.log('Location origin:', window.location.origin);

        // Utility Functions
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 24px;
                font-size: 14px;
                z-index: 10000;
                animation: slideUp 0.3s ease;
                backdrop-filter: blur(10px);
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // External Page Functions
        function loadExternalPage(url) {
            console.log('🚀 Loading external page:', url);
            console.log('🔍 Current iframe src:', document.getElementById('externalPageFrame')?.src || 'empty');
            
            const overlay = document.getElementById('externalPageOverlay');
            const iframe = document.getElementById('externalPageFrame');
            const titleElement = document.getElementById('externalPageTitle');
            const headerElement = document.getElementById('externalPageHeader');
            
            if (!overlay || !iframe) {
                console.error('External page overlay elements not found');
                showToast('❌ Error loading page');
                return;
            }
            
            // Set page title based on URL
            let pageTitle = '';
            let hideHeader = false;
            
            if (url.includes('classic-collection')) {
                pageTitle = 'Classic';
                hideHeader = true; // Hide header for classic tab since it has its own header
            } else if (url.includes('premium-collection')) {
                pageTitle = 'Premium';
            } else if (url.includes('sport-collection')) {
                pageTitle = 'Sport';
            } else if (url.includes('trendy-collection')) {
                pageTitle = 'Trendy';
            } else if (url.includes('product-detail-page')) {
                // Hide header completely for product detail pages
                hideHeader = true;
                pageTitle = '';
            }
            
            if (titleElement && pageTitle) {
                titleElement.textContent = pageTitle;
            }
            
            // Show/hide header based on page type
            if (headerElement) {
                headerElement.style.display = hideHeader ? 'none' : 'flex';
            }
            
            // CRITICAL: Always reset iframe completely for ALL tabs
            console.log('🔄 Resetting iframe for fresh load...');
            
            // Force complete iframe reset
            iframe.src = 'about:blank';
            
            // Clear any cached content
            setTimeout(() => {
                console.log('📄 Setting new iframe source:', url);
                iframe.src = url;
                
                // Show overlay with loading state
                overlay.style.display = 'flex';
                overlay.style.opacity = '0';
                
                // Animate overlay in
                requestAnimationFrame(() => {
                    overlay.style.transition = 'opacity 0.3s ease';
                    overlay.style.opacity = '1';
                });
                
                // Handle iframe load completion
                iframe.onload = function() {
                    console.log('✅ External page loaded successfully:', url);
                    showToast('Page loaded successfully!');
                };
                
                iframe.onerror = function() {
                    console.error('❌ Failed to load external page:', url);
                    showToast('❌ Failed to load page. Please try again.');
                    closeExternalPage();
                };
                
            }, 100); // Small delay to ensure reset takes effect
        }

        function setupIframeHandlers(iframe, url) {
            console.log('📋 Setting up iframe handlers for:', url);
            
            // Handle iframe load with faster feedback
            let loadTimeout = setTimeout(() => {
                console.warn('Page load taking longer than expected');
                showToast('⚠️ Still loading...');
            }, 2000);
            
            iframe.onload = function() {
                clearTimeout(loadTimeout);
                console.log('✅ External page loaded successfully:', iframe.src);
                showToast('✅ Ready!');
                
                // Mark iframe as loaded
                iframe.setAttribute('data-loaded', 'true');
                iframe.setAttribute('data-url', url);
            };
            
            iframe.onerror = function() {
                clearTimeout(loadTimeout);
                console.error('❌ Failed to load external page:', url);
                showToast('❌ Failed to load. Retrying...');
                
                // Try reloading after error with fresh iframe
                setTimeout(() => {
                    console.log('🔄 Retrying iframe load with fresh reset...');
                    // Force a complete reload by calling loadExternalPage again
                    loadExternalPage(url);
                }, 1000);
            };
        }

        function showOverlayDirectly() {
            const overlay = document.getElementById('externalPageOverlay');
            if (!overlay) return;
            
            overlay.style.display = 'flex';
            overlay.style.opacity = '0';
            
            setTimeout(() => {
                overlay.style.transition = 'opacity 0.3s ease';
                overlay.style.opacity = '1';
            }, 10);
        }

        function closeExternalPage() {
            console.log('🔙 Closing external page');
            
            const overlay = document.getElementById('externalPageOverlay');
            const iframe = document.getElementById('externalPageFrame');
            
            if (!overlay) {
                console.error('External page overlay not found');
                return;
            }
            
            // Hide overlay with smooth animation
            overlay.style.transition = 'opacity 0.3s ease';
            overlay.style.opacity = '0';
            
            setTimeout(() => {
                overlay.style.display = 'none';
                console.log('✅ External page overlay hidden - ready for next load');
                
                // Clear iframe handlers to prevent memory leaks
                if (iframe) {
                    iframe.onload = null;
                    iframe.onerror = null;
                }
            }, 300);
        }

        // Listen for messages from external pages
        window.addEventListener('message', function(event) {
            if (event.data && event.data.action === 'goBack') {
                console.log('Received goBack message from external page');
                closeExternalPage();
            } else if (event.data && event.data.action === 'navigateToCollection') {
                console.log('🔗 Navigating to collection:', event.data.collection);
                closeExternalPage();
                handleCollectionNavigation(event.data.collection);
            } else if (event.data && event.data.action === 'showProductDetails') {
                console.log('🔍 Showing product details:', event.data.product);
                closeExternalPage();
                handleProductNavigation(event.data.product);
            }
        });

        // Handle collection navigation from slider
        function handleCollectionNavigation(collectionHandle) {
            console.log('📋 Opening collection:', collectionHandle);
            
            // Filter products by collection (if we have that capability)
            // For now, show a toast and could implement collection filtering
            showToast(`Opening ${collectionHandle} collection...`);
            
            // Could implement actual collection filtering here
            // filterProductsByCollection(collectionHandle);
        }

        // Handle product navigation from slider
        function handleProductNavigation(productHandle) {
            console.log('🔍 Opening product:', productHandle);
            
            // Load external product detail page
            loadProductDetailPage(productHandle);
        }

        // Load product detail page
        async function loadProductDetailPage(productHandle) {
            console.log('📱 Loading product detail page for:', productHandle);
            
            try {
                // Fetch product data first
                const product = await findProductByHandle(productHandle);
                
                if (product) {
                    console.log('✅ Product found, using embedded template:', product.title);
                    // Use embedded product detail page instead of external file
                    openProductDetailPage(product);
                } else {
                    console.warn('❌ Product not found, using fallback');
                    // Fallback to a default product with the handle
                                         const fallbackProduct = {
                         handle: productHandle,
                         title: 'Eyejack Premium Eyewear Collection',
                         price: '₹899',
                         originalPrice: '₹1399',
                         discount: 36,
                         description: 'Premium quality eyewear featuring advanced materials and superior craftsmanship. These glasses combine style with comfort, perfect for everyday wear. Anti-reflective coating and UV protection included.',
                         images: [
                             'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop&q=80',
                             'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=400&fit=crop&q=80'
                         ],
                         rating: 4.5,
                         ratingCount: 150,
                         isNew: true
                     };
                    openProductDetailPage(fallbackProduct);
                }
            } catch (error) {
                console.error('❌ Error loading product:', error);
                // Use fallback product
                                 const fallbackProduct = {
                     handle: productHandle,
                     title: 'Eyejack Classic Sunglasses Collection',
                     price: '₹799',
                     originalPrice: '₹1199',
                     discount: 33,
                     description: 'Classic design meets modern functionality. These sunglasses feature premium polarized lenses with UV400 protection. Lightweight frame ensures comfort during extended wear.',
                     images: [
                         'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop&q=80',
                         'https://images.unsplash.com/photo-1556306535-38febf6782e7?w=400&h=400&fit=crop&q=80'
                     ],
                     rating: 4.5,
                     ratingCount: 150,
                     isNew: false
                 };
                openProductDetailPage(fallbackProduct);
            }
        }

        // Show product by handle
        async function showProductByHandle(handle) {
            try {
                console.log('🔍 Fetching product details for:', handle);
                
                const response = await fetch(`${API_BASE}/api/product-detail?handle=${handle}`);
                const data = await response.json();
                
                if (data.success && data.product) {
                    // Show product in modal (reuse existing product detail modal)
                    showProductDetailModal(data.product);
                    showToast(`✅ Opened: ${data.product.title}`);
                } else {
                    throw new Error(data.error || 'Product not found');
                }
            } catch (error) {
                console.error('❌ Error fetching product:', error);
                showToast(`❌ Could not open product: ${handle}`);
            }
        }


        // Category Drawer Functions
        function openCategoryDrawer(category) {
            console.log('Opening eyeglass category drawer for:', category);
            const drawer = document.getElementById('category-drawer');
            const overlay = document.getElementById('category-overlay');
            const categoryTitle = document.getElementById('drawer-category-title');
            
            if (!drawer || !overlay || !categoryTitle) {
                console.error('Missing drawer elements');
                return;
            }
            
            // Hide all product grids
            drawer.querySelectorAll('.category-product-grid').forEach(function(grid) {
                grid.style.display = 'none';
            });
            
            // Show the selected category's products
            const gridId = category + '-products';
            const productGrid = document.getElementById(gridId);
            console.log('Looking for grid:', gridId, 'Found:', !!productGrid);
            
            if (productGrid) {
                // If we have global products data, dynamically populate the grid
                if (window.eyeglassProducts && window.eyeglassProducts.length > 0) {
                    const categoryProducts = window.eyeglassProducts.filter(product => 
                        product.category === category || 
                        product.category === category.toLowerCase() ||
                        product.id.includes(category)
                    );
                    
                    if (categoryProducts.length > 0) {
                        const initialProducts = categoryProducts.slice(0, 2);
                        const remainingProducts = categoryProducts.slice(2);
                        
                        // Add dynamic sale banner using helper function
                        let productHTML = createSaleBannerHTML(window.eyeglassesSaleBanner, '#d32f2f');
                        
                        // Add initial products
                        productHTML += initialProducts.map((product, index) => {
                            const getBadge = (product, index) => {
                                if (product.brand?.toLowerCase().includes('premium') || index === 0) {
                                    return '<div class="category-product-badge premium">PREMIUM</div>';
                                }
                                if (product.brand?.toLowerCase().includes('shark') || index === 2) {
                                    return '<div class="category-product-badge shark-tank">AS SEEN ON SHARK TANK</div>';
                                }
                                return '';
                            };
                            
                            return `
                                <a href="#" class="category-product-card">
                                    <div class="category-product-image">
                                        ${getBadge(product, index)}
                                        <img src="${product.image || 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=100&h=100&fit=crop'}" alt="${product.brand || product.title}">
                                    </div>
                                    <div class="category-product-info">
                                        <div class="category-product-brand">${product.brand || product.title}</div>
                                        <div class="category-product-price">Starts at ₹${product.price}</div>
                                        <div class="category-product-offer">${product.offer || 'with premium designs'}</div>
                                    </div>
                                </a>
                            `;
                        }).join('');
                        
                        // Add hidden products
                        if (remainingProducts.length > 0) {
                            productHTML += remainingProducts.map((product, index) => {
                                const getBadge = (product, index) => {
                                    const actualIndex = index + 2; // Offset by initial products
                                    if (product.brand?.toLowerCase().includes('premium') || actualIndex === 0) {
                                        return '<div class="category-product-badge premium">PREMIUM</div>';
                                    }
                                    if (product.brand?.toLowerCase().includes('shark') || actualIndex === 2) {
                                        return '<div class="category-product-badge shark-tank">AS SEEN ON SHARK TANK</div>';
                                    }
                                    return '';
                                };
                                
                                return `
                                    <a href="#" class="category-product-card hidden-product" style="display: none;">
                                        <div class="category-product-image">
                                            ${getBadge(product, index)}
                                            <img src="${product.image || 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=100&h=100&fit=crop'}" alt="${product.brand || product.title}">
                                        </div>
                                        <div class="category-product-info">
                                            <div class="category-product-brand">${product.brand || product.title}</div>
                                            <div class="category-product-price">Starts at ₹${product.price}</div>
                                            <div class="category-product-offer">${product.offer || 'with premium designs'}</div>
                                        </div>
                                    </a>
                                `;
                            }).join('');
                            
                            // Show all products directly - no "View More" button needed
                        }
                        
                        productGrid.innerHTML = productHTML;
                        console.log(`✅ Dynamically loaded ${categoryProducts.length} products for ${category}`);
                    }
                }
                
                productGrid.style.display = 'flex';
            }
            
            // Set category title
            categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1);
            
            // Show drawer and overlay
            drawer.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Add sale banner using new system
            setTimeout(() => {
                showBannerInDrawer(category, 'eyeglasses');
            }, 100);
            
            console.log('✅ Eyeglass drawer opened for:', category);
        }

        function closeCategoryDrawer() {
            const drawer = document.getElementById('category-drawer');
            const overlay = document.getElementById('category-overlay');
            
            drawer.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Sunglasses Category Drawer Functions
        function openSunglassesCategoryDrawer(category) {
            console.log('Opening sunglasses category drawer for:', category);
            const drawer = document.getElementById('sunglasses-category-drawer');
            const overlay = document.getElementById('sunglasses-category-overlay');
            const categoryTitle = document.getElementById('sunglasses-drawer-category-title');
            
            if (!drawer || !overlay || !categoryTitle) {
                console.error('Missing sunglasses drawer elements');
                return;
            }
            
            // Hide all product grids
            drawer.querySelectorAll('.category-product-grid').forEach(function(grid) {
                grid.style.display = 'none';
            });
            
            // Show the selected category's products
            const gridId = category + '-products';
            const productGrid = document.getElementById(gridId);
            console.log('Looking for sunglasses grid:', gridId, 'Found:', !!productGrid);
            
            if (productGrid) {
                // If we have global products data, dynamically populate the grid
                if (window.sunglassProducts && window.sunglassProducts.length > 0) {
                    const categoryProducts = window.sunglassProducts.filter(product => 
                        product.category === category || 
                        product.category === category.toLowerCase() ||
                        product.id.includes(category)
                    );
                    
                    if (categoryProducts.length > 0) {
                        // Add dynamic sale banner using helper function
                        let productHTML = createSaleBannerHTML(window.sunglassesSaleBanner, '#ff6b35');
                        
                        // Add all products
                        productHTML += categoryProducts.map((product, index) => {
                            const getBadge = (product, index) => {
                                if (product.brand?.toLowerCase().includes('premium') || index === 0) {
                                    return '<div class="category-product-badge premium">PREMIUM</div>';
                                }
                                if (product.brand?.toLowerCase().includes('shark') || index === 2) {
                                    return '<div class="category-product-badge shark-tank">AS SEEN ON SHARK TANK</div>';
                                }
                                return '';
                            };
                            
                            const getOffer = (product, index) => {
                                const offers = [
                                    'with premium designs',
                                    'with 100% UV protection', 
                                    'with flexible material',
                                    '60% Off | limited range'
                                ];
                                return offers[index] || product.offer || 'with premium designs';
                            };
                            
                            return `
                                <a href="#" class="category-product-card">
                                    <div class="category-product-image">
                                        ${getBadge(product, index)}
                                        <img src="${product.image || 'https://images.unsplash.com/photo-1556306535-38febf6782e7?w=100&h=100&fit=crop'}" alt="${product.brand || product.title}">
                                    </div>
                                    <div class="category-product-info">
                                        <div class="category-product-brand">${product.brand || product.title}</div>
                                        <div class="category-product-price">Starts at ₹${product.price}</div>
                                        <div class="category-product-offer">${getOffer(product, index)}</div>
                                    </div>
                                </a>
                            `;
                        }).join('');
                        
                        productGrid.innerHTML = productHTML;
                        console.log(`✅ Dynamically loaded ${categoryProducts.length} sunglasses products for ${category}`);
                    }
                }
                
                productGrid.style.display = 'flex';
            }
            
            // Set category title
            const categoryName = category.replace('-sunglasses', '');
            categoryTitle.textContent = categoryName.charAt(0).toUpperCase() + categoryName.slice(1) + ' Sunglasses';
            
            // Show drawer and overlay
            drawer.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Add sale banner using new system
            setTimeout(() => {
                showBannerInDrawer(category, 'sunglasses');
            }, 100);
            
            console.log('✅ Sunglasses drawer opened for:', category);
        }

        function closeSunglassesCategoryDrawer() {
            const drawer = document.getElementById('sunglasses-category-drawer');
            const overlay = document.getElementById('sunglasses-category-overlay');
            
            drawer.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }



        // Initialize Category Section with Robust Event Delegation
        function initializeCategorySection() {
            console.log('🔧 Initializing category section...');
            
            const overlay = document.getElementById('category-overlay');
            const sunglassesOverlay = document.getElementById('sunglasses-category-overlay');
            
            // Close drawer when overlay is clicked
            if (overlay) {
                overlay.addEventListener('click', closeCategoryDrawer);
                console.log('✅ Eyeglasses overlay event listener added');
            } else {
                console.error('❌ Eyeglasses overlay not found');
            }
            
            if (sunglassesOverlay) {
                sunglassesOverlay.addEventListener('click', closeSunglassesCategoryDrawer);
                console.log('✅ Sunglasses overlay event listener added');
            } else {
                console.error('❌ Sunglasses overlay not found');
            }
            
            // Remove any existing event listeners to prevent duplicates
            document.body.removeEventListener('click', handleCategoryClick);
            
            // Add fresh event listener with proper delegation
            document.body.addEventListener('click', handleCategoryClick);
            
            console.log('✅ Category section initialized with event delegation for', document.querySelectorAll('.subcategory-card').length, 'cards');
        }

        // Separate click handler function for better debugging
        function handleCategoryClick(e) {
            // Check if clicked element or its parent is a subcategory card
            const subcategoryCard = e.target.closest('.subcategory-card');
            
            if (subcategoryCard) {
                e.preventDefault();
                e.stopPropagation();
                
                const category = subcategoryCard.getAttribute('data-category');
                console.log('🔥 Category card clicked:', category);
                console.log('📍 Card element:', subcategoryCard);
                
                if (category) {
                    if (category.includes('sunglasses')) {
                        console.log('🕶️ Opening sunglasses drawer for:', category);
                        openSunglassesCategoryDrawer(category);
                    } else {
                        console.log('👓 Opening eyeglasses drawer for:', category);
                        openCategoryDrawer(category);
                    }
                } else {
                    console.error('⚠️ No category data found for clicked card');
                    console.log('Card HTML:', subcategoryCard.outerHTML);
                }
            }
        }

        // Initialize Sunglasses Category Section (handled by main initializeCategorySection)
        function initializeSunglassesCategorySection() {
            console.log('✅ Sunglasses category section initialized (handled by main function)');
        }

        // Initialize Shark Tank Section
        function initializeSharkTankSection() {
            console.log('🦈 Initializing Shark Tank section...');
            
            // Load shark tank data from API
            loadSharkTankData();
        }

        // Load Shark Tank data from live API
        async function loadSharkTankData(silent = false) {
            const sharkTankTrack = document.getElementById('shark-tank-track');
            const sharkTankTitle = document.getElementById('shark-tank-title');
            const sharkTankSubtitle = document.getElementById('shark-tank-subtitle');
            
            if (!sharkTankTrack) {
                console.log('⚠️ Shark Tank track element not found');
                return;
            }

            try {
                console.log(`🦈 Loading Shark Tank data from API... ${silent ? '(silent)' : ''}`);
                
                // Only show loading message if not silent refresh
                if (!silent) {
                sharkTankTrack.innerHTML = '<div class="loading">Loading Shark Tank products...</div>';
                }

                const endpoints = [
                    `${API_BASE}/api/live-shark-tank`,
                    'https://app-banao-rcy2733o7-voyageeyewears-projects.vercel.app/api/live-shark-tank',
                    'https://app-banao-fboiv57y7-voyageeyewears-projects.vercel.app/api/live-shark-tank',
                    'https://app-banao-er3xnzjwt-voyageeyewears-projects.vercel.app/api/live-shark-tank',
                    'https://app-banao-dmc0dl409-voyageeyewears-projects.vercel.app/api/live-shark-tank',
                    'https://app-banao.vercel.app/api/live-shark-tank'
                ];

                let response = null;
                let lastError = null;

                for (const endpoint of endpoints) {
                    try {
                        console.log(`🦈 Trying endpoint: ${endpoint}`);
                        const res = await fetch(endpoint, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Cache-Control': 'no-cache'
                            }
                        });

                        if (res.ok) {
                            response = res;
                            console.log(`✅ Shark Tank API connected: ${endpoint}`);
                            break;
                        } else {
                            console.log(`❌ Failed: ${endpoint} (${res.status})`);
                        }
                    } catch (error) {
                        console.log(`❌ Error with ${endpoint}:`, error.message);
                        lastError = error;
                    }
                }

                if (!response) {
                    throw new Error(lastError?.message || 'All API endpoints failed');
                }

                const data = await response.json();
                console.log('🦈 Shark Tank data received:', data);

                // Update titles if provided
                if (data.section?.title && sharkTankTitle) {
                    sharkTankTitle.textContent = data.section.title;
                }
                if (data.section?.subtitle && sharkTankSubtitle) {
                    sharkTankSubtitle.textContent = data.section.subtitle;
                }

                // Check if section should be hidden or disabled
                if (data.isHidden || !data.enabled) {
                    const sharkTankSection = document.getElementById('shark-tank-section');
                    if (sharkTankSection) {
                        sharkTankSection.style.display = 'none';
                    }
                    return;
                }

                // Render shark tank products
                if (data.section?.products && data.section.products.length > 0) {
                    renderSharkTankProducts(data.section.products);
                } else {
                    sharkTankTrack.innerHTML = '<div class="loading">No Shark Tank products available</div>';
                }

            } catch (error) {
                console.error('❌ Failed to load Shark Tank data:', error);
                
                // Only show error message if not silent refresh
                if (!silent) {
                sharkTankTrack.innerHTML = `
                    <div class="loading" style="color: #dc2626;">
                        Unable to load Shark Tank products
                        <br><button onclick="loadSharkTankData()" style="
                            margin-top: 10px; 
                            padding: 8px 16px; 
                            background: #667eea; 
                            color: white; 
                            border: none; 
                            border-radius: 6px; 
                            cursor: pointer;
                        ">Retry</button>
                    </div>
                `;
                }
            }
        }

        // Render Shark Tank products with video support
        function renderSharkTankProducts(products) {
            const sharkTankTrack = document.getElementById('shark-tank-track');
            
            if (!sharkTankTrack) return;

            const productsHTML = products.map(product => {
                // Determine media element (video or image)
                let mediaElement = '';
                if (product.video && product.video.trim()) {
                    // MP4 video with autoplay, loop, muted
                    mediaElement = `
                        <video 
                            src="${product.video}" 
                            autoplay 
                            loop 
                            muted 
                            playsinline
                            poster="${product.image || ''}"
                            style="
                                width: 100%; 
                                height: 100%; 
                                object-fit: contain;
                                object-position: center;
                                background: #f8f9fa;
                            "
                            onloadstart="console.log('🎥 Video loading:', '${product.brand} - ${product.title}')"
                            onplay="console.log('▶️ Video playing:', '${product.brand} - ${product.title}')"
                            onerror="console.error('❌ Video error:', '${product.brand} - ${product.title}'); this.style.display='none'; this.nextElementSibling.style.display='block';"
                        ></video>
                        <img 
                            src="${product.image}" 
                            alt="${product.brand} - ${product.title}"
                            style="
                                width: 100%; 
                                height: 100%; 
                                object-fit: contain; 
                                object-position: center;
                                background: #f8f9fa;
                                display: none;
                            "
                        />
                    `;
                } else {
                    // Regular image
                    mediaElement = `
                        <img 
                            src="${product.image}" 
                            alt="${product.brand} - ${product.title}"
                            style="
                                width: 100%; 
                                height: 100%; 
                                object-fit: contain; 
                                object-position: center;
                                background: #f8f9fa;
                            "
                        />
                    `;
                }

                return `
                    <div class="shark-tank-slide">
                        <div class="shark-tank-card" onclick="handleSharkTankCardClick('${product.brand}', '${product.title}')">
                            <div class="shark-tank-card__media">
                                ${mediaElement}
                                <div class="shark-tank-card__overlay"></div>
                                ${product.showTag && product.tag ? `<span class="shark-tank-card__tag">${product.tag}</span>` : ''}
                                <div class="shark-tank-card__content">
                                    <h3 class="shark-tank-card__brand ${product.brand.toLowerCase()}">${product.brand}</h3>
                                    <p class="shark-tank-card__title">${product.title}</p>
                                    <div class="shark-tank-card__button">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            sharkTankTrack.innerHTML = productsHTML;

            // Initialize click handlers for new cards
            const sharkTankCards = document.querySelectorAll('.shark-tank-card');
            console.log(`✅ Rendered ${products.length} Shark Tank products with video support`);
        }

        // Handle Shark Tank card clicks
        function handleSharkTankCardClick(brand, title) {
            console.log('🦈 Shark Tank card clicked:', brand, '-', title);
            showToast(`${brand} - ${title}`);
        }

        // Initialize Looks Section
        function initializeLooksSection() {
            console.log('👗 Initializing Looks section...');
            loadLooksData();
        }

        // Load Looks data from live API
        async function loadLooksData(silent = false) {
            const menGrid = document.getElementById('men-looks-grid');
            const womenGrid = document.getElementById('women-looks-grid');
            const looksTitle = document.getElementById('looks-title-cursive');
            const looksBold = document.getElementById('looks-title-bold');
            const looksSubtitle = document.getElementById('looks-subtitle');
            
            console.log(`🔍 DEBUG: loadLooksData called with silent=${silent}`);
            console.log(`🔍 DEBUG: Elements found - menGrid:${!!menGrid}, womenGrid:${!!womenGrid}`);
            
            if (!menGrid || !womenGrid) {
                console.error('❌ CRITICAL: Looks grid elements not found!');
                return;
            }

            try {
                console.log(`👗 Loading Looks data from API... ${silent ? '(silent)' : ''}`);
                
                // ALWAYS show loading message for better debugging
                menGrid.innerHTML = '<div class="loading">Loading men\'s looks...</div>';
                womenGrid.innerHTML = '<div class="loading">Loading women\'s looks...</div>';

                const endpoints = [
                    `${API_BASE}/api/live-looks`,
                    'https://app-banao-rcy2733o7-voyageeyewears-projects.vercel.app/api/live-looks',
                    'https://app-banao-fboiv57y7-voyageeyewears-projects.vercel.app/api/live-looks',
                    'https://app-banao-er3xnzjwt-voyageeyewears-projects.vercel.app/api/live-looks'
                ];

                let response = null;
                let lastError = null;

                for (const endpoint of endpoints) {
                    try {
                        console.log(`👗 Trying endpoint: ${endpoint}`);
                        const res = await fetch(endpoint, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Cache-Control': 'no-cache'
                            }
                        });

                        if (res.ok) {
                            response = res;
                            console.log(`✅ Looks API connected: ${endpoint}`);
                            break;
                        } else {
                            console.log(`❌ Failed: ${endpoint} (${res.status})`);
                        }
                    } catch (error) {
                        console.log(`❌ Error with ${endpoint}:`, error.message);
                        lastError = error;
                    }
                }

                if (!response) {
                    throw new Error(lastError?.message || 'All API endpoints failed');
                }

                const data = await response.json();
                console.log('🔍 DEBUG: Full API response:', JSON.stringify(data, null, 2));

                // Update titles if provided
                if (data.config?.title_cursive && looksTitle) {
                    looksTitle.textContent = data.config.title_cursive;
                }
                if (data.config?.title_bold && looksBold) {
                    looksBold.textContent = data.config.title_bold;
                }
                if (data.config?.subtitle && looksSubtitle) {
                    looksSubtitle.textContent = data.config.subtitle;
                }

                // Check if section should be hidden
                console.log(`🔍 DEBUG: Section enabled check - data.config?.enabled: ${data.config?.enabled}`);
                if (!data.enabled) {
                    console.error('❌ CRITICAL: Looks section is DISABLED in config!');
                    const looksSection = document.getElementById('looks-section');
                    if (looksSection) {
                        looksSection.style.display = 'none';
                    }
                    return;
                }

                // Render looks cards
                console.log(`🔍 DEBUG: Cards check - data.cards exists: ${!!data.cards}, length: ${data.cards?.length}`);
                if (data.cards && data.cards.length > 0) {
                    console.log('✅ RENDERING LOOKS CARDS');
                    renderLooksCards(data.cards, data.config);
                } else {
                    console.error('❌ CRITICAL: No cards available to render!');
                    menGrid.innerHTML = '<div class="loading">No men\'s looks available</div>';
                    womenGrid.innerHTML = '<div class="loading">No women\'s looks available</div>';
                }

            } catch (error) {
                console.error('❌ Failed to load Looks data:', error);
                
                if (!silent) {
                    menGrid.innerHTML = `
                        <div class="loading" style="color: #dc2626;">
                            Unable to load men's looks
                            <br><button onclick="loadLooksData()" style="
                                margin-top: 10px; padding: 8px 16px; background: #667eea; 
                                color: white; border: none; border-radius: 6px; cursor: pointer;
                            ">Retry</button>
                        </div>
                    `;
                    womenGrid.innerHTML = `
                        <div class="loading" style="color: #dc2626;">
                            Unable to load women's looks
                            <br><button onclick="loadLooksData()" style="
                                margin-top: 10px; padding: 8px 16px; background: #667eea; 
                                color: white; border: none; border-radius: 6px; cursor: pointer;
                            ">Retry</button>
                        </div>
                    `;
                }
            }
        }

        // Render Looks cards
        function renderLooksCards(cards, config) {
            console.log('🔍 DEBUG: renderLooksCards called with:', cards, config);
            
            const menGrid = document.getElementById('men-looks-grid');
            const womenGrid = document.getElementById('women-looks-grid');
            
            console.log(`🔍 DEBUG: Grid elements in render - menGrid:${!!menGrid}, womenGrid:${!!womenGrid}`);
            
            if (!menGrid || !womenGrid) {
                console.error('❌ CRITICAL: Grid elements not found in render function!');
                return;
            }

            // Filter cards by type
            const menCards = cards.filter(card => card.type === 'men_style' && card.enabled);
            const womenCards = cards.filter(card => card.type === 'women_style' && card.enabled);
            
            console.log(`🔍 DEBUG: Filtered cards - men: ${menCards.length}, women: ${womenCards.length}`);

            // Render men's section
            const menHTML = `
                <a href="${config.men_explore_link || '#'}" class="looks-card explore men">
                    <h3 class="looks-explore-title">${config.men_explore_title || 'Men'}</h3>
                    <p class="looks-explore-subtitle">${config.men_explore_subtitle || 'Explore All'}</p>
                    <div class="looks-explore-arrow">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M12 4L10.59 5.41L16.17 11H4V13H16.17L10.59 18.59L12 20L20 12L12 4Z" fill="#1B224B"/>
                        </svg>
                    </div>
                </a>
                ${menCards.map(card => `
                    <a href="${card.link || '#'}" class="looks-card" onclick="handleLooksCardClick('${card.title}')">
                        <img src="${card.image || 'https://via.placeholder.com/100x120'}" alt="${card.title}" class="looks-card-image" loading="lazy">
                        <div class="looks-card-overlay">
                            <h3 class="looks-card-title">${card.title}</h3>
                        </div>
                    </a>
                `).join('')}
            `;

            // Render women's section
            const womenHTML = `
                <a href="${config.women_explore_link || '#'}" class="looks-card explore women">
                    <h3 class="looks-explore-title">${config.women_explore_title || 'Women'}</h3>
                    <p class="looks-explore-subtitle">${config.women_explore_subtitle || 'Explore All'}</p>
                    <div class="looks-explore-arrow">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M12 4L10.59 5.41L16.17 11H4V13H16.17L10.59 18.59L12 20L20 12L12 4Z" fill="#1B224B"/>
                        </svg>
                    </div>
                </a>
                ${womenCards.map(card => `
                    <a href="${card.link || '#'}" class="looks-card" onclick="handleLooksCardClick('${card.title}')">
                        <img src="${card.image || 'https://via.placeholder.com/100x120'}" alt="${card.title}" class="looks-card-image" loading="lazy">
                        <div class="looks-card-overlay">
                            <h3 class="looks-card-title">${card.title}</h3>
                        </div>
                    </a>
                `).join('')}
            `;

            console.log('🔍 DEBUG: Setting HTML for grids...');
            console.log('🔍 DEBUG: Men HTML length:', menHTML.length);
            console.log('🔍 DEBUG: Women HTML length:', womenHTML.length);
            
            menGrid.innerHTML = menHTML;
            womenGrid.innerHTML = womenHTML;

            console.log(`✅ FINAL: Rendered ${menCards.length} men's looks and ${womenCards.length} women's looks`);
            console.log('🔍 DEBUG: Final grid contents - men:', menGrid.innerHTML.substring(0, 100));
            console.log('🔍 DEBUG: Final grid contents - women:', womenGrid.innerHTML.substring(0, 100));
        }

        // Handle Looks card clicks
        function handleLooksCardClick(title) {
            console.log('👗 Looks card clicked:', title);
            showToast(`${title} - Coming soon!`);
        }

        // Sale Banner Management - Place Inside Category Sections
        function updateGlobalSaleBanner() {
            console.log('🎯 Sale banner data updated - banners will show inside category sections');
            
            // Don't add global banners - they will be added inside category sections
            // This function just ensures the banner data is available globally
            
            if (window.eyeglassesSaleBanner && window.eyeglassesSaleBanner.enabled === true) {
                console.log('✅ Eyeglasses sale banner ready:', window.eyeglassesSaleBanner);
            }
            
            if (window.sunglassesSaleBanner && window.sunglassesSaleBanner.enabled === true) {
                console.log('✅ Sunglasses sale banner ready:', window.sunglassesSaleBanner);
            }
        }

        // Helper function to create sale banner HTML
        function createSaleBannerHTML(bannerData, defaultColor = '#d32f2f') {
            if (!bannerData || !bannerData.enabled || !bannerData.line1 || !bannerData.line2) {
                return '';
            }
            
            return `
                <div class="sale-banner" style="
                    background-color: ${bannerData.backgroundColor || defaultColor};
                    color: white;
                    text-align: center;
                    padding: 12px 0;
                    margin: 0;
                    position: relative;
                    overflow: hidden;
                    width: 100vw;
                    margin-left: calc(-50vw + 50%);
                    font-weight: bold;
                    font-size: 14px;
                    line-height: 1.2;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                ">
                    <div style="margin-bottom: 2px;">${bannerData.line1}</div>
                    <div>${bannerData.line2}</div>
                </div>
            `;
        }

        // Navigation Functions
        function showPage(page) {
            console.log('🔍 DEBUG: showPage called with page:', page);
            console.log('🔍 DEBUG: Previous currentView:', currentView);
            
            currentView = page;
            console.log('🔍 DEBUG: Set currentView to:', currentView);
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            console.log('🔍 DEBUG: Updated nav items');
            
            // Hide all content sections first
            const contentSections = ['home-content', 'collections-content', 'account-content', 'collection-content'];
            console.log('🔍 DEBUG: Hiding all content sections:', contentSections);
            
            contentSections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                console.log(`🔍 DEBUG: Section ${sectionId} exists:`, !!section);
                if (section) {
                    section.style.display = 'none';
                    console.log(`🔍 DEBUG: Hidden section ${sectionId}`);
                }
            });
            
            // Handle page-specific logic
            console.log('🔍 DEBUG: Handling page-specific logic for:', page);
            switch (page) {
                case 'home':
                    console.log('🔍 DEBUG: Showing home page');
                    document.body.classList.remove('hide-header');
                    const homeContent = document.getElementById('home-content');
                    if (homeContent) {
                        homeContent.style.display = 'block';
                        console.log('🔍 DEBUG: home-content shown');
                        
                        // Fix featured product styling after returning to home
                        setTimeout(() => {
                            console.log('🎨 STYLE RESET: Fixing featured product styling...');
                            
                            // Fix product titles
                            const productTitles = homeContent.querySelectorAll('.product-title');
                            productTitles.forEach(title => {
                                title.style.fontWeight = 'normal';
                                title.style.fontSize = '1rem';
                            });
                            
                            // Fix discount badges - ensure they use red styling
                            const discountBadges = homeContent.querySelectorAll('.discount-badge');
                            discountBadges.forEach(badge => {
                                badge.style.background = '#fef2f2';
                                badge.style.color = '#dc2626';
                                badge.style.fontWeight = '600';
                                badge.style.fontSize = '0.8rem';
                                badge.style.padding = '2px 6px';
                                badge.style.borderRadius = '4px';
                                // Remove any conflicting styles
                                badge.style.backgroundImage = 'none';
                                badge.style.boxShadow = 'none';
                                badge.style.textTransform = 'none';
                                badge.style.letterSpacing = 'normal';
                            });
                            
                            // Fix current prices - ensure they're blue
                            const currentPrices = homeContent.querySelectorAll('.current-price');
                            currentPrices.forEach(price => {
                                price.style.color = '#2563eb';
                                price.style.fontWeight = '600';
                                price.style.fontSize = '1.1rem';
                            });
                            
                            // Fix original prices - ensure they're gray and crossed out
                            const originalPrices = homeContent.querySelectorAll('.original-price');
                            originalPrices.forEach(price => {
                                price.style.color = '#6b7280';
                                price.style.textDecoration = 'line-through';
                                price.style.opacity = '0.7';
                                price.style.fontSize = '0.9rem';
                            });
                            
                            console.log('🎨 STYLE RESET: Fixed', {
                                titles: productTitles.length,
                                discountBadges: discountBadges.length,
                                currentPrices: currentPrices.length,
                                originalPrices: originalPrices.length
                            });
                        }, 100);
                    } else {
                        console.error('🔍 ERROR: home-content element not found!');
                    }
                    loadHomePage();
                    break;
                case 'collections':
                    console.log('🔍 DEBUG: Showing collections page');
                    document.body.classList.remove('hide-header'); // Keep header visible
                    const collectionsContent = document.getElementById('collections-content');
                    if (collectionsContent) {
                        collectionsContent.style.display = 'block';
                        console.log('🔍 DEBUG: collections-content shown');
                    } else {
                        console.error('🔍 ERROR: collections-content element not found!');
                    }
                    // Also show home content alongside collections for a richer experience
                    const homeContentForCollections = document.getElementById('home-content');
                    if (homeContentForCollections) {
                        homeContentForCollections.style.display = 'block';
                        console.log('🔍 DEBUG: home-content also shown for richer collections experience');
                    }
                    loadCollectionsPage();
                    break;
                case 'collection':
                    console.log('🔍 DEBUG: Showing SINGLE collection page');
                    document.body.classList.add('hide-header');
                    const collectionContent = document.getElementById('collection-content');
                    if (collectionContent) {
                        collectionContent.style.display = 'block';
                        console.log('🔍 DEBUG: collection-content shown successfully');
                    } else {
                        console.error('🔍 ERROR: collection-content element not found!');
                    }
                    break;
                case 'account':
                    console.log('🔍 DEBUG: Showing account page');
                    document.body.classList.add('hide-header');
                    const accountContent = document.getElementById('account-content');
                    if (accountContent) {
                        accountContent.style.display = 'block';
                        console.log('🔍 DEBUG: account-content shown');
                    } else {
                        console.error('🔍 ERROR: account-content element not found!');
                    }
                    loadAccountPage();
                    break;
                default:
                    console.error('🔍 ERROR: Unknown page type:', page);
            }
            console.log('🔍 DEBUG: showPage completed for:', page);
        }

        function loadHomePage() {
            console.log('Loading home page...');
            // Home content is already loaded
        }

        function loadCollectionsPage() {
            console.log('📚 Loading full collections page...');
            
            const collectionsGridPage = document.getElementById('collections-grid-page');
            if (!collectionsGridPage) {
                console.error('❌ collections-grid-page not found!');
                return;
            }
            
            // Show loading state
            collectionsGridPage.innerHTML = '<div class="loading">Loading collections...</div>';
            
            // Render all collections in the dedicated collections page
            if (collections.length > 0) {
                console.log(`📚 Rendering ${collections.length} collections in full page`);
                renderCollectionsFullPage(collections);
            } else {
                console.log('📚 No collections found, loading from API...');
                // Try to load collections if not already loaded
                loadCollections().then(() => {
                    if (collections.length > 0) {
                        renderCollectionsFullPage(collections);
                    } else {
                        collectionsGridPage.innerHTML = `
                            <div class="empty-state">
                                <h3>No Collections Found</h3>
                                <p>Collections will appear here when available</p>
                                <button onclick="loadCollections(0)" class="retry-btn">Retry</button>
                            </div>
                        `;
                    }
                });
            }
        }
        
        // Render collections in full page layout
        function renderCollectionsFullPage(collectionsData) {
            const collectionsGridPage = document.getElementById('collections-grid-page');
            if (!collectionsGridPage) return;
            
            console.log('📚 Rendering collections full page with', collectionsData.length, 'collections');
            
            collectionsGridPage.innerHTML = `
                <div class="collections-page-header">
                    <h2>All Collections</h2>
                    <p>Discover our curated eyewear collections</p>
                </div>
                <div class="collections-full-grid">
                    ${collectionsData.map(collection => `
                        <a href="#" class="collection-full-card" onclick="openCollection('${collection.handle}', event)">
                            <div class="collection-full-image">
                                <img src="${collection.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iNDAiIGZpbGw9IiNEREQiLz4KPHN2Zz4K'}" alt="${collection.title}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjE1MCIgY3k9IjEwMCIgcj0iNDAiIGZpbGw9IiNEREQiLz4KPHN2Zz4K'">
                                <div class="collection-overlay">
                                    <span class="collection-products-count">${collection.products ? collection.products.length : 0} Products</span>
                                </div>
                            </div>
                            <div class="collection-full-info">
                                <h3>${collection.title}</h3>
                                <p>${collection.description || 'Discover amazing products in this collection'}</p>
                            </div>
                        </a>
                    `).join('')}
                </div>
            `;
        }
        
        // Open collection from full collections page
        function openCollection(handle, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('📚 Opening collection from full page:', handle);
            
            // Switch to collection view and load specific collection
            showPage('collection');
            loadCollectionProducts(handle);
        }

        function loadAccountPage() {
            console.log('Loading account page...');
            showToast('Account page - Coming soon!');
        }

        // Cart Functions
        function toggleCart() {
            console.log('🛒 [CART DEBUG] Toggle cart called');
            
            const cartSidebar = document.getElementById('cart-sidebar');
            const cartOverlay = document.getElementById('cart-overlay');
            
            cartSidebar.classList.toggle('active');
            cartOverlay.classList.toggle('active');
            
            if (cartSidebar.classList.contains('active')) {
                console.log('🛒 [CART DEBUG] Cart opened - refreshing display');
                document.body.style.overflow = 'hidden';
                
                // Force refresh cart display when opening
                updateCartDisplay();
            } else {
                console.log('🛒 [CART DEBUG] Cart closed');
                document.body.style.overflow = '';
            }
        }

        function updateCartDisplay() {
            console.log('🔄 [CART DEBUG] Starting updateCartDisplay...');
            
            const cartBadge = document.getElementById('cart-badge');
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            if (!cartItems) {
                console.error('❌ [CART DEBUG] Cart items container not found!');
                return;
            }
            
            // DETAILED DEBUGGING: Check all localStorage data
            console.log('📊 [CART DEBUG] Checking localStorage...');
            
            try {
                // 1. Regular cart storage
                const regularCartRaw = localStorage.getItem('cart');
                console.log('🛒 [CART DEBUG] Raw regular cart data:', regularCartRaw);
                const regularCart = JSON.parse(regularCartRaw || '[]');
                console.log('🛒 [CART DEBUG] Parsed regular cart:', regularCart);
                
                // 2. Mobile cart storage  
                const mobileCartRaw = localStorage.getItem('mobile-cart');
                console.log('📱 [CART DEBUG] Raw mobile cart data:', mobileCartRaw);
                const mobileCart = JSON.parse(mobileCartRaw || '[]');
                console.log('📱 [CART DEBUG] Parsed mobile cart:', mobileCart);
                
                // 3. Shopify cart storage
                const shopifyCartRaw = localStorage.getItem('shopify-cart');
                console.log('🏪 [CART DEBUG] Raw shopify cart data:', shopifyCartRaw);
                const shopifyCartData = JSON.parse(shopifyCartRaw || 'null');
                console.log('🏪 [CART DEBUG] Parsed shopify cart data:', shopifyCartData);
                
                // Simple approach: Use any cart that has items
                let allCartItems = [];
                
                // Check regular cart first
                if (regularCart && regularCart.length > 0) {
                    console.log('✅ [CART DEBUG] Using regular cart items');
                    allCartItems = regularCart.map(item => ({
                        id: item.id,
                        brand: item.brand || item.title || 'Product',
                        price: item.price || '0',
                        image: item.image || '',
                        quantity: item.quantity || 1
                    }));
                }
                // Check mobile cart if regular is empty
                else if (mobileCart && mobileCart.length > 0) {
                    console.log('✅ [CART DEBUG] Using mobile cart items');
                    allCartItems = mobileCart.map(item => ({
                        id: item.id || item.variant_id,
                        brand: item.title || item.brand || 'Product',
                        price: item.price || '0',
                        image: item.image || '',
                        quantity: item.quantity || 1
                    }));
                }
                // Check shopify cart if others are empty
                else if (shopifyCartData && shopifyCartData.items && shopifyCartData.items.length > 0) {
                    console.log('✅ [CART DEBUG] Using shopify cart items');
                    allCartItems = shopifyCartData.items.map(item => ({
                        id: item.variant_id || item.id,
                        brand: item.title || item.product_title || 'Product',
                        price: item.price || item.final_price || '0',
                        image: item.image || item.featured_image?.url || '',
                        quantity: item.quantity || 1
                    }));
                }
                
                console.log('🔄 [CART DEBUG] Final cart items:', allCartItems);
                console.log('📊 [CART DEBUG] Total items count:', allCartItems.length);
                
                if (allCartItems.length === 0) {
                    console.log('❌ [CART DEBUG] No items found, showing empty cart');
                    
                    if (cartBadge) cartBadge.style.display = 'none';
                    
                cartItems.innerHTML = `
                    <div class="empty-cart">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin-bottom: 16px;">
                            <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                            <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                            <path d="M1 1H5L7.68 14.39A2 2 0 009.65 16H19.4A2 2 0 0021.36 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <p>Your cart is empty</p>
                        <p style="font-size: 0.9em; opacity: 0.7;">Add some eyewear to get started</p>
                    </div>
                `;
                    
                    if (cartTotal) cartTotal.style.display = 'none';
            } else {
                    console.log('✅ [CART DEBUG] Displaying cart items');
                    
                    if (cartBadge) {
                cartBadge.style.display = 'flex';
                        cartBadge.textContent = allCartItems.length;
                    }
                    
                    if (cartTotal) cartTotal.style.display = 'block';
                    
                    // Render cart items with better error handling
                    cartItems.innerHTML = allCartItems.map((item, index) => {
                        console.log(`🎯 [CART DEBUG] Rendering item ${index}:`, item);
                        
                        const itemId = item.id || `item-${index}`;
                        const itemBrand = item.brand || 'Product';
                        const itemPrice = parseFloat(String(item.price).replace(/[^\d.]/g, '') || '0').toFixed(2);
                        const itemImage = item.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEg0MFY0MEgyMFYyMFoiIGZpbGw9IiNDQ0MiLz4KPC9zdmc+';
                        const itemQuantity = item.quantity || 1;
                        
                        return `
                            <div class="cart-item" data-product-id="${itemId}">
                                <div class="cart-item-image">
                                    <img src="${itemImage}" alt="${itemBrand}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEg0MFY0MEgyMFYyMFoiIGZpbGw9IiNDQ0MiLz4KPC9zdmc+'">
                                </div>
                                <div class="cart-item-details">
                                    <h4 class="cart-item-brand">${itemBrand}</h4>
                                    <div class="cart-item-price">₹${itemPrice}</div>
                                    <div class="cart-item-quantity">
                                        <button class="quantity-btn" onclick="updateCartItemQuantity('${itemId}', ${itemQuantity - 1})">-</button>
                                        <span class="quantity">${itemQuantity}</span>
                                        <button class="quantity-btn" onclick="updateCartItemQuantity('${itemId}', ${itemQuantity + 1})">+</button>
                                    </div>
                                </div>
                                <button class="remove-item-btn" onclick="removeFromCart('${itemId}')" title="Remove item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        `;
                    }).join('');
                
                // Calculate total
                    const total = allCartItems.reduce((sum, item) => {
                        const price = parseFloat(String(item.price).replace(/[^\d.]/g, '') || '0');
                        return sum + (price * item.quantity);
                    }, 0);
                    
                    console.log('💰 [CART DEBUG] Calculated total:', total);
                    
                    const totalElement = document.getElementById('total-amount');
                    if (totalElement) {
                        totalElement.textContent = total.toFixed(2);
                        console.log('✅ [CART DEBUG] Total updated in UI');
                    }
                }
                
                console.log('✅ [CART DEBUG] Cart display update completed');
                
            } catch (error) {
                console.error('❌ [CART DEBUG] Error in updateCartDisplay:', error);
                
                // Fallback: show empty cart on error
                if (cartItems) {
                    cartItems.innerHTML = `
                        <div class="empty-cart">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin-bottom: 16px;">
                                <circle cx="9" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                                <circle cx="20" cy="21" r="1" stroke="currentColor" stroke-width="2"/>
                                <path d="M1 1H5L7.68 14.39A2 2 0 009.65 16H19.4A2 2 0 0021.36 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <p>Cart loading error</p>
                            <p style="font-size: 0.9em; opacity: 0.7;">Please try refreshing</p>
                        </div>
                    `;
                }
            }
        }
        
        // Function to update cart item quantity
        function updateCartItemQuantity(productId, newQuantity) {
            console.log('🔄 Updating cart quantity:', productId, newQuantity);
            
            if (newQuantity <= 0) {
                // Remove item if quantity is 0 or less
                removeFromCart(productId);
                return;
            }
            
            // Update in all cart storage locations
            let updated = false;
            
            // 1. Update regular cart
            let regularCart = JSON.parse(localStorage.getItem('cart') || '[]');
            const regularIndex = regularCart.findIndex(item => item.id === productId);
            if (regularIndex !== -1) {
                regularCart[regularIndex].quantity = newQuantity;
                localStorage.setItem('cart', JSON.stringify(regularCart));
                updated = true;
            }
            
            // 2. Update mobile cart
            let mobileCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
            const mobileIndex = mobileCart.findIndex(item => (item.id === productId || item.variant_id === productId));
            if (mobileIndex !== -1) {
                mobileCart[mobileIndex].quantity = newQuantity;
                localStorage.setItem('mobile-cart', JSON.stringify(mobileCart));
                updated = true;
            }
            
            // 3. Update shopify cart
            let shopifyCartData = JSON.parse(localStorage.getItem('shopify-cart') || 'null');
            if (shopifyCartData && shopifyCartData.items) {
                const shopifyIndex = shopifyCartData.items.findIndex(item => (item.variant_id === productId || item.id === productId));
                if (shopifyIndex !== -1) {
                    shopifyCartData.items[shopifyIndex].quantity = newQuantity;
                    localStorage.setItem('shopify-cart', JSON.stringify(shopifyCartData));
                    updated = true;
                }
            }
            
            if (updated) {
                updateCartDisplay();
                updateCartCount();
                console.log('✅ Cart quantity updated');
            }
        }
        
        // Function to remove item from cart
        function removeFromCart(productId) {
            console.log('🗑️ Removing from cart:', productId);
            
            // Remove from all cart storage locations
            let removed = false;
            
            // 1. Remove from regular cart
            let regularCart = JSON.parse(localStorage.getItem('cart') || '[]');
            const originalRegularLength = regularCart.length;
            regularCart = regularCart.filter(item => item.id !== productId);
            if (regularCart.length !== originalRegularLength) {
                localStorage.setItem('cart', JSON.stringify(regularCart));
                removed = true;
            }
            
            // 2. Remove from mobile cart
            let mobileCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
            const originalMobileLength = mobileCart.length;
            mobileCart = mobileCart.filter(item => item.id !== productId && item.variant_id !== productId);
            if (mobileCart.length !== originalMobileLength) {
                localStorage.setItem('mobile-cart', JSON.stringify(mobileCart));
                removed = true;
            }
            
            // 3. Remove from shopify cart
            let shopifyCartData = JSON.parse(localStorage.getItem('shopify-cart') || 'null');
            if (shopifyCartData && shopifyCartData.items) {
                const originalShopifyLength = shopifyCartData.items.length;
                shopifyCartData.items = shopifyCartData.items.filter(item => item.variant_id !== productId && item.id !== productId);
                if (shopifyCartData.items.length !== originalShopifyLength) {
                    localStorage.setItem('shopify-cart', JSON.stringify(shopifyCartData));
                    removed = true;
                }
            }
            
            if (removed) {
                updateCartDisplay();
                updateCartCount();
                showToast('Item removed from cart');
                console.log('✅ Item removed from cart');
            }
        }

        async function checkout() {
            console.log('🛒 Starting checkout process...');
            
            // Helper function to reset checkout button
            function resetCheckoutButton() {
                const btn = document.querySelector('.checkout-btn');
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'Proceed to Checkout';
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                }
            }
            
            // Get checkout button and add loading state
            const checkoutBtn = document.querySelector('.checkout-btn');
            if (checkoutBtn) {
                checkoutBtn.disabled = true;
                checkoutBtn.textContent = 'Creating Checkout...';
                checkoutBtn.style.opacity = '0.7';
                checkoutBtn.style.cursor = 'not-allowed';
            }
            
            showToast('Creating checkout...');
            
            // Get consolidated cart items from all storage locations
            let allCartItems = [];
            
            // 1. Regular cart storage
            const regularCart = JSON.parse(localStorage.getItem('cart') || '[]');
            console.log('🛒 Regular cart for checkout:', regularCart);
            
            // 2. Mobile cart storage  
            const mobileCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
            console.log('📱 Mobile cart for checkout:', mobileCart);
            
            // 3. Shopify cart storage
            const shopifyCartData = JSON.parse(localStorage.getItem('shopify-cart') || 'null');
            let shopifyCart = [];
            if (shopifyCartData && shopifyCartData.items) {
                shopifyCart = shopifyCartData.items.map(item => ({
                    id: item.variant_id || item.id,
                    brand: item.title || item.product_title,
                    price: item.price || item.final_price || '0',
                    image: item.image || item.featured_image?.url,
                    quantity: item.quantity || 1,
                    variantId: item.variant_id || item.id
                }));
            }
            console.log('🏪 Shopify cart for checkout:', shopifyCart);
            
            // Consolidate all cart items (avoid duplicates by ID)
            const cartMap = new Map();
            
            // Add regular cart items
            regularCart.forEach(item => {
                const key = item.id || item.variant_id;
                if (key && !cartMap.has(key)) {
                    cartMap.set(key, {
                        id: key,
                        brand: item.brand || item.title,
                        price: item.price,
                        image: item.image,
                        quantity: item.quantity || 1,
                        variantId: key // Use as variant ID for checkout
                    });
                }
            });
            
            // Add mobile cart items
            mobileCart.forEach(item => {
                const key = item.id || item.variant_id;
                if (key && !cartMap.has(key)) {
                    cartMap.set(key, {
                        id: key,
                        brand: item.title || item.brand,
                        price: item.price,
                        image: item.image,
                        quantity: item.quantity || 1,
                        variantId: item.variant_id || key
                    });
                } else if (key && cartMap.has(key)) {
                    // Merge quantities if same item exists
                    const existing = cartMap.get(key);
                    existing.quantity += (item.quantity || 1);
                }
            });
            
            // Add shopify cart items
            shopifyCart.forEach(item => {
                const key = item.id;
                if (key && !cartMap.has(key)) {
                    cartMap.set(key, {
                        id: key,
                        brand: item.brand,
                        price: item.price,
                        image: item.image,
                        quantity: item.quantity,
                        variantId: item.variantId || key
                    });
                } else if (key && cartMap.has(key)) {
                    // Merge quantities if same item exists
                    const existing = cartMap.get(key);
                    existing.quantity += (item.quantity || 1);
                }
            });
            
            // Convert map to array
            allCartItems = Array.from(cartMap.values());
            console.log('🔄 Consolidated cart for checkout:', allCartItems);
            
            if (allCartItems.length === 0) {
                showToast('Your cart is empty!');
                resetCheckoutButton();
                return;
            }
            
            try {
                // Create Shopify cart using Storefront API
                console.log('🏪 Creating Shopify checkout cart...');
                
                // Simple cart creation for first item
                const firstItem = allCartItems[0];
                console.log('📦 Creating cart with first item:', firstItem);
                
                // Step 1: Create cart with first item
                const createResponse = await fetch(`${API_BASE}/api/storefront`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'createCart',
                        variantId: firstItem.variantId,
                        quantity: firstItem.quantity
                    })
                });
                
                if (!createResponse.ok) {
                    console.error('❌ Cart creation failed');
                    showToast('Checkout failed. Please try again.');
                    resetCheckoutButton();
                    return;
                }
                
                const createData = await createResponse.json();
                console.log('✅ Initial cart created:', createData);
                
                if (!createData.cartCreate || !createData.cartCreate.cart) {
                    console.error('❌ Invalid cart creation response:', createData);
                    showToast('Checkout failed. Please try again.');
                    resetCheckoutButton();
                    return;
                }
                
                let cart = createData.cartCreate.cart;
                
                // Step 2: Add remaining items to cart if any
                const remainingItems = allCartItems.slice(1);
                for (const item of remainingItems) {
                    console.log('➕ Adding item to cart:', item);
                    
                    try {
                        const addResponse = await fetch(`${API_BASE}/api/storefront`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                action: 'addToCart',
                                cartId: cart.id,
                                variantId: item.variantId,
                                quantity: item.quantity
                            })
                        });
                        
                        if (addResponse.ok) {
                            const addData = await addResponse.json();
                            console.log('✅ Item added to cart:', addData);
                            if (addData.cartLinesAdd && addData.cartLinesAdd.cart) {
                                cart = addData.cartLinesAdd.cart;
                            }
                        } else {
                            console.warn('⚠️ Failed to add item to cart:', item);
                        }
                    } catch (error) {
                        console.warn('❌ Error adding item to cart:', item, error);
                    }
                }
                
                // Step 3: Redirect to checkout
                if (cart && cart.checkoutUrl) {
                    const checkoutUrl = cart.checkoutUrl;
                    console.log('🔗 Opening checkout URL:', checkoutUrl);
                    
            showToast('Redirecting to checkout...');
                    toggleCart();
                    
                    setTimeout(() => {
                        window.location.href = checkoutUrl;
                    }, 1000);
                    
                } else {
                    console.error('❌ No checkout URL available:', cart);
                    showToast('Checkout failed. Please try again.');
                    resetCheckoutButton();
                }
                
            } catch (error) {
                console.error('❌ Checkout error:', error);
                showToast('Checkout failed. Please check your connection.');
                resetCheckoutButton();
            }
        }

        // Slider Functions (disabled by default)
        function loadSliderSettings() {
            console.log('🎠 Slider disabled - showing clean layout');
            return Promise.resolve();
        }

        // Menu Functions
        function toggleMenu() {
            showToast('Menu opened');
        }

        function openSearch() {
            showToast('Search opened');
        }

        // Data Loading Functions
        async function loadCollections(retryCount = 0) {
            const maxRetries = 3;
            const retryDelay = 2000; // 2 seconds
            
            try {
                console.log(`📚 Loading collections... (attempt ${retryCount + 1}/${maxRetries + 1})`);
                
                // Try multiple API endpoints in order of preference
                const endpoints = [
                    `${API_BASE}/api/mobile-products`,
                    `${API_BASE}/api/storefront-data?type=collections`,
                    `${API_BASE}/api/public-products?type=collections`
                ];
                
                for (const apiUrl of endpoints) {
                    try {
                        console.log(`🔄 Trying endpoint: ${apiUrl}`);
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                        
                        const response = await fetch(apiUrl, {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        console.log(`Collections API Response status: ${response.status}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log('Collections API Data:', data);
                            
                            if (data.success && data.collections && data.collections.length > 0) {
                                collections = data.collections;
                                renderCollections(collections);
                                console.log(`✅ Loaded ${collections.length} real collections from ${apiUrl}`);
                                return;
                            }
                        }
                    } catch (endpointError) {
                        console.log(`⚠️ Endpoint ${apiUrl} failed:`, endpointError);
                        continue; // Try next endpoint
                    }
                }
                
                // If all endpoints fail, retry after delay
                if (retryCount < maxRetries) {
                    console.log(`🔄 All endpoints failed, retrying in ${retryDelay}ms...`);
                    setTimeout(() => loadCollections(retryCount + 1), retryDelay);
                    return;
                }
                
                // Show error message after all retries exhausted
                console.log('⚠️ All API attempts failed, showing error message');
                const collectionsGrid = document.getElementById('collections-grid');
                if (collectionsGrid) {
                    collectionsGrid.innerHTML = `
                        <div class="error-message" style="text-align: center; padding: 2rem; color: #666;">
                            <p>Unable to load collections</p>
                            <p style="font-size: 0.9em;">Please check your internet connection</p>
                            <button onclick="loadCollections(0)" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Retry
                            </button>
                        </div>
                    `;
                }
                return;
                
                // DISABLED Fallback to static collections - real API data should be used
                console.log('⚠️ Skipping fallback collections - using real API data');
                /*
                collections = [
                    {
                        id: 'eyeglasses',
                        title: 'Eyeglasses',
                        image: 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=400&fit=crop',
                        handle: 'eyeglasses'
                    },
                    {
                        id: 'sunglasses',
                        title: 'Sunglasses',
                        image: 'https://images.unsplash.com/photo-1556306535-38febf6782e7?w=400&h=400&fit=crop',
                        handle: 'sunglasses'
                    },
                    {
                        id: 'blue-light',
                        title: 'Blue Light',
                        image: 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=400&h=400&fit=crop',
                        handle: 'blue-light'
                    },
                    {
                        id: 'reading',
                        title: 'Reading Glasses',
                        image: 'https://images.unsplash.com/photo-1508296695146-257a814070b4?w=400&h=400&fit=crop',
                        handle: 'reading'
                    }
                ];
                
                renderCollections(collections);
                */
                console.log('✅ DISABLED default collections - using real API data');
                
            } catch (error) {
                console.error('❌ Error loading collections:', error);
                document.getElementById('collections-grid').innerHTML = `
                    <div class="error-message">
                        <p>Unable to load collections</p>
                        <p style="font-size: 0.9em; opacity: 0.7;">Please check your connection and try again</p>
                    </div>
                `;
            }
        }

        async function loadProducts(retryCount = 0) {
            const maxRetries = 3;
            const retryDelay = 2000; // 2 seconds
            
            try {
                console.log(`🛍️ Loading products... (attempt ${retryCount + 1}/${maxRetries + 1})`);
                
                // Try multiple API endpoints in order of preference
                const endpoints = [
                    `${API_BASE}/api/mobile-products`,
                    `${API_BASE}/api/storefront-data?type=products`,
                    `${API_BASE}/api/public-products?type=products`
                ];
                
                for (const apiUrl of endpoints) {
                    try {
                        console.log(`🔄 Trying endpoint: ${apiUrl}`);
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                        
                        const response = await fetch(apiUrl, {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        console.log(`Products API Response status: ${response.status}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log('Products API Data:', data);
                            
                            if (data.success && data.products && data.products.length > 0) {
                                products = data.products;
                                renderProducts(products);
                                console.log(`✅ Loaded ${products.length} real products from ${apiUrl}`);
                    return;
                }
                        }
                    } catch (endpointError) {
                        console.log(`⚠️ Endpoint ${apiUrl} failed:`, endpointError);
                        continue; // Try next endpoint
                    }
                }
                
                // If all endpoints fail, retry after delay
                if (retryCount < maxRetries) {
                    console.log(`🔄 All endpoints failed, retrying in ${retryDelay}ms...`);
                    setTimeout(() => loadProducts(retryCount + 1), retryDelay);
                    return;
                }
                
                // Show error message after all retries exhausted
                console.log('⚠️ All API attempts failed, showing error message');
                const productsGrid = document.getElementById('products-grid');
                if (productsGrid) {
                    productsGrid.innerHTML = `
                        <div class="error-message" style="text-align: center; padding: 2rem; color: #666;">
                            <p>Unable to load products</p>
                            <p style="font-size: 0.9em;">Please check your internet connection</p>
                            <button onclick="loadProducts(0)" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Retry
                            </button>
                        </div>
                    `;
                }
                return;
                
                // DISABLED Fallback to static products - real API data should be used
                console.log('⚠️ Skipping fallback products - using real API data');
                /*
                products = [
                        {
                            id: '1',
                        title: 'Classic Aviator Sunglasses',
                        price: '₹2,499',
                        image: 'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=400&fit=crop',
                        handle: 'classic-aviator'
                        },
                        {
                            id: '2',
                        title: 'Modern Square Frames',
                        price: '₹1,899',
                        image: 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=400&h=400&fit=crop',
                        handle: 'modern-square'
                    },
                    {
                        id: '3',
                        title: 'Vintage Round Glasses',
                        price: '₹1,699',
                        image: 'https://images.unsplash.com/photo-1556306535-38febf6782e7?w=400&h=400&fit=crop',
                        handle: 'vintage-round'
                    },
                    {
                        id: '4',
                        title: 'Blue Light Blockers',
                        price: '₹1,299',
                        image: 'https://images.unsplash.com/photo-1508296695146-257a814070b4?w=400&h=400&fit=crop',
                        handle: 'blue-light-blockers'
                    },
                    {
                        id: '5',
                        title: 'Designer Cat Eye',
                        price: '₹2,199',
                        image: 'https://images.unsplash.com/photo-1583394838336-acd977736f90?w=400&h=400&fit=crop',
                        handle: 'designer-cat-eye'
                    },
                    {
                        id: '6',
                        title: 'Sport Sunglasses',
                        price: '₹1,799',
                        image: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400&h=400&fit=crop',
                        handle: 'sport-sunglasses'
                    }
                ];
                
                renderProducts(products);
                */
                console.log('✅ DISABLED default products - using real API data');

            } catch (error) {
                console.error('❌ Error loading products:', error);
                document.getElementById('products-grid').innerHTML = `
                    <div class="error-message">
                        <p>Unable to load products</p>
                        <p style="font-size: 0.9em; opacity: 0.7;">Please check your connection and try again</p>
                    </div>
                `;
            }
        }

        // Live Eyeglasses Data Loading - DISABLED to prevent 500 errors
        async function loadLiveEyeglasses() {
            try {
                console.log('👓 Live eyeglasses loading disabled to prevent 500 errors');
                // API call disabled temporarily to fix 500 errors
                // const apiUrl = `${API_BASE}/api/live-eyeglasses`;
                return; // Skip API call
            } catch (apiError) {
                console.log('⚠️ Eyeglasses API failed:', apiError);
                // Keep existing hardcoded data as fallback
            }
        }

                // Live Sunglasses Data Loading - DISABLED to prevent 500 errors
        async function loadLiveSunglasses() {
            try {
                console.log('🕶️ Live sunglasses loading disabled to prevent 500 errors');
                // API call disabled temporarily to fix 500 errors
                // const apiUrl = `${API_BASE}/api/live-sunglasses`;
                return; // Skip API call
            } catch (apiError) {
                console.log('⚠️ Sunglasses API failed:', apiError);
                // Keep existing hardcoded data as fallback
            }
        }

        // Render Functions
        function renderCollections(collectionsData) {
            const collectionsGrid = document.getElementById('collections-grid');
            
            if (!collectionsData || collectionsData.length === 0) {
                collectionsGrid.innerHTML = `
                    <div class="empty-cart">
                        <p>No collections available</p>
                    </div>
                `;
                return;
            }
            
            collectionsGrid.innerHTML = collectionsData.map((collection, index) => {
                console.log(`🖼️ [COLLECTION DEBUG] Processing collection ${index}:`, collection);
                
                // Enhanced image URL handling for mobile apps
                let imageUrl = collection.image;
                console.log(`🖼️ [COLLECTION DEBUG] Original image URL:`, imageUrl);
                
                // Clean and validate image URL
                if (imageUrl) {
                    // Ensure HTTPS for mobile apps
                    if (imageUrl.startsWith('//')) {
                        imageUrl = 'https:' + imageUrl;
                    } else if (imageUrl.startsWith('http://')) {
                        imageUrl = imageUrl.replace('http://', 'https://');
                    } else if (!imageUrl.startsWith('https://') && !imageUrl.startsWith('data:')) {
                        // Handle relative URLs - prepend Shopify domain if needed
                        if (imageUrl.startsWith('/')) {
                            imageUrl = 'https://cdn.shopify.com' + imageUrl;
                        }
                    }
                }
                
                // Use first product image as fallback
                if (!imageUrl && collection.products && collection.products.length > 0) {
                    imageUrl = collection.products[0].image;
                    console.log(`🖼️ [COLLECTION DEBUG] Using product image fallback:`, imageUrl);
                    
                    // Clean product image URL too
                    if (imageUrl) {
                        if (imageUrl.startsWith('//')) {
                            imageUrl = 'https:' + imageUrl;
                        } else if (imageUrl.startsWith('http://')) {
                            imageUrl = imageUrl.replace('http://', 'https://');
                        }
                    }
                }
                
                // Final fallback to a working embedded SVG placeholder
                if (!imageUrl) {
                    imageUrl = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9IiNEREQiLz4KPHBhdGggZD0iTTg1IDk1TDEwNSA5NUwxMDUgMTA1TDg1IDEwNVoiIGZpbGw9IiNBQUEiLz4KPC9zdmc+';
                    console.log(`🖼️ [COLLECTION DEBUG] Using embedded SVG placeholder`);
                }
                
                console.log(`🖼️ [COLLECTION DEBUG] Final image URL:`, imageUrl);
                
                return `
                        <a href="#" class="collection-card" onclick="console.log('🔍 DEBUG: Collection card clicked for handle:', '${collection.handle}'); showCollection('${collection.handle}'); return false;">
                    <div class="collection-image">
                            <img src="${imageUrl}" 
                                 alt="${collection.title}" 
                                 loading="lazy" 
                                 onerror="console.log('Collection image failed, using embedded placeholder'); this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9IiNEREQiLz4KPHBhdGggZD0iTTg1IDk1TDEwNSA5NUwxMDUgMTA1TDg1IDEwNVoiIGZpbGw9IiNBQUEiLz4KPC9zdmc+'"
                                 onload="console.log('✅ Collection image loaded successfully:', this.src)">
                    </div>
                    <h3 class="collection-title">${collection.title}</h3>
                        <p class="collection-count">${collection.products ? collection.products.length : 0} products</p>
                </a>
                `;
            }).join('');
        }

        function renderProducts(productsData) {
            const productsGrid = document.getElementById('products-grid');
            
            if (!productsData || productsData.length === 0) {
                productsGrid.innerHTML = `
                    <div class="empty-cart">
                        <p>No products available</p>
                    </div>
                `;
                return;
            }
            
            // First transform products and limit to 10 items
            const transformedProducts = transformProductsToFormat(productsData).slice(0, 10);
            
            console.log('🎨 RENDER: Featured products (10 max) with new design:', transformedProducts.length);
            
            // Store products data for addToBag function
            window.lastLoadedProducts = transformedProducts;
            
            productsGrid.innerHTML = transformedProducts.map((product, index) => {
                // Generate product code
                const productCode = `#${product.handle.substring(0, 2).toUpperCase()}${String(index + 1).padStart(2, '0')}`;
                
                // Generate random color count for indicator
                const colorCount = Math.floor(Math.random() * 8) + 3; // 3-10 colors
                
                return `
                    <a href="#" class="product-card" onclick="event.preventDefault(); event.stopPropagation(); console.log('🔍 FEATURED PRODUCT CLICKED:', '${product.handle}'); window.openProductFromCollection ? window.openProductFromCollection('${product.handle}', event) : console.error('openProductFromCollection not found');">
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.title}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgwIiBoZWlnaHQ9IjI4MCIgdmlld0JveD0iMCAwIDI4MCAyODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyODAiIGhlaWdodD0iMjgwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMTIgMTEySDE2OFYxNjhIMTEyVjExMloiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+Cg=='">
                            
                            <!-- Color Indicator -->
                            <div class="color-indicator">
                                <div class="color-segments">
                                    <div class="color-segment segment-blue"></div>
                                    <div class="color-segment segment-orange"></div>
                                    <div class="color-segment segment-gray"></div>
                                </div>
                                ${colorCount}
                            </div>
                        </div>
                        
                        <div class="product-info">
                            <div class="product-code">${productCode}</div>
                            <h3 class="product-title">${product.title}</h3>
                            
                            <div class="product-bottom">
                                <span class="current-price">${product.price}</span>
                                <button class="add-to-bag-btn" onclick="event.stopPropagation(); addToBag('${product.handle}', event)">
                                    <svg class="add-to-bag-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
                                        <line x1="3" y1="6" x2="21" y2="6"/>
                                        <path d="M16 10a4 4 0 01-8 0"/>
                                    </svg>
                                    ADD TO BAG
                                </button>
                            </div>
                        </div>
                    </a>
                `;
            }).join('');
            
            // Apply consistent styling immediately after rendering
            setTimeout(() => {
                applyConsistentStyling();
            }, 50);
        }
        
        // Add to bag function for featured products
        function addToBag(productHandle, event) {
            event.preventDefault();
            event.stopPropagation();
            
            console.log('🛍️ Adding to bag:', productHandle);
            
            // Find the product data
            const productData = window.lastLoadedProducts?.find(p => p.handle === productHandle);
            if (!productData) {
                console.error('Product not found:', productHandle);
                return;
            }
            
            // Add visual feedback
            const button = event.target.closest('.add-to-bag-btn');
            const originalText = button.innerHTML;
            button.innerHTML = `
                <svg class="add-to-bag-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 6L9 17l-5-5"/>
                </svg>
                ADDED!
            `;
            button.style.background = '#10b981';
            
            // Add to cart
            addToCart(productData.id, productData.title, productData.price, productData.image, 1);
            
            // Reset button after 2 seconds
            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.background = '';
            }, 2000);
        }

        // Live Eyeglasses Render Function
        function renderLiveEyeglasses(data) {
            const categoriesSection = document.getElementById('categories-section');
            if (!categoriesSection) return;

            const categoryHeader = categoriesSection.querySelector('.category-title');
            if (categoryHeader && data.title) {
                categoryHeader.textContent = data.title;
            }

            const subcategoriesContainer = categoriesSection.querySelector('.subcategories');
            if (!subcategoriesContainer) return;

            if (!data.categories || data.categories.length === 0) {
                // Keep existing hardcoded categories as fallback
                return;
            }

            subcategoriesContainer.innerHTML = data.categories.map(category => `
                <a href="#" class="subcategory-card" data-category="${category.id}">
                    <div class="subcategory-image">
                        <img src="${category.image}" alt="${category.id}">
                    </div>
                    <div class="subcategory-title">${category.id.charAt(0).toUpperCase() + category.id.slice(1).replace(/-/g, ' ')}</div>
                </a>
            `).join('');

            // Update products for each category if products data is available
            if (data.products && data.products.length > 0) {
                // Store products globally for use in drawer
                window.eyeglassProducts = data.products;
            }
            
            // Store sale banner data globally
            if (data.saleBanner) {
                window.eyeglassesSaleBanner = data.saleBanner;
                updateGlobalSaleBanner(); // Update global banner immediately
                
                data.categories.forEach(category => {
                    const categoryProducts = data.products.filter(product => 
                        product.category === category.id || 
                        product.category === category.title?.toLowerCase() ||
                        product.id.includes(category.id)
                    );
                    
                    const productGrid = document.getElementById(`${category.id}-products`);
                    if (productGrid && categoryProducts.length > 0) {
                        productGrid.innerHTML = categoryProducts.map(product => `
                            <a href="#" class="category-product-card" onclick="handleProductClick('${product.id}', '${product.linkType || 'none'}', '${product.link || ''}', '${product.brand || product.title}', '${product.price}', '${product.image || ''}', '${product.offer || ''}')">
                                <div class="category-product-image">
                                    <img src="${product.image || product.image_url || 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=100&h=100&fit=crop'}" alt="${product.brand || product.title}">
                                </div>
                                <div class="category-product-info">
                                    <div class="category-product-brand">${product.brand || product.title}</div>
                                    <div class="category-product-price">Starts at ₹${product.price}</div>
                                    <div class="category-product-offer">${product.offer || 'Free shipping'}</div>
                                </div>
                            </a>
                        `).join('');
                        console.log(`✅ Loaded ${categoryProducts.length} products for ${category.id}`);
                    }
                });
            }

            console.log(`✅ Rendered ${data.categories.length} eyeglasses categories`);
            
            // Re-initialize event handlers after dynamic content is loaded
            setTimeout(() => {
                initializeCategorySection();
                console.log('🔄 Re-initialized category section after eyeglasses render');
            }, 100);
        }

        // Live Sunglasses Render Function
        function renderLiveSunglasses(data) {
            const sunglassesSection = document.getElementById('sunglasses-categories-section');
            if (!sunglassesSection) return;

            const categoryHeader = sunglassesSection.querySelector('.category-title');
            if (categoryHeader && data.title) {
                categoryHeader.textContent = data.title;
            }

            const subcategoriesContainer = sunglassesSection.querySelector('.subcategories');
            if (!subcategoriesContainer) return;

            if (!data.categories || data.categories.length === 0) {
                // Keep existing hardcoded categories as fallback
                    return;
                }
                
            subcategoriesContainer.innerHTML = data.categories.map(category => `
                <a href="#" class="subcategory-card" data-category="${category.id}">
                    <div class="subcategory-image">
                        <img src="${category.image}" alt="${category.id}">
                    </div>
                    <div class="subcategory-title">${category.id.charAt(0).toUpperCase() + category.id.slice(1).replace(/-sunglasses/g, '').replace(/-/g, ' ')}</div>
                </a>
            `).join('');

            // Update products for each category if products data is available
            if (data.products && data.products.length > 0) {
                // Store products globally for use in drawer
                window.sunglassProducts = data.products;
            }
            
            // Store sale banner data globally
            if (data.saleBanner) {
                window.sunglassesSaleBanner = data.saleBanner;
                updateGlobalSaleBanner(); // Update global banner immediately
                
                data.categories.forEach(category => {
                    const categoryProducts = data.products.filter(product => 
                        product.category === category.id || 
                        product.category === category.title?.toLowerCase() ||
                        product.id.includes(category.id)
                    );
                    
                    const productGrid = document.getElementById(`${category.id}-products`);
                    if (productGrid && categoryProducts.length > 0) {
                        productGrid.innerHTML = categoryProducts.map(product => `
                            <a href="#" class="category-product-card" onclick="handleProductClick('${product.id}', '${product.linkType || 'none'}', '${product.link || ''}', '${product.brand || product.title}', '${product.price}', '${product.image || ''}', '${product.offer || ''}')">
                                <div class="category-product-image">
                                    <img src="${product.image || product.image_url || 'https://images.unsplash.com/photo-1556306535-38febf6782e7?w=100&h=100&fit=crop'}" alt="${product.brand || product.title}">
                                </div>
                                <div class="category-product-info">
                                    <div class="category-product-brand">${product.brand || product.title}</div>
                                    <div class="category-product-price">Starts at ₹${product.price}</div>
                                    <div class="category-product-offer">${product.offer || 'Free shipping'}</div>
                                </div>
                            </a>
                        `).join('');
                        console.log(`✅ Loaded ${categoryProducts.length} products for ${category.id}`);
                    }
                });
            }

            console.log(`✅ Rendered ${data.categories.length} sunglasses categories`);
            
            // Re-initialize event handlers after dynamic content is loaded
            setTimeout(() => {
                initializeCategorySection();
                console.log('🔄 Re-initialized category section after sunglasses render');
            }, 100);
        }

                 // Product/Collection Navigation - Enhanced Implementation
         async function showProduct(handle) {
             console.log('🔍 Opening product detail page for:', handle);
             
             // Use embedded product detail page
             await loadProductDetailPage(handle);
         }
        
                 // Find product by handle in all product sources
         async function findProductByHandle(handle) {
             console.log('🔍 Finding product by handle:', handle);
             
             // First try to fetch from mobile-products API for enhanced data
             try {
                 console.log('🌐 Fetching from mobile-products API...');
                 const response = await fetch(`${API_BASE}/api/mobile-products`);
                 if (response.ok) {
                     const data = await response.json();
                     if (data.success && data.collections) {
                         console.log('✅ Mobile products data received, searching for product...');
                         
                         // Search through all collections for the product
                         for (const collection of data.collections) {
                             const product = collection.products.find(p => p.handle === handle);
                             if (product) {
                                 console.log('✅ Product found in collection:', collection.title);
                                 return enhanceProductFromAPI(product);
                             }
                         }
                         
                         // Also search in the main products array if available
                         if (data.products) {
                             const product = data.products.find(p => p.handle === handle);
                             if (product) {
                                 console.log('✅ Product found in main products array');
                                 return enhanceProductFromAPI(product);
                             }
                         }
                     }
                 }
                 
                 // Fallback: Try the product-detail endpoint
                 console.log('🔄 Trying product-detail endpoint as fallback...');
                 const detailResponse = await fetch(`${API_BASE}/api/product-detail?handle=${encodeURIComponent(handle)}`);
                 if (detailResponse.ok) {
                     const detailData = await detailResponse.json();
                     if (detailData.success && detailData.product) {
                         console.log('✅ Product data fetched from product-detail API:', detailData.product.title);
                         return detailData.product;
                     }
                 }
             } catch (error) {
                 console.log('⚠️ API fetch failed, falling back to local data:', error);
             }
             
             // Fallback to local product searches
             let product = products.find(p => p.handle === handle);
             if (product) {
                 console.log('📱 Found in main products:', product.title);
                 return enhanceLocalProduct(product);
             }
             
             // Search in eyeglass products
             if (window.eyeglassProducts) {
                 product = window.eyeglassProducts.find(p => p.handle === handle || p.id === handle);
                 if (product) {
                     console.log('👓 Found in eyeglass products:', product.title || product.brand);
                     return enhanceLocalProduct(product);
                 }
             }
             
             // Search in sunglass products
             if (window.sunglassProducts) {
                 product = window.sunglassProducts.find(p => p.handle === handle || p.id === handle);
                 if (product) {
                     console.log('🕶️ Found in sunglass products:', product.title || product.brand);
                     return enhanceLocalProduct(product);
                 }
             }
             
             console.log('❌ Product not found anywhere for handle:', handle);
             return null;
         }
         
         // Enhance product data from API with proper formatting for product detail page
         function enhanceProductFromAPI(product) {
             console.log('🎨 Enhancing API product data:', product);
             
             // Calculate pricing information
             const currentPrice = parseFloat(product.price || '0');
             const compareAtPrice = product.variants && product.variants[0] && product.variants[0].compareAtPrice 
                 ? parseFloat(product.variants[0].compareAtPrice) 
                 : null;
             
             let discount = 0;
             let originalPrice = null;
             
             if (compareAtPrice && compareAtPrice > currentPrice) {
                 discount = Math.round(((compareAtPrice - currentPrice) / compareAtPrice) * 100);
                 originalPrice = `₹${compareAtPrice}`;
             }
             
             return {
                 id: product.id || product.handle || '1',
                 handle: product.handle || product.id || 'unknown',
                 title: product.title || 'Unknown Product',
                 subtitle: 'Premium Eyewear Collection',
                 price: `₹${currentPrice}`,
                 originalPrice: originalPrice,
                 discount: discount,
                 image: product.image || (product.images && product.images[0]) || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iODAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjQwMCIgY3k9IjQwMCIgcj0iMTIwIiBmaWxsPSIjREREIi8+CjxwYXRoIGQ9Ik0zNDAgMzgwTDQ2MCAzODBMNDYwIDQyMEwzNDAgNDIwWiIgZmlsbD0iI0FBQSIvPgo8L3N2Zz4=',
                 images: product.images || [product.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iODAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjQwMCIgY3k9IjQwMCIgcj0iMTIwIiBmaWxsPSIjREREIi8+CjxwYXRoIGQ9Ik0zNDAgMzgwTDQ2MCAzODBMNDYwIDQyMEwzNDAgNDIwWiIgZmlsbD0iI0FBQSIvPgo8L3N2Zz4='],
                 rating: 4.5,
                 ratingCount: Math.floor(Math.random() * 300) + 100,
                 description: product.description || 'High-quality eyewear designed for comfort and style. Features premium materials and superior craftsmanship.',
                 features: ['Premium Quality', 'UV Protection', 'Comfortable Fit', 'Durable Material', '1 Year Warranty'],
                 isNew: Math.random() > 0.5, // Random new badge
                 inStock: product.available !== false,
                 feature: 'Anti-reflective coating & UV protection',
                 variants: product.variants || [],
                 deliveryTime: "2-3 business days",
                 freeShipping: true,
                 returnPolicy: "30-day free returns",
                 warranty: "1-year manufacturer warranty"
             };
         }
         
         // Enhance local product data with additional fields for product detail page
         function enhanceLocalProduct(product) {
             return {
                 id: product.id || product.handle || '1',
                 handle: product.handle || product.id || 'unknown',
                 title: product.title || product.brand || 'Unknown Product',
                 subtitle: product.subtitle || 'Premium Eyewear Collection',
                 price: product.price || '₹1,999',
                 originalPrice: product.originalPrice, // Keep real API data if exists
                 compareAtPrice: product.compareAtPrice,
                 discount: product.discount || Math.floor(Math.random() * 30) + 15, // Add test discount 15-45%
                 image: product.image || product.image_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iODAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjQwMCIgY3k9IjQwMCIgcj0iMTIwIiBmaWxsPSIjREREIi8+CjxwYXRoIGQ9Ik0zNDAgMzgwTDQ2MCAzODBMNDYwIDQyMEwzNDAgNDIwWiIgZmlsbD0iI0FBQSIvPgo8L3N2Zz4=',
                 images: product.images || [product.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjgwMCIgdmlld0JveD0iMCAwIDgwMCA4MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iODAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjQwMCIgY3k9IjQwMCIgcj0iMTIwIiBmaWxsPSIjREREIi8+CjxwYXRoIGQ9Ik0zNDAgMzgwTDQ2MCAzODBMNDYwIDQyMEwzNDAgNDIwWiIgZmlsbD0iI0FBQSIvPgo8L3N2Zz4='],
                 rating: product.rating || 4.5,
                 ratingCount: product.ratingCount || Math.floor(Math.random() * 300) + 100,
                 description: product.description || 'High-quality eyewear designed for comfort and style.',
                 features: product.features || ['Premium Quality', 'Comfortable Fit', 'Durable Material'],
                 isNew: product.isNew || false,
                 inStock: product.inStock !== false,
                 feature: product.feature || product.offer || 'Anti-reflective coating & UV protection'
             };
         }
        
        // Open Product Detail Page
        function openProductDetailPage(product) {
            console.log('📱 Opening product detail page for:', product.title);
            console.log('🚨 FORCE: Opening FULL-SCREEN product detail page (not modal)');
            
            // DEBUG: Log the actual product data received from API
            console.log('🔍 ACTUAL PRODUCT DATA FROM API:', {
                title: product.title,
                price: product.price,
                originalPrice: product.originalPrice,
                discount: product.discount,
                id: product.id,
                hasApiId: !!product.id,
                hasOriginalPrice: !!product.originalPrice,
                apiSource: product.id ? 'Shopify API' : 'Local fallback'
            });
            
            // PREVENT SCROLL JUMP - Save current scroll position before any changes
            const currentScrollY = window.scrollY || document.documentElement.scrollTop;
            console.log('📍 Preventing scroll jump, current position:', currentScrollY);
            
            // Note: Zero body manipulation preserves safe area completely
            
            // FORCE CLOSE ANY MODALS FIRST
            const existingModals = document.querySelectorAll('.product-modal');
            existingModals.forEach(modal => modal.remove());
            console.log('🚨 FORCE: Removed any existing modals');
            
            // PRESERVE SAFE AREA - NO BODY MANIPULATION
            // Simply store scroll position without any CSS changes
            window.tempScrollPosition = currentScrollY;
            console.log('📦 Stored scroll position without body changes:', currentScrollY);
            
            // FORCE FULL-SCREEN MODE without scroll jump
            document.body.classList.add('hide-header');
            console.log('🚨 FORCE: Set body to full-screen mode without scroll jump');
            
            // Hide main app content COMPLETELY
            hideMainContent();
            
            // Hide collection page
            const collectionPage = document.getElementById('collection-full-page');
            if (collectionPage) {
                collectionPage.style.display = 'none';
            }
            
            console.log('🚨 FORCE: Hidden all background content');
            
            // Create and show FULL-SCREEN product detail page
            createProductDetailPage(product);
            console.log('🚨 FORCE: Created full-screen product detail page');
            
            // Update current view
            currentView = 'product-detail';
            
                         // Update navigation state
             updateNavigationForProductPage();
         }
         
         // Create Product Detail Page
         function createProductDetailPage(product) {
             console.log('🚨 CREATING FULL-SCREEN PRODUCT DETAIL PAGE');
             
             // Remove existing product detail page if it exists
             removeProductDetailPage();
             
             // FORCE REMOVE ANY MODALS
             const modals = document.querySelectorAll('.product-modal, .modal, .popup');
             modals.forEach(modal => {
                 console.log('🚨 FORCE: Removing modal:', modal.className);
                 modal.remove();
             });
             
             // Create product detail container
             const productDetailPage = document.createElement('div');
             productDetailPage.id = 'product-detail-page';
             productDetailPage.className = 'product-detail-page';
             
             // FORCE FULL-SCREEN STYLES
             productDetailPage.style.cssText = `
                 position: fixed !important;
                 top: 0 !important;
                 left: 0 !important;
                 width: 100% !important;
                 height: 100% !important;
                 z-index: 9999 !important;
                 background: white !important;
                 overflow-y: auto !important;
                 display: block !important;
             `;
             
             console.log('🚨 FORCE: Applied full-screen styles to product detail page');
             
             // Generate product detail HTML
             const generatedHTML = generateProductDetailHTML(product);
             
             // DEBUG: Check if pricing HTML is in the generated template
             const hasPriceOriginal = generatedHTML.includes('price-original');
             const hasPriceDiscount = generatedHTML.includes('price-discount');
             const pricingMatch = generatedHTML.match(/<div class="product-price"[^>]*>(.*?)<\/div>/s);
             
             console.log('🎨 GENERATED HTML DEBUGGING:', {
                 hasOriginalPrice: hasPriceOriginal,
                 hasDiscount: hasPriceDiscount,
                 pricingHTML: pricingMatch ? pricingMatch[1] : 'PRICING SECTION NOT FOUND',
                 totalHTMLLength: generatedHTML.length
             });
             
             productDetailPage.innerHTML = generatedHTML;
             
             // Add to body
             document.body.appendChild(productDetailPage);
             
             // Trigger smooth slide-in animation
             setTimeout(() => {
                 productDetailPage.classList.add('active');
                 console.log('🎬 Product detail page slide-in animation started');
             }, 10);
             
             // Initialize product detail functionality
             initializeProductDetailPage(product);
             
             // FORCE INITIALIZE IMAGE SLIDER
             setTimeout(() => {
                 console.log('🖼️ FORCE: Initializing image slider...');
                 initializeImageSlider();
                 console.log('🖼️ FORCE: Image slider initialized');
             }, 100);
             
             // DEBUG: Check actual DOM after rendering
             setTimeout(() => {
                 const priceSection = document.querySelector('.product-price');
                 if (priceSection) {
                     console.log('🎯 FINAL DOM PRICING CHECK:', {
                         innerHTML: priceSection.innerHTML,
                         hasPriceOriginal: priceSection.querySelector('.price-original') !== null,
                         priceOriginalText: priceSection.querySelector('.price-original')?.textContent || 'NOT FOUND',
                         priceCurrentText: priceSection.querySelector('.price-current')?.textContent || 'NOT FOUND'
                     });
                 } else {
                     console.error('❌ .product-price section not found in DOM!');
                 }
             }, 100);
             
             // Add styles
             addProductDetailStyles();
         }
         
         // Generate Product Detail HTML
         function generateProductDetailHTML(product) {
             console.log('🎯 STARTING generateProductDetailHTML with product:', {
                 title: product.title,
                 price: product.price,
                 originalPrice: product.originalPrice,
                 discount: product.discount,
                 id: product.id,
                 hasRealData: !!product.id
             });
             console.log('🎨 GENERATING PRODUCT DETAIL HTML:', product);
             
             // Debug what we received from API
             console.log('🛒 Product data from API:', {
                 title: product.title,
                 price: product.price,
                 originalPrice: product.originalPrice,
                 discount: product.discount,
                 hasOriginalPrice: !!product.originalPrice,
                 isRealApiData: !!product.id // Products from API will have IDs
             });
             
             // Check if this is real API data (has product.id) and preserve it
             if (product.id && product.originalPrice) {
                 // This is REAL Shopify data with compare-at pricing - DO NOT OVERRIDE!
                 console.log('✅ PRESERVING REAL SHOPIFY COMPARE-AT PRICING:', { 
                     productId: product.id,
                     title: product.title,
                     currentPrice: product.price,
                     realCompareAtPrice: product.originalPrice, 
                     realDiscount: product.discount,
                     source: 'Shopify API'
                 });
             } else if (product.id && !product.originalPrice) {
                 // Real API data but no compare-at price set in Shopify
                 console.log('⚠️ Real Shopify product but no compare-at price set:', {
                     productId: product.id,
                     title: product.title,
                     currentPrice: product.price,
                     shopifyCompareAtPrice: 'Not set'
                 });
             } else if (!product.id && (!product.originalPrice || product.originalPrice === product.price)) {
                 // This is local fallback data - DON'T add fake pricing, preserve real data
                 console.log('⚠️ PRESERVED: Local fallback data without compare-at price (no fake pricing added):', { 
                     currentPrice: product.price, 
                     originalPrice: product.originalPrice,
                     willAddFakePrice: false,
                     source: 'Local fallback - preserved'
                 });
             } else {
                 console.log('✅ Real data preserved:', { hasId: !!product.id, hasOriginalPrice: !!product.originalPrice });
             }
             
             // Ensure product has description
             if (!product.description) {
                 product.description = 'Premium quality eyewear featuring advanced lens technology and superior comfort. These glasses combine modern style with exceptional durability, perfect for everyday wear. UV protection and anti-reflective coating included.';
                 console.log('🔧 FORCED DESCRIPTION ADDED');
             }
             
             const rating = product.rating || 4.5;
             const ratingCount = product.ratingCount || Math.floor(Math.random() * 500) + 100;
             
             // Use real Shopify compare-at prices - only show if different from current price
             const currentPriceNum = parseFloat(product.price.replace(/[^\d.]/g, ''));
             const originalPriceNum = product.originalPrice ? parseFloat(product.originalPrice.replace(/[^\d.]/g, '')) : null;
             
             // Debug pricing data
             console.log('💰 Mobile App Pricing Debug:', {
                 productTitle: product.title,
                 currentPrice: product.price,
                 currentPriceNum: currentPriceNum,
                 originalPrice: product.originalPrice,
                 originalPriceNum: originalPriceNum,
                 discount: product.discount
             });
             
             // SIMPLIFIED PRICING LOGIC - Force show pricing if we have originalPrice
             let originalPrice = null;
             let discount = 0;
             
             // ONLY DISPLAY pricing if product has REAL originalPrice from Shopify
             if (product.originalPrice && product.originalPrice !== product.price) {
                 originalPrice = originalPriceNum || parseFloat(product.originalPrice.replace(/[^\d.]/g, ''));
                 discount = product.discount || Math.round(((originalPrice - currentPriceNum) / originalPrice) * 100);
                 console.log('✅ DISPLAYING REAL SHOPIFY PRICING:', { originalPrice, discount, productOriginalPrice: product.originalPrice });
             } else {
                 // DON'T generate fake pricing - only show current price
                 originalPrice = null;
                 discount = 0;
                 console.log('⚠️ NO REAL COMPARE-AT PRICE: Showing current price only (no fake pricing):', { currentPrice: product.price });
             }
             
             // ENSURE we have pricing to display
             if (originalPrice && originalPrice > currentPriceNum) {
                 console.log('✅ FINAL PRICING TO DISPLAY:', { 
                     current: product.price, 
                     original: `₹${originalPrice}`, 
                     discount: `${discount}% OFF` 
                 });
             } else {
                 console.log('⚠️ NO PRICING TO DISPLAY - will show current price only');
             }
             
             console.log('🔢 TEMPLATE VARIABLES BEFORE TEMPLATE:', {
                 currentPriceNum,
                 originalPriceNum,
                 finalOriginalPrice: originalPrice,
                 finalDiscount: discount,
                 willShowInTemplate: originalPrice !== null,
                 templateWillRender: originalPrice ? `₹${originalPrice}` : 'NO COMPARE PRICE'
             });
             
             // FORCE originalPrice for debugging if we have product.originalPrice
             if (product.originalPrice && !originalPrice) {
                 console.log('🚨 FORCING originalPrice because product.originalPrice exists but originalPrice is null');
                 const forceOriginalPrice = parseFloat(product.originalPrice.replace(/[^\d.]/g, ''));
                 console.log('🚨 Forced values:', { forceOriginalPrice, currentPriceNum, condition: forceOriginalPrice > currentPriceNum });
             }
             
             console.log('💰 Mobile App Final Display:', { 
                 originalPrice, 
                 discount, 
                 hasDescription: !!product.description,
                 willShowOriginalPrice: originalPrice !== null,
                 willShowDiscount: discount > 0 
             });
             
             // Generate the pricing HTML strings for debugging
             const priceHtml = `<span class="price-current">${product.price}</span>`;
             const originalPriceHtml = originalPrice ? `<span class="price-original">₹${originalPrice}</span>` : '';
             const discountHtml = discount ? `<span class="price-discount">${discount}% OFF</span>` : '';
             
             console.log('🎨 HTML Fragments:', {
                 priceHtml,
                 originalPriceHtml,
                 discountHtml,
                 originalPriceHtmlLength: originalPriceHtml.length,
                 originalPriceIsEmpty: originalPriceHtml === '',
                 descriptionExists: !!product.description,
                 descriptionText: product.description
             });
             
             // CRITICAL DEBUG: Show exact template substitution
             console.log('🔥 TEMPLATE SUBSTITUTION CHECK:', {
                 templateCondition: `originalPrice = ${originalPrice}`,
                 willRenderOriginalPrice: originalPrice ? `YES: ₹${originalPrice}` : 'NO: originalPrice is null/undefined',
                 discountCondition: `discount = ${discount}`,
                 willRenderDiscount: discount ? `YES: ${discount}% OFF` : 'NO: discount is 0'
             });
             
             console.log('📋 DESCRIPTION SECTION WILL BE RENDERED:', {
                 hasDescription: !!product.description,
                 descriptionLength: product.description ? product.description.length : 0,
                 willShow: true
             });
             
             return `
                 <!-- Product Detail Page Container - Generated: ${new Date().toISOString()} -->
                 <div class="product-detail-container">
                     <!-- Top Navigation -->
                     <div class="product-top-nav">
                         <button class="nav-button back-button" onclick="closeProductDetailPage()">
                             <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                 <path d="M19 12H5M12 19l-7-7 7-7"/>
                             </svg>
                         </button>
                         
                         <div class="product-title-header" id="product-nav-title">
                             ${product.title}
                         </div>
                         
                         <div class="nav-right">
                             <button class="nav-button share-button" onclick="shareProduct('${product.handle}')">
                                 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                     <circle cx="18" cy="5" r="3"></circle>
                                     <circle cx="6" cy="12" r="3"></circle>
                                     <circle cx="18" cy="19" r="3"></circle>
                                     <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                     <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                 </svg>
                             </button>
                             
                             <button class="nav-button cart-button" onclick="showCartPage()">
                                 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                     <circle cx="9" cy="21" r="1"></circle>
                                     <circle cx="20" cy="21" r="1"></circle>
                                     <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                 </svg>
                                 <span class="cart-count" id="product-cart-count">${cart.length || ''}</span>
                             </button>
                         </div>
                     </div>
                     
                     <!-- Product Media -->
                     <div class="product-media">
                         <div class="product-image-slider" id="imageSlider">
                             ${(product.images || [product.image]).map((img, index) => `
                                 <div class="product-image-slide ${index === 0 ? 'active' : ''}">
                                     <img src="${img}" alt="${product.title}" class="product-main-image">
                                     
                                     <!-- Rating Overlay (only on first image) -->
                                     ${index === 0 ? `
                             <div class="rating-overlay-widget">
                                 <div class="rating-overlay-content">
                                     <span class="rating-value">${rating}</span>
                                     <span class="rating-star">★</span>
                                     <span class="rating-count">(${ratingCount})</span>
                                 </div>
                             </div>
                                     ` : ''}
                                     
                                     <!-- New Launch Badge (only on first image) -->
                                     ${index === 0 && product.isNew ? '<div class="new-launch-badge">NEW LAUNCH</div>' : ''}
                                 </div>
                             `).join('')}
                         </div>
                         
                         <!-- Image Pagination Dots -->
                         <div class="image-pagination">
                             ${(product.images || [product.image]).map((_, index) => `
                                 <span class="pagination-dot ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></span>
                             `).join('')}
                         </div>
                     </div>
                     
                     <!-- Product Info -->
                     <div class="product-info">
                         <div class="product-info__content">
                             <!-- Product Title & Wishlist -->
                             <div class="product-title">
                                 <h1>${product.title}</h1>
                                 <button class="wishlist-button" onclick="toggleWishlist('${product.handle}')">
                                     <svg class="heart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                         <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                     </svg>
                                 </button>
                             </div>
                             
                             <!-- Product Subtitle -->
                             <p class="product-subtitle">${product.subtitle || 'Premium Eyewear Collection'}</p>
                             
                             <!-- Product Features -->
                             <p class="product-feature">✓ ${product.feature || 'Anti-reflective coating & UV protection'}</p>
                             
                             <!-- Rating Display -->
                             <div class="product-rating-block">
                                 <div class="product-rating">
                                     <span class="rating-stars">★★★★★</span>
                                     <span class="rating-value">${rating}</span>
                                     <span class="rating-count">(${ratingCount} reviews)</span>
                                 </div>
                             </div>
                             
                             <!-- Price Section -->
                             <div class="product-price">
                                 <span class="price-current">${product.price}</span>
                                 ${originalPrice ? `<span class="price-original">₹${originalPrice}</span>` : ''}
                                 ${discount ? `<span class="price-discount">${discount}% OFF</span>` : ''}
                             </div>
                             
                             <!-- Product Description Section -->
                             <div class="description-section">
                                 <button class="description-toggle" onclick="toggleDescription()">
                                     <span>Product Description</span>
                                     <svg class="description-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                         <path d="M19 9l-7 7-7-7"></path>
                                     </svg>
                                 </button>
                                 <div class="description-content expanded" id="descriptionContent">
                                     <p>${product.description || 'High-quality eyewear with premium materials and design. Perfect for everyday wear with excellent comfort and style.'}</p>
                                 </div>
                             </div>
                             
                             <!-- Product Actions -->
                             <div class="product-actions">
                                 <button class="action-btn" onclick="viewSizeGuide()">
                                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                         <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                     </svg>
                                     <span>Size Guide</span>
                                 </button>
                                 
                                 <button class="action-btn" onclick="tryVirtual('${product.handle}')">
                                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                         <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                         <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                     </svg>
                                     <span>Try On</span>
                                 </button>
                                 
                                 <button class="action-btn" onclick="viewReviews()">
                                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                         <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                                     </svg>
                                     <span>Reviews</span>
                                 </button>
                             </div>
                         </div>
                     </div>
                     
                     <!-- Bottom Purchase Section -->
                     <div class="buy-buttons">
                         <!-- Elegant Promo Banner -->
                         <div class="promo-banner">
                             <div class="promo-item">
                                 <svg class="promo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                     <path d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                                 </svg>
                                 <span>Free Shipping</span>
                             </div>
                             <div class="promo-divider">|</div>
                             <div class="promo-item">
                                 <svg class="promo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                     <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                                     <path d="M8 21v-4a2 2 0 012-2h4a2 2 0 012 2v4"/>
                                 </svg>
                                 <span>Easy Returns</span>
                             </div>
                             <div class="promo-divider">|</div>
                             <div class="promo-item">
                                 <svg class="promo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                     <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                     <path d="M7 11V7a5 5 0 0110 0v4"/>
                                 </svg>
                                 <span>Secure Checkout</span>
                             </div>
                         </div>
                         
                         <!-- Elegant Price & Action Section -->
                         <div class="price-container">
                             <div class="pricing-section">
                                 <div class="price-group">
                                     <div class="current-price">${product.price}</div>
                                     ${originalPrice && originalPrice !== parseFloat(product.price.replace(/[^\d]/g, '')) ? `
                                         <div class="compare-price">₹${originalPrice}</div>
                                         <div class="collection-discount-badge">${discount}% OFF</div>
                                     ` : ''}
                                 </div>
                                 <div class="tax-info">incl. of taxes</div>
                             </div>
                             
                             <div class="elegant-action-buttons">
                                 <button class="elegant-add-cart" onclick="addProductToCart('${product.handle}', '${product.id}', '${product.title}', '${product.price}', '${product.image}')">
                                     <span class="button-content">
                                         <svg class="cart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                             <circle cx="9" cy="21" r="1"></circle>
                                             <circle cx="20" cy="21" r="1"></circle>
                                             <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                                         </svg>
                                         <span class="btn-text">Add to Cart</span>
                                     </span>
                                     <span class="success-state">
                                         <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                             <path d="M20 6L9 17l-5-5"/>
                                         </svg>
                                         <span>Added</span>
                                     </span>
                                 </button>
                                 
                                 <button class="elegant-buy-now" onclick="buyProductNow('${product.handle}', '${product.id}', '${product.title}', '${product.price}', '${product.image}')">
                                     <span class="button-content">
                                         <svg class="lightning-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                             <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/>
                                         </svg>
                                         <span>Buy Now</span>
                                     </span>
                                 </button>
                             </div>
                         </div>
                     </div>
                     
                     <!-- WhatsApp Chat Button Removed -->
                 </div>
                           `;
          }
          
          // Initialize Product Detail Page functionality
          function initializeProductDetailPage(product) {
              // Setup scroll behavior for title header
              setupProductScrollBehavior();
              
              // Update cart count
              updateCartCount();
              
              // Initialize wishlist state
              updateWishlistState(product.handle);
              
              // Initialize image slider with auto-scroll
              setTimeout(() => {
                  startAutoSlide();
              }, 1000); // Start auto-slide after 1 second
              
              console.log('📱 Product detail page initialized with auto-slide');
          }
          
          // Setup scroll behavior for product page
          function setupProductScrollBehavior() {
              const productContainer = document.querySelector('.product-detail-container');
              const titleHeader = document.getElementById('product-nav-title');
              
              if (productContainer && titleHeader) {
                  productContainer.addEventListener('scroll', function() {
                      if (this.scrollTop > 100) {
                          titleHeader.style.opacity = '1';
                          titleHeader.style.visibility = 'visible';
                      } else {
                          titleHeader.style.opacity = '0';
                          titleHeader.style.visibility = 'hidden';
                      }
                  });
              }
          }
          
          // Close Product Detail Page
          function closeProductDetailPage() {
              console.log('🔙 Closing product detail page');
              
              // Restore scroll position with zero body manipulation
              const scrollY = window.tempScrollPosition || 0;
              
              // Only restore scroll position - no CSS changes
              window.scrollTo(0, scrollY);
              console.log('📍 Restored scroll position with zero body manipulation:', scrollY);
              
              // Clear temp storage
              delete window.tempScrollPosition;
              
              // Check navigation stack for where to return (don't pop here, let caller handle it)
              const previousPage = navigationStack.length > 0 ? navigationStack[navigationStack.length - 1] : null;
              console.log('📍 Previous page in stack:', previousPage);
              
              // Remove product detail page
              removeProductDetailPage();
              
              if (previousPage && previousPage.type === 'collection') {
                  // Return to collection page
                  console.log('🔙 Returning to collection:', previousPage.handle);
                  returnToCollectionPage(previousPage);
              } else if (previousPage && previousPage.type === 'homepage-featured') {
                  // Return directly to homepage featured products section without page refresh
                  console.log('🔙 Returning to homepage featured products without page refresh');
                  returnToHomepageFeaturedProducts(previousPage);
              } else {
                  // Fallback to home page
                  console.log('🏠 Fallback to home page');
                  returnToHomePage();
              }
          }
          
                     // Return to collection page smoothly
           function returnToCollectionPage(collectionInfo) {
               console.log('🚨 FORCE: Returning to collection page:', collectionInfo);
               
               // FORCE RESTORE BODY STATE
               document.body.style.overflow = '';
               document.body.classList.remove('hide-header');
               console.log('🚨 FORCE: Restored body state');
               
               const collectionPage = document.getElementById('collection-full-page');
               
               if (collectionPage) {
                   // Collection page still exists, restore it smoothly
                   console.log('✅ Collection page found, restoring...');
                   
                   // FORCE SHOW COLLECTION PAGE
                   collectionPage.style.display = 'block';
                   collectionPage.style.visibility = 'visible';
                   
                   // Show main app content but keep collection page mode
                   showMainContent();
                   
                   // Restore collection page with smooth animation
                   collectionPage.style.transition = 'transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.4s ease';
                   collectionPage.style.transform = 'translateX(0)';
                   collectionPage.style.opacity = '1';
                   
                   // Update navigation state
                   currentView = 'collection';
                   
                   console.log('✅ FORCE: Smoothly returned to collection page');
               } else {
                   // Collection page doesn't exist, recreate it
                   console.log('🔄 Collection page not found, reopening collection...');
                   
                   // FORCE SHOW MAIN APP CONTENT
                   showMainContent();
                   
                   // Reopen the collection after a brief delay
                   setTimeout(() => {
                       showCollection(collectionInfo.handle);
                   }, 100);
               }
           }
          
          // Return to homepage featured products section without page refresh
          function returnToHomepageFeaturedProducts(previousPage) {
              console.log('🔙 Restoring homepage featured products without refresh');
              
              // Simply restore the main app state without triggering showPage('home')
              showMainContent();
              
              // Ensure no collection pages are interfering
              const collectionPage = document.getElementById('collection-full-page');
              if (collectionPage) {
                  collectionPage.style.display = 'none';
              }
              
              // Update navigation state
              currentView = 'home';
              document.body.classList.remove('hide-header');
              
              // No body style restoration needed - never changed anything
              
              // Update navigation silently
              updateNavigationForMainApp();
              
              // Restore scroll position to featured products section
              if (previousPage && previousPage.scrollPosition !== undefined) {
                  setTimeout(() => {
                      window.scrollTo({
                          top: previousPage.scrollPosition,
                          behavior: 'auto' // Instant scroll for smooth UX
                      });
                      console.log('📍 Restored scroll to featured products:', previousPage.scrollPosition);
                  }, 50); // Small delay to ensure DOM is ready
              }
              
              console.log('✅ Returned to featured products section');
          }

          // Return to home page
          function returnToHomePage() {
              // Show main app content
              showMainContent();
              
              // Close any collection pages
              const collectionPage = document.getElementById('collection-full-page');
              if (collectionPage) {
                  document.body.removeChild(collectionPage);
                  document.body.classList.remove('collection-page-mode');
              }
              
              // Update navigation state
              currentView = 'home';
              document.body.classList.remove('hide-header');
              
              // Update navigation
              updateNavigationForMainApp();
              
              console.log('🏠 Returned to home page');
          }
          
          // Remove Product Detail Page
          function removeProductDetailPage() {
              const existingPage = document.getElementById('product-detail-page');
              if (existingPage) {
                  // Start slide-out animation
                  existingPage.classList.remove('active');
                  console.log('🎬 Product detail page slide-out animation started');
                  
                  // Remove element after animation completes
                  setTimeout(() => {
                      if (existingPage.parentNode) {
                  existingPage.remove();
                          console.log('🗑️ Product detail page element removed');
                      }
                  }, 400); // Match the transition duration
              }
          }
          
          // Add Product to Cart with Shopify Integration
          async function addProductToCart(handle, productId, title, price, image) {
              console.log('🛒 Adding product to cart:', { handle, productId, title, price });
              
              try {
                  // Show loading state
                  const addButton = document.querySelector('.add-to-cart');
                  if (addButton) {
                      addButton.classList.add('loading');
                      addButton.disabled = true;
                  }
                  
                  // Create variant ID (simplified for demo)
                  const variantId = `gid://shopify/ProductVariant/${productId}_001`;
                  
                                     // Add to Shopify cart using existing cart system
                   const success = await addToShopifyCart(variantId, 1, title, price, image);
                  
                  if (success) {
                      // Show success state
                      if (addButton) {
                          addButton.classList.remove('loading');
                          addButton.classList.add('success');
                          
                          setTimeout(() => {
                              addButton.classList.remove('success');
                              addButton.disabled = false;
                          }, 2000);
                      }
                      
                      // Update cart count in product page
                      updateCartCount();
                      
                      // Show success message
                      showToast(`${title} added to cart!`);
                      
                  } else {
                      throw new Error('Failed to add to cart');
                  }
                  
              } catch (error) {
                  console.error('Error adding to cart:', error);
                  
                  // Reset button state
                  const addButton = document.querySelector('.add-to-cart');
                  if (addButton) {
                      addButton.classList.remove('loading');
                      addButton.disabled = false;
                  }
                  
                  // Show error message
                  showToast('Failed to add to cart. Please try again.');
              }
          }
          
                     // Buy Product Now with Shopify Draft Order Integration
           async function buyProductNow(handle, productId, title, price, image) {
               console.log('🚀 Buy now clicked - Creating draft order for:', { handle, productId, title, price });
               
               try {
                   // Show loading state
                   const buyButton = document.querySelector('.buy-now');
                   if (buyButton) {
                       buyButton.classList.add('loading');
                       buyButton.disabled = true;
                       buyButton.textContent = 'Creating Order...';
                   }
                   
                   // Create draft order payload - FIXED VERSION
                   const draftOrderData = {
                       draft_order: {
                           line_items: [
                               {
                                   title: title,
                                   price: extractPrice(price).toFixed(2),
                                   quantity: 1,
                                   requires_shipping: true,
                                   taxable: true,
                                   fulfillment_service: "manual",
                                   custom_attributes: [
                                       {
                                           key: "product_handle",
                                           value: handle
                                       },
                                       {
                                           key: "product_image",
                                           value: image
                                       },
                                       {
                                           key: "product_id",
                                           value: productId
                                       }
                                   ]
                               }
                           ],
                           note: `Mobile app order - Product: ${title}`,
                           email: "", // Customer email if available
                           shipping_address: {
                               first_name: "Mobile",
                               last_name: "Customer",
                               address1: "To be provided",
                               city: "To be provided",
                               province: "To be provided",
                               country: "India",
                               zip: "000000"
                           },
                           billing_address: {
                               first_name: "Mobile",
                               last_name: "Customer",
                               address1: "To be provided",
                               city: "To be provided",
                               province: "To be provided",
                               country: "India",
                               zip: "000000"
                           },
                           currency: "INR",
                           invoice_sent_at: null,
                           invoice_url: null,
                           tags: "mobile-app,buy-now"
                       }
                   };
                   
                   console.log('📋 Draft order payload:', draftOrderData);
                   
                   // Call draft order API
                   const response = await fetch(`${API_BASE}/api/draft-orders`, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json'
                       },
                       body: JSON.stringify({
                           action: 'create',
                           draftOrderData: draftOrderData
                       })
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       console.log('✅ Draft order created:', result);
                       
                       if (result.success && result.draftOrder) {
                           // Reset button state
                           if (buyButton) {
                               buyButton.classList.remove('loading');
                               buyButton.disabled = false;
                               buyButton.textContent = 'Buy Now';
                           }
                           
                           // Show success message with option to complete order
                           showToast('🎉 Order created successfully!');
                           
                           // Ask user if they want to complete the order now
                           setTimeout(() => {
                               if (confirm('Order created! Would you like to complete the checkout now?')) {
                                   completeDraftOrder(result.draftOrder.id);
                               } else {
                                   closeProductDetailPage();
                               }
                           }, 1000);
                           
                           console.log('📧 Draft Order ID:', result.draftOrder.id);
                           console.log('🔗 Invoice URL:', result.draftOrder.invoice_url);
                           
                       } else {
                           throw new Error(result.error || 'Failed to create draft order');
                       }
                   } else {
                       const errorData = await response.json();
                       throw new Error(errorData.error || 'Failed to create draft order');
                   }
                   
               } catch (error) {
                   console.error('❌ Error creating draft order:', error);
                   
                   // Reset button state
                   const buyButton = document.querySelector('.buy-now');
                   if (buyButton) {
                       buyButton.classList.remove('loading');
                       buyButton.disabled = false;
                       buyButton.textContent = 'Buy Now';
                   }
                   
                   // Show error message
                   showToast('Failed to create order. Please try again.');
               }
           }
           
           // Helper function to extract variant ID
           function extractVariantId(productId) {
               // For REST Admin API, return numeric variant ID as string
               // In production, this should be the actual variant ID from your product data
               // For now, using a base number + productId to create unique variant IDs
               const baseVariantId = 40000000000; // Base Shopify variant ID
               const numericId = parseInt(productId) || 1;
               return String(baseVariantId + numericId);
           }
           
           // Helper function to extract price value
           function extractPrice(priceString) {
               // Extract numeric value from price string like "₹2,499"
               const numericPrice = priceString.replace(/[^\d.]/g, '');
               return parseFloat(numericPrice) || 0;
           }
           
           // Complete Draft Order function
           async function completeDraftOrder(draftOrderId) {
               console.log('🎯 Completing draft order:', draftOrderId);
               
               try {
                   showToast('Processing checkout...');
                   
                   const response = await fetch(`${API_BASE}/api/draft-orders`, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json'
                       },
                       body: JSON.stringify({
                           action: 'complete',
                           draftOrderId: draftOrderId
                       })
                   });
                   
                   if (response.ok) {
                       const result = await response.json();
                       console.log('✅ Draft order completed:', result);
                       
                       if (result.success && result.orderId) {
                           showToast('🎉 Order placed successfully!');
                           console.log('📦 Order ID:', result.orderId);
                           
                           // Close product detail page after successful order
                           setTimeout(() => {
                               closeProductDetailPage();
                           }, 2000);
                           
                       } else {
                           throw new Error(result.error || 'Failed to complete order');
                       }
                   } else {
                       const errorData = await response.json();
                       throw new Error(errorData.error || 'Failed to complete order');
                   }
                   
               } catch (error) {
                   console.error('❌ Error completing draft order:', error);
                   showToast('Failed to complete checkout. Please try again.');
               }
           }
          
          // Product Action Functions
          function shareProduct(handle) {
              console.log('📤 Sharing product:', handle);
              
              if (navigator.share) {
                  navigator.share({
                      title: 'Check out this product',
                      text: 'I found this amazing product on GoEye Store!',
                      url: window.location.href
                  });
              } else {
                  // Fallback for browsers without Web Share API
                  const url = window.location.href;
                  navigator.clipboard.writeText(url).then(() => {
                      showToast('Product link copied to clipboard!');
                  });
              }
          }
          
          function toggleWishlist(handle) {
              console.log('❤️ Toggle wishlist for:', handle);
              
              let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
              const isInWishlist = wishlist.includes(handle);
              
              if (isInWishlist) {
                  wishlist = wishlist.filter(h => h !== handle);
                  showToast('Removed from wishlist');
              } else {
                  wishlist.push(handle);
                  showToast('Added to wishlist');
              }
              
              localStorage.setItem('wishlist', JSON.stringify(wishlist));
              updateWishlistState(handle);
          }
          
          function updateWishlistState(handle) {
              const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
              const isInWishlist = wishlist.includes(handle);
              const wishlistButton = document.querySelector('.wishlist-button');
              
              if (wishlistButton) {
                  if (isInWishlist) {
                      wishlistButton.classList.add('active');
                      wishlistButton.querySelector('.heart-icon').setAttribute('fill', 'currentColor');
                  } else {
                      wishlistButton.classList.remove('active');
                      wishlistButton.querySelector('.heart-icon').setAttribute('fill', 'none');
                  }
              }
          }
          
          function viewSizeGuide() {
              console.log('📏 Opening size guide');
              showToast('Size guide - Coming soon!');
          }
          
          function tryVirtual(handle) {
              console.log('👓 Virtual try-on for:', handle);
              showToast('Virtual try-on - Coming soon!');
          }
          
          function viewReviews() {
              console.log('⭐ Opening reviews');
              showToast('Reviews - Coming soon!');
          }
          
                     // Toggle product description
           function toggleDescription() {
               console.log('🔍 Toggle description clicked!');
               const content = document.getElementById('descriptionContent');
               const arrow = document.querySelector('.description-arrow');
               
               console.log('📋 Elements found:', { content: !!content, arrow: !!arrow });
               
               if (content && arrow) {
                   const isExpanded = content.classList.contains('expanded');
                   
                   if (isExpanded) {
                       content.classList.remove('expanded');
                       arrow.classList.remove('rotated');
                   } else {
                       content.classList.add('expanded');
                       arrow.classList.add('rotated');
                   }
                   
                   console.log('📋 Description toggled:', isExpanded ? 'collapsed' : 'expanded');
               } else {
                   console.error('❌ Description elements not found!');
               }
           }
          
          // Image Slider Functions
          let currentSlideIndex = 0;
          let autoSlideInterval = null;
          
          function goToSlide(index) {
              const slides = document.querySelectorAll('.product-image-slide');
              const dots = document.querySelectorAll('.pagination-dot');
              
              if (slides.length === 0) return;
              
              // Remove active class from current slide and dot
              slides[currentSlideIndex]?.classList.remove('active');
              dots[currentSlideIndex]?.classList.remove('active');
              
              // Set new slide index
              currentSlideIndex = index;
              if (currentSlideIndex >= slides.length) currentSlideIndex = 0;
              if (currentSlideIndex < 0) currentSlideIndex = slides.length - 1;
              
              // Add active class to new slide and dot
              slides[currentSlideIndex]?.classList.add('active');
              dots[currentSlideIndex]?.classList.add('active');
              
              console.log('📸 Slide changed to:', currentSlideIndex);
          }
          
          function nextSlide() {
              goToSlide(currentSlideIndex + 1);
          }
          
          function startAutoSlide() {
              const slides = document.querySelectorAll('.product-image-slide');
              if (slides.length <= 1) return; // Don't auto-slide for single images
              
              autoSlideInterval = setInterval(() => {
                  nextSlide();
              }, 3000); // Change slide every 3 seconds
              
              console.log('🔄 Auto-slide started');
          }
          
          function stopAutoSlide() {
              if (autoSlideInterval) {
                  clearInterval(autoSlideInterval);
                  autoSlideInterval = null;
                  console.log('⏹️ Auto-slide stopped');
              }
          }
          
          function openWhatsAppChat() {
              const message = encodeURIComponent('Hi! I need help with a product from GoEye Store.');
              const whatsappUrl = `https://wa.me/1234567890?text=${message}`;
              window.open(whatsappUrl, '_blank');
          }
          
          function showCartPage() {
              console.log('🛒 Opening cart page');
              showToast('Cart page - Coming soon!');
          }
          
          // Update navigation for product page
          function updateNavigationForProductPage() {
              // Hide bottom navigation
              const bottomNav = document.querySelector('.bottom-nav');
              if (bottomNav) {
                  bottomNav.style.display = 'none';
              }
          }
          
          // Update navigation for main app
          function updateNavigationForMainApp() {
              // Show bottom navigation
              const bottomNav = document.querySelector('.bottom-nav');
              if (bottomNav) {
                  bottomNav.style.display = 'flex';
              }
          }
          
                     // Update cart count in product page
           function updateCartCount() {
               // Get consolidated cart count from all storage locations
               let totalCount = 0;
               
               // Count from regular cart
               const regularCart = JSON.parse(localStorage.getItem('cart') || '[]');
               totalCount += regularCart.length;
               
               // Count from mobile cart (avoid duplicates)
               const mobileCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
               const regularIds = regularCart.map(item => item.id);
               const uniqueMobileItems = mobileCart.filter(item => 
                   !regularIds.includes(item.id) && !regularIds.includes(item.variant_id)
               );
               totalCount += uniqueMobileItems.length;
               
               // Count from shopify cart (avoid duplicates)
               const shopifyCartData = JSON.parse(localStorage.getItem('shopify-cart') || 'null');
               if (shopifyCartData && shopifyCartData.items) {
                   const allExistingIds = [...regularIds, ...uniqueMobileItems.map(item => item.id || item.variant_id)];
                   const uniqueShopifyItems = shopifyCartData.items.filter(item => 
                       !allExistingIds.includes(item.id) && !allExistingIds.includes(item.variant_id)
                   );
                   totalCount += uniqueShopifyItems.length;
               }
               
               // Update cart count badge in header
               const cartBadge = document.getElementById('cart-badge');
               if (cartBadge) {
                   if (totalCount > 0) {
                       cartBadge.style.display = 'flex';
                       cartBadge.textContent = totalCount;
                   } else {
                       cartBadge.style.display = 'none';
                   }
               }
               
               // Update cart count in product page  
               const cartCountElement = document.getElementById('product-cart-count');
               if (cartCountElement) {
                   cartCountElement.textContent = totalCount > 0 ? totalCount : '';
               }
               
               console.log('🔢 Updated cart count:', totalCount);
           }
           
           // Add to Shopify Cart Function (integrates with existing cart system)
           async function addToShopifyCart(variantId, quantity, title, price, image) {
               try {
                   console.log('🛒 Adding to Shopify cart:', { variantId, quantity, title, price });
                   
                   // Use existing cart API endpoint
                   const response = await fetch(`${API_BASE}/api/cart`, {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json',
                       },
                       body: JSON.stringify({
                           action: 'add',
                           variantId: variantId,
                           quantity: quantity,
                           properties: {
                               title: title,
                               price: price,
                               image: image
                           }
                       })
                   });
                   
                   if (response.ok) {
                       const data = await response.json();
                       console.log('✅ Cart API response:', data);
                       
                       if (data.success && data.cart) {
                           // Update localStorage with new cart
                           localStorage.setItem('shopify-cart', JSON.stringify(data.cart));
                           
                           // Update local cart array
                           cart = convertShopifyCartToLocal(data.cart);
                           
                           // Update cart displays
                           updateCartDisplay();
                           updateCartCount();
                           
                           return true;
                       } else {
                           console.error('Cart API error:', data.error);
                           return false;
                       }
                   } else {
                       console.error('Cart API request failed:', response.status);
                       return false;
                   }
                   
               } catch (error) {
                   console.error('addToShopifyCart error:', error);
                   
                   // Fallback to local cart if API fails
                   return addToLocalCart(variantId, quantity, title, price, image);
               }
           }
           
           // Fallback: Add to Local Cart
           function addToLocalCart(variantId, quantity, title, price, image) {
               console.log('📱 [Mobile Cart] Adding to local cart as fallback:', { variantId, quantity, title, price });
               
               try {
                   // Clean price string
                   const cleanPrice = parseFloat(price.replace(/[^\d.]/g, ''));
                   
                   // Ensure variantId is a string
                   const variantIdString = String(variantId);
                   
                   // Get current mobile cart
                   let mobileCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
                   
                   // Check if item already exists
                   const existingItem = mobileCart.find(item => item.variant_id === variantIdString);
                   
                   if (existingItem) {
                       existingItem.quantity += quantity;
                       console.log('🔄 Updated existing mobile cart item quantity:', existingItem.quantity);
                   } else {
                       mobileCart.push({
                           id: variantIdString,
                           title: title,
                           price: cleanPrice.toFixed(2),
                           quantity: quantity,
                           image: image,
                           variant_id: variantIdString
                       });
                       console.log('➕ Added new item to mobile cart');
                   }
                   
                   // Save to localStorage
                   localStorage.setItem('mobile-cart', JSON.stringify(mobileCart));
                   console.log('💾 Saved to localStorage[mobile-cart]:', mobileCart);
                   
                   // Update displays
                   updateCartDisplay();
                   updateCartCount();
                   
                   return true;
                   
               } catch (error) {
                   console.error('Local cart error:', error);
                   return false;
               }
           }
           
           // Add Product Detail Page Styles
           function addProductDetailStyles() {
               // Check if styles already exist
               if (document.getElementById('product-detail-styles')) return;
               
               const style = document.createElement('style');
               style.id = 'product-detail-styles';
               style.textContent = `
                   /* Product Detail Page Styles */
                   .product-detail-page {
                       position: fixed;
                       top: 0;
                       left: 0;
                       width: 100%;
                       height: 100%;
                       background: #fff;
                       z-index: 1001;
                       overflow: hidden;
                       transform: translateX(100%);
                       transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                   }
                   
                   .product-detail-page.active {
                       transform: translateX(0);
                   }
                   
                   .product-detail-container {
                       height: 100%;
                       overflow-y: auto;
                       -webkit-overflow-scrolling: touch;
                       position: relative;
                   }
                   
                   /* Top Navigation */
                   .product-top-nav {
                       position: fixed;
                       top: 0;
                       left: 0;
                       right: 0;
                       display: flex;
                       justify-content: space-between;
                       align-items: center;
                       padding: 6px 12px;
                       padding-top: calc(env(safe-area-inset-top, 20px) + 6px);
                       z-index: 100;
                       background: rgba(255, 255, 255, 0.95);
                       backdrop-filter: blur(10px);
                       box-shadow: 0 2px 4px rgba(0,0,0,0.08);
                       height: calc(52px + env(safe-area-inset-top, 20px));
                       min-height: 72px;
                   }
                   
                   .nav-button {
                       flex-shrink: 0;
                       width: 40px;
                       height: 40px;
                       border-radius: 50%;
                       background: white;
                       border: none;
                       display: flex;
                       align-items: center;
                       justify-content: center;
                       box-shadow: 0 2px 4px rgba(0,0,0,0.08);
                       text-decoration: none;
                       cursor: pointer;
                       transition: transform 0.2s ease, box-shadow 0.2s ease;
                   }
                   
                   .nav-button:active {
                       transform: scale(0.95);
                   }
                   
                   .nav-button svg {
                       width: 22px;
                       height: 22px;
                       color: #1B224B;
                       stroke-width: 2.5;
                   }
                   
                   .product-title-header {
                       color: #1B224B;
                       font-size: 16px;
                       font-weight: 600;
                       white-space: nowrap;
                       opacity: 0;
                       visibility: hidden;
                       transition: opacity 0.3s ease, visibility 0.3s ease;
                       margin-right: auto;
                       max-width: calc(100% - 200px);
                       overflow: hidden;
                       text-overflow: ellipsis;
                       margin-left: 12px;
                   }
                   
                   .nav-right {
                       display: flex;
                       gap: 8px;
                       flex-shrink: 0;
                       align-items: center;
                   }
                   
                   .cart-button {
                       position: relative;
                   }
                   
                   .cart-count {
                       position: absolute;
                       top: -6px;
                       right: -6px;
                       background: #E73C17;
                       color: white;
                       font-size: 12px;
                       font-weight: 600;
                       min-width: 18px;
                       height: 18px;
                       border-radius: 9px;
                       display: flex;
                       align-items: center;
                       justify-content: center;
                       padding: 0 4px;
                       line-height: 1;
                       box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                   }
                   
                   .cart-count:empty {
                       display: none;
                   }
                   
                   /* Product Media */
                   .product-media {
                       width: 100%;
                       padding-top: calc(80px + env(safe-area-inset-top, 20px));
                       position: relative;
                       flex: 0 0 auto;
                       margin-top: 0;
                   }
                   
                   .product-image-slider {
                       position: relative;
                       width: 100%;
                       height: 450px;
                       overflow: hidden;
                       background: #fff;
                   }
                   
                   .product-image-slide {
                       position: absolute;
                       top: 0;
                       left: 0;
                       width: 100%;
                       height: 100%;
                       opacity: 0;
                       transition: opacity 0.5s ease-in-out;
                   }
                   
                   .product-image-slide.active {
                       opacity: 1;
                   }
                   
                   .product-main-image {
                       width: 100%;
                       height: 100%;
                       object-fit: cover;
                       display: block;
                   }
                   
                   /* Rating Overlay */
                   .rating-overlay-widget {
                       position: absolute;
                       right: 16px;
                       bottom: 16px;
                       z-index: 6;
                       pointer-events: none;
                   }
                   
                   .rating-overlay-content {
                       background: rgba(255, 255, 255, 0.9);
                       backdrop-filter: blur(4px);
                       border-radius: 16px;
                       padding: 6px 10px;
                       display: flex;
                       align-items: center;
                       gap: 2px;
                       white-space: nowrap;
                       box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                   }
                   
                   .rating-value {
                       color: #333;
                       font-size: 14px;
                       font-weight: 600;
                   }
                   
                   .rating-star {
                       color: #22C55E;
                       font-size: 14px;
                       margin: 0 1px;
                   }
                   
                   .rating-count {
                       color: #666;
                       font-size: 14px;
                       font-weight: 500;
                   }
                   
                   /* New Launch Badge */
                   .new-launch-badge {
                       position: absolute;
                       top: 60px;
                       left: 10px;
                       background: #E73C17;
                       color: white;
                       padding: 4px 8px;
                       border-radius: 4px;
                       font-size: 12px;
                       z-index: 5;
                   }
                   
                   /* Image Pagination */
                   .image-pagination {
                       display: flex;
                       justify-content: center;
                       align-items: center;
                       padding: 8px 0;
                       gap: 6px;
                   }
                   
                   .pagination-dot {
                       width: 6px;
                       height: 6px;
                       border-radius: 50%;
                       background: #D8D8D8;
                       display: inline-block;
                       transition: background 0.2s ease;
                   }
                   
                   .pagination-dot.active {
                       background: #1B224B;
                   }
                   
                   /* Product Info */
                   .product-info {
                       height: auto;
                       display: flex;
                       flex-direction: column;
                       position: relative;
                       padding: 16px;
                       background: #fff;
                   }
                   
                   .product-info__content {
                       padding: 0;
                       margin: 0;
                   }
                   
                   .product-title {
                       font-size: 20px;
                       line-height: 1.2;
                       color: #1B224B;
                       margin: 0 0 8px 0;
                       padding: 0;
                       font-weight: 600;
                       display: flex;
                       justify-content: space-between;
                       align-items: flex-start;
                   }
                   
                   .product-title h1 {
                       margin: 0;
                       font-size: inherit;
                       font-weight: inherit;
                       color: inherit;
                       flex: 1;
                   }
                   
                   .wishlist-button {
                       background: none;
                       border: none;
                       padding: 4px;
                       cursor: pointer;
                       transition: transform 0.2s ease;
                   }
                   
                   .wishlist-button:active {
                       transform: scale(0.9);
                   }
                   
                   .heart-icon {
                       width: 24px;
                       height: 24px;
                       color: #1B224B;
                       transition: fill 0.2s ease;
                   }
                   
                   .wishlist-button.active .heart-icon {
                       fill: #E73C17;
                       color: #E73C17;
                   }
                   
                   .product-subtitle {
                       color: #666;
                       font-size: 13px;
                       margin: 0 0 4px 0;
                       font-weight: 400;
                   }
                   
                   .product-feature {
                       color: #2E8B57;
                       font-size: 13px;
                       margin: 0 0 12px 0;
                       font-weight: 500;
                   }
                   
                   .product-rating-block {
                       margin: 12px 0;
                   }
                   
                   .product-rating {
                       display: flex;
                       align-items: center;
                       gap: 4px;
                       font-size: 14px;
                       color: #333368;
                   }
                   
                   .rating-stars {
                       color: #ffc107;
                       font-size: 14px;
                   }
                   
                   .product-price {
                       display: flex;
                       align-items: center;
                       gap: 6px;
                       margin: 12px 0;
                   }
                   
                   .price-current {
                       font-size: 20px;
                       font-weight: 600;
                       color: #1B224B;
                   }
                   
                   .price-original {
                       text-decoration: line-through;
                       color: #666;
                       font-size: 13px;
                   }
                   
                   .price-discount {
                       color: #E73C17;
                       font-size: 13px;
                       font-weight: 500;
                   }
                   
                   /* Product Actions */
                   .product-actions {
                       display: flex;
                       gap: 6px;
                       padding: 0;
                       margin: 16px 0 24px 0;
                   }
                   
                   .action-btn {
                       flex: 1;
                       padding: 12px 8px;
                       border: 1px solid #E8E8E8;
                       border-radius: 12px;
                       background: white;
                       display: flex;
                       flex-direction: column;
                       align-items: center;
                       gap: 6px;
                       cursor: pointer;
                       transition: all 0.2s ease;
                   }
                   
                   .action-btn:active {
                       transform: scale(0.95);
                       background: #f5f5f5;
                   }
                   
                   .action-btn svg {
                       width: 24px;
                       height: 24px;
                       color: #1B224B;
                   }
                   
                   .action-btn span {
                       font-size: 12px;
                       color: #1B224B;
                       font-weight: 500;
                       text-align: center;
                   }
                   
                   /* Product Description Section */
                   .description-section {
                       margin: 20px 0;
                       border-top: 1px solid #eee;
                       padding-top: 20px;
                   }
                   
                   .description-toggle {
                       width: 100%;
                       display: flex;
                       justify-content: space-between;
                       align-items: center;
                       padding: 15px 0;
                       background: none;
                       border: none;
                       font-size: 16px;
                       font-weight: 600;
                       color: #333;
                       cursor: pointer;
                       transition: color 0.2s ease;
                   }
                   
                   .description-toggle:hover {
                       color: #007bff;
                   }
                   
                   .description-arrow {
                       width: 20px;
                       height: 20px;
                       transition: transform 0.3s ease;
                   }
                   
                   .description-arrow.rotated {
                       transform: rotate(180deg);
                   }
                   
                   .description-content {
                       max-height: 0;
                       overflow: hidden;
                       transition: max-height 0.3s ease, padding 0.3s ease;
                       padding: 0;
                   }
                   
                   .description-content.expanded {
                       max-height: 300px;
                       padding: 15px 0;
                   }
                   
                   .description-content p {
                       margin: 0;
                       line-height: 1.6;
                       color: #666;
                       font-size: 14px;
                   }
                   
                   /* Elegant Bottom Purchase Section */
                   .buy-buttons {
                       position: fixed;
                       bottom: 0;
                       left: 0;
                       right: 0;
                       display: flex;
                       flex-direction: column;
                       background: transparent;
                       z-index: 999;
                       padding: 0;
                       max-height: 160px;
                       box-shadow: 0 -8px 32px rgba(0,0,0,0.12);
                       backdrop-filter: blur(20px);
                   }
                   
                   /* Elegant Promo Banner */
                   .promo-banner {
                       background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                       color: #fff;
                       display: flex;
                       justify-content: center;
                       align-items: center;
                       gap: 12px;
                       padding: 10px 16px;
                       font-size: 13px;
                       font-weight: 500;
                       border-radius: 16px 16px 0 0;
                       position: relative;
                       overflow: hidden;
                   }
                   
                   .promo-banner::before {
                       content: '';
                       position: absolute;
                       top: 0;
                       left: -100%;
                       width: 100%;
                       height: 100%;
                       background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                       animation: shimmer 3s infinite;
                   }
                   
                   @keyframes shimmer {
                       0% { left: -100%; }
                       100% { left: 100%; }
                   }
                   
                   .promo-item {
                       display: flex;
                       align-items: center;
                       gap: 4px;
                   }
                   
                   .promo-icon {
                       width: 14px;
                       height: 14px;
                       stroke-width: 2;
                   }
                   
                   .promo-divider {
                       opacity: 0.6;
                       font-size: 12px;
                   }
                   
                   /* Elegant Price Container */
                   .price-container {
                       background: rgba(255, 255, 255, 0.98);
                       backdrop-filter: blur(20px);
                       border-radius: 0 0 16px 16px;
                       padding: 16px;
                       padding-bottom: calc(16px + env(safe-area-inset-bottom, 0));
                       border-top: 1px solid rgba(0,0,0,0.05);
                   }
                   
                   /* Pricing Section */
                   .pricing-section {
                       display: flex;
                       justify-content: space-between;
                       align-items: center;
                       margin-bottom: 16px;
                   }
                   
                   .price-group {
                       display: flex;
                       align-items: center;
                       gap: 10px;
                   }
                   
                   .current-price {
                       font-size: 24px;
                       font-weight: 700;
                       color: #1a1a1a;
                       letter-spacing: -0.5px;
                   }
                   
                   .compare-price {
                       font-size: 16px;
                       color: #999;
                       text-decoration: line-through;
                       font-weight: 500;
                   }
                   
                   .collection-discount-badge {
                       background: linear-gradient(135deg, #4CAF50, #45a049);
                       color: white;
                       font-size: 12px;
                       font-weight: 600;
                       padding: 4px 8px;
                       border-radius: 8px;
                       text-transform: uppercase;
                       letter-spacing: 0.5px;
                       box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
                   }
                   
                   .tax-info {
                       font-size: 12px;
                       color: #666;
                       font-weight: 500;
                   }
                   
                   /* Elegant Action Buttons */
                   .elegant-action-buttons {
                       display: flex;
                       gap: 12px;
                   }
                   
                   .elegant-add-cart,
                   .elegant-buy-now {
                       flex: 1;
                       border: none;
                       border-radius: 12px;
                       padding: 14px 20px;
                       font-weight: 600;
                       font-size: 15px;
                       cursor: pointer;
                       transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                       position: relative;
                       overflow: hidden;
                       min-height: 50px;
                       display: flex;
                       align-items: center;
                       justify-content: center;
                   }
                   
                   .elegant-add-cart {
                       background: linear-gradient(135deg, #2c3e50, #34495e);
                       color: white;
                       border: 2px solid transparent;
                   }
                   
                   .elegant-add-cart:hover {
                       transform: translateY(-2px);
                       box-shadow: 0 8px 25px rgba(44, 62, 80, 0.3);
                   }
                   
                   .elegant-add-cart:active {
                       transform: translateY(0);
                   }
                   
                   .elegant-buy-now {
                       background: linear-gradient(135deg, #667eea, #764ba2);
                       color: white;
                       box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                   }
                   
                   .elegant-buy-now:hover {
                       transform: translateY(-2px);
                       box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
                   }
                   
                   .elegant-buy-now:active {
                       transform: translateY(0);
                   }
                   
                   .button-content {
                       display: flex;
                       align-items: center;
                       gap: 8px;
                       transition: all 0.3s ease;
                   }
                   
                   .success-state {
                       display: none;
                       align-items: center;
                       gap: 6px;
                   }
                   
                   .cart-icon,
                   .lightning-icon,
                   .check-icon {
                       width: 18px;
                       height: 18px;
                       stroke-width: 2.5;
                   }
                   
                   .elegant-add-cart.added .button-content {
                       display: none;
                   }
                   
                   .elegant-add-cart.added .success-state {
                       display: flex;
                       transition: opacity 0.3s ease;
                   }
                   
                   .add-to-cart.success .button-text {
                       opacity: 0;
                       visibility: hidden;
                       position: absolute;
                   }
                   
                   .add-to-cart.success .success-text {
                       opacity: 1;
                       visibility: visible;
                   }
                   
                   .add-to-cart.success {
                       background: #22C55E;
                       animation: successPulse 0.3s ease;
                   }
                   
                   .add-to-cart.loading,
                   .buy-now.loading {
                       opacity: 0.7;
                       cursor: not-allowed;
                       position: relative;
                   }
                   
                   .buy-now.loading::after {
                       content: '';
                       position: absolute;
                       right: 12px;
                       top: 50%;
                       transform: translateY(-50%);
                       width: 16px;
                       height: 16px;
                       border: 2px solid rgba(255,255,255,0.3);
                       border-radius: 50%;
                       border-top-color: white;
                       animation: spin 1s linear infinite;
                   }
                   
                   @keyframes spin {
                       to { transform: translateY(-50%) rotate(360deg); }
                   }
                   
                   @keyframes successPulse {
                       0% { transform: scale(1); }
                       50% { transform: scale(1.05); }
                       100% { transform: scale(1); }
                   }
                   
                   /* WhatsApp Chat Button */
                   .whatsapp-chat {
                       position: fixed;
                       bottom: 160px;
                       right: 20px;
                       background: #25D366;
                       color: white;
                       padding: 8px 16px;
                       border-radius: 24px;
                       display: flex;
                       align-items: center;
                       gap: 8px;
                       box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                       z-index: 10;
                       cursor: pointer;
                       transition: transform 0.2s ease;
                       font-size: 14px;
                       font-weight: 500;
                   }
                   
                   .whatsapp-chat:active {
                       transform: scale(0.95);
                   }
                   
                   /* Mobile Responsive - safe area handled by wrapper only */
                   @media (max-width: 767px) {
                       /* No additional safe area applications - wrapper handles it */
                   }
                       
                       .nav-button {
                           width: 36px;
                           height: 36px;
                       }
                       
                       .nav-button svg {
                           width: 20px;
                           height: 20px;
                       }
                       
                       .product-title-header {
                           font-size: 15px;
                       }
                       
                       .product-media {
                           padding-top: calc(48px + env(safe-area-inset-top, 20px));
                       }
                       
                       .product-image-container {
                           height: 350px;
                       }
                       
                       .rating-overlay-widget {
                           right: 12px;
                           bottom: 12px;
                       }
                       
                       .rating-overlay-content {
                           padding: 4px 8px;
                       }
                       
                       .rating-value,
                       .rating-star,
                       .rating-count {
                           font-size: 13px;
                       }
                       
                       .whatsapp-chat {
                           bottom: 140px;
                           right: 16px;
                           padding: 6px 12px;
                       }
                       
                       /* Elegant Cart Mobile Responsive */
                       .buy-buttons {
                           max-height: 140px;
                       }
                       
                       .promo-banner {
                           padding: 8px 12px;
                           font-size: 12px;
                       }
                       
                       .promo-item span {
                           display: none;
                       }
                       
                       .promo-icon {
                           width: 16px;
                           height: 16px;
                       }
                       
                       .price-container {
                           padding: 12px;
                           padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));
                       }
                       
                       .pricing-section {
                           margin-bottom: 12px;
                       }
                       
                       .current-price {
                           font-size: 20px;
                       }
                       
                       .compare-price {
                           font-size: 14px;
                       }
                       
                       .elegant-action-buttons {
                           gap: 8px;
                       }
                       
                       .elegant-add-cart,
                       .elegant-buy-now {
                           padding: 12px 16px;
                           font-size: 14px;
                           min-height: 44px;
                       }
                       
                       .cart-icon,
                       .lightning-icon,
                       .check-icon {
                           width: 16px;
                           height: 16px;
                       }
                           font-size: 13px;
                       }
                       
                       .action-btn {
                           padding: 10px 6px;
                       }
                       
                       .action-btn span {
                           font-size: 11px;
                       }
                   }
                   
                   /* Scroll behavior */
                   .product-detail-container {
                       scroll-behavior: smooth;
                   }
                   
                   /* Note: Removed overflow: hidden to preserve safe area */
               `;
               
               document.head.appendChild(style);
           }

        function showCollection(handle) {
            console.log('🔍 DEBUG: showCollection called with handle:', handle);
            
            // Check if we're on mobile (screen width < 768px or Capacitor app)
            const isMobile = window.innerWidth < 768 || window.location.protocol === 'capacitor:';
            
            if (isMobile) {
                // For mobile: Create new page-like experience
                console.log('📱 Mobile detected: Opening collection as new page');
                openCollectionAsNewPage(handle);
            } else {
                // For desktop: Show as overlay (existing behavior)
                console.log('💻 Desktop detected: Opening collection as overlay');
                showCollectionOverlay(handle);
            }
        }

        async function openCollectionAsNewPage(handle) {
            console.log('📱 Opening collection as new page for handle:', handle);
            
            // Clear navigation stack when opening new collection from home
            navigationStack = [];
            console.log('🧹 Cleared navigation stack for new collection');
            
            // Hide all main content
            document.body.classList.add('collection-page-mode');
            
            // Create full-screen collection page
            const collectionPage = document.createElement('div');
            collectionPage.id = 'collection-full-page';
            collectionPage.className = 'collection-full-page';
            
            // Store collection handle as data attribute for easy access
            collectionPage.setAttribute('data-collection-handle', handle);
            
            const collectionName = handle.charAt(0).toUpperCase() + handle.slice(1);
            
            // Show loading state first
            collectionPage.innerHTML = `
                <div class="collection-mobile-header">
                    <button class="collection-mobile-back" onclick="closeCollectionPage()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                        Back
                    </button>
                    <h1 class="collection-mobile-title">${collectionName}</h1>
                    <div class="collection-mobile-actions">
                        <button class="collection-mobile-btn" onclick="openWishlistModal()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                        </button>
                        <button class="collection-mobile-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                <line x1="3" y1="6" x2="21" y2="6"/>
                                <path d="M16 10a4 4 0 01-8 0"/>
                            </svg>
                            <span class="cart-count">${cart.length}</span>
                        </button>
                    </div>
                </div>
                
                <!-- Collection Controls: Sort, Filter -->
                <div class="collection-controls">
                    <div class="control-group">
                        <div class="sort-dropdown">
                            <button class="control-btn" onclick="toggleSortDropdown()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M7 12h10M10 18h4"/>
                                </svg>
                                <span id="sort-label">Sort</span>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9l6 6 6-6"/>
                                </svg>
                            </button>
                            <div class="sort-options" id="sortOptions">
                                <div class="sort-option selected" data-sort="featured">Featured</div>
                                <div class="sort-option" data-sort="price-low">Price: Low to High</div>
                                <div class="sort-option" data-sort="price-high">Price: High to Low</div>
                                <div class="sort-option" data-sort="name">Name: A to Z</div>
                                <div class="sort-option" data-sort="newest">Newest First</div>
                            </div>
                        </div>
                        <button class="control-btn" onclick="openFilterModal()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                            </svg>
                            Filter
                        </button>
                    </div>
                </div>
                
                <div class="collection-mobile-content with-view-toggle">
                    <div class="loading-products">
                        <div class="spinner"></div>
                        <p>Loading ${collectionName} products...</p>
                    </div>
                </div>
                
                <!-- View Toggle at Bottom -->
                <div class="view-toggle-container">
                    <div class="view-toggle">
                        <button class="view-tab" data-view="tile" onclick="switchView('tile')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            Tile
                        </button>
                        <button class="view-tab active" data-view="list" onclick="switchView('list')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/>
                                <line x1="8" y1="12" x2="21" y2="12"/>
                                <line x1="8" y1="18" x2="21" y2="18"/>
                                <line x1="3" y1="6" x2="3.01" y2="6"/>
                                <line x1="3" y1="12" x2="3.01" y2="12"/>
                                <line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                            List
                        </button>
                    </div>
                </div>

                <!-- Filter Modal -->
                <div class="filter-modal" id="filterModal">
                    <div class="filter-content">
                        <div class="filter-header">
                            <h3>Filter Products</h3>
                            <button class="filter-close" onclick="closeFilterModal()">×</button>
                        </div>
                        <div class="filter-body">
                            <div class="filter-section">
                                <h4>Price Range</h4>
                                <div class="filter-options">
                                    <div class="filter-option">
                                        <input type="checkbox" id="price1" value="0-50">
                                        <label for="price1">Under ₹50</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="price2" value="50-100">
                                        <label for="price2">₹50 - ₹100</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="price3" value="100-200">
                                        <label for="price3">₹100 - ₹200</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="price4" value="200+">
                                        <label for="price4">Above ₹200</label>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-section">
                                <h4>Brand</h4>
                                <div class="filter-options">
                                    <div class="filter-option">
                                        <input type="checkbox" id="brand1" value="ray-ban">
                                        <label for="brand1">Ray-Ban</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="brand2" value="oakley">
                                        <label for="brand2">Oakley</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="brand3" value="prada">
                                        <label for="brand3">Prada</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="brand4" value="gucci">
                                        <label for="brand4">Gucci</label>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-section">
                                <h4>Frame Type</h4>
                                <div class="filter-options">
                                    <div class="filter-option">
                                        <input type="checkbox" id="frame1" value="full-rim">
                                        <label for="frame1">Full Rim</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="frame2" value="half-rim">
                                        <label for="frame2">Half Rim</label>
                                    </div>
                                    <div class="filter-option">
                                        <input type="checkbox" id="frame3" value="rimless">
                                        <label for="frame3">Rimless</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button class="filter-btn clear" onclick="clearFilters()">Clear All</button>
                            <button class="filter-btn apply" onclick="applyFilters()">Apply Filters</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to body with slide-in animation
            document.body.appendChild(collectionPage);
            
            // Trigger animation
            setTimeout(() => {
                collectionPage.classList.add('active');
            }, 10);
            
            // Load real collection products
            try {
                console.log('📱 Fetching real products for mobile collection:', handle);
                let collectionProducts = await fetchRealCollectionProducts(handle);
                
                console.log('📱 Real API returned products count:', collectionProducts ? collectionProducts.length : 0);
                
                if (!collectionProducts || collectionProducts.length === 0) {
                    console.log('📱 No real products found, using generated products as fallback');
                    collectionProducts = generateCollectionProducts(handle);
                } else if (collectionProducts.length < 3) {
                    console.log('📱 Real API returned only', collectionProducts.length, 'products, supplementing with generated products');
                    // Supplement with generated products to show more variety
                    const generatedProducts = generateCollectionProducts(handle);
                    // Keep real products and add generated ones up to 8 total
                    const supplementedProducts = [...collectionProducts];
                    let addedCount = 0;
                    for (const genProduct of generatedProducts) {
                        if (supplementedProducts.length < 8 && addedCount < 5) {
                            // Modify the generated product to not conflict with real ones
                            genProduct.id = `generated-${handle}-${addedCount + 1}`;
                            genProduct.handle = `generated-${handle}-${addedCount + 1}`;
                            supplementedProducts.push(genProduct);
                            addedCount++;
                        }
                    }
                    collectionProducts = supplementedProducts;
                    console.log('📱 Supplemented products, total count:', collectionProducts.length);
                }
                
                console.log('📱 Final products to render:', collectionProducts.length);
                
                // Update content with products
                renderMobileCollectionProducts(collectionProducts, handle, collectionPage);
                
            } catch (error) {
                console.error('📱 Error loading mobile collection products:', error);
                // Fallback to generated products
                const collectionProducts = generateCollectionProducts(handle);
                console.log('📱 Using fallback generated products count:', collectionProducts.length);
                renderMobileCollectionProducts(collectionProducts, handle, collectionPage);
            }
            
            console.log('📱 Collection page created and animated in');
        }

        // Collection banners data
        const collectionBanners = [
            {
                title: "Summer Sale",
                subtitle: "Up to 50% off on selected frames",
                cta: "Shop Now",
                gradient: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                action: "console.log('Summer Sale clicked')"
            },
            {
                title: "New Arrivals",
                subtitle: "Latest designer eyewear collection",
                cta: "Explore",
                gradient: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
                action: "console.log('New Arrivals clicked')"
            },
            {
                title: "Premium Collection",
                subtitle: "Luxury frames for discerning taste",
                cta: "View All",
                gradient: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",
                action: "console.log('Premium Collection clicked')"
            },
            {
                title: "Buy 1 Get 1",
                subtitle: "Special offer on eyeglasses",
                cta: "Claim Offer",
                gradient: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",
                action: "console.log('Buy 1 Get 1 clicked')"
            }
        ];

        // Render products in mobile collection page with banners
        function renderMobileCollectionProducts(collectionProducts, handle, collectionPage) {
            console.log('🎨 RENDER: Mobile collection products for:', handle);
            console.log('🎨 RENDER: Products to render:', collectionProducts.map(p => ({
                title: p.title,
                price: p.price,
                originalPrice: p.originalPrice,
                hasComparePrice: !!p.originalPrice
            })));
            
            const collectionName = handle.charAt(0).toUpperCase() + handle.slice(1);
            const contentDiv = collectionPage.querySelector('.collection-mobile-content');
            
            if (contentDiv) {
                // Create array with products and banners interspersed
                const contentItems = [];
                let bannerIndex = 0;
                
                collectionProducts.forEach((product, index) => {
                    contentItems.push({ type: 'product', data: product });
                    
                    // Add banner after every 2 products
                    if ((index + 1) % 2 === 0 && bannerIndex < collectionBanners.length) {
                        contentItems.push({ type: 'banner', data: collectionBanners[bannerIndex] });
                        bannerIndex++;
                    }
                });
                
                contentDiv.innerHTML = `
                    <div class="collection-mobile-grid">
                        ${contentItems.map(item => {
                            if (item.type === 'banner') {
                                const banner = item.data;
                                return `
                                <div class="collection-banner-card" onclick="${banner.action}" style="background: ${banner.gradient};">
                                    <div class="collection-banner-content">
                                        <div class="banner-title">${banner.title}</div>
                                        <div class="banner-subtitle">${banner.subtitle}</div>
                                        <div class="banner-cta">${banner.cta}</div>
                                    </div>
                                </div>
                                `;
                            } else {
                                const product = item.data;
                            // Generate product code from title
                            const productCode = product.sku || `${product.id.toString().slice(-4)}${product.title.replace(/[^a-zA-Z0-9]/g, '').toUpperCase().slice(0, 4)}`;
                            // Generate random rating between 4.0-5.0
                            const rating = (4.0 + Math.random() * 1.0).toFixed(1);
                            const reviewCount = Math.floor(Math.random() * 500) + 50;
                            
                            return `
                            <div class="collection-mobile-card" onclick="event.preventDefault(); event.stopPropagation(); console.log('🔍 MOBILE CARD CLICKED:', '${product.handle || product.id}'); window.openProductFromCollection ? window.openProductFromCollection('${product.handle || product.id}', event) : console.error('openProductFromCollection not found');" data-product-handle="${product.handle || product.id}">
                                <div class="product-mobile-image">
                                    <div class="product-image-slider" data-product-id="${product.id}">
                                        <div class="product-images-container">
                                            ${(() => {
                                                // Create multiple images for auto-sliding demonstration
                                                const baseImage = product.image || product.images?.[0] || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDI0MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyNDAiIGhlaWdodD0iMjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik05NiA5NkgxNDRWMTQ0SDk2Vjk2WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K';
                                                const allImages = product.images && product.images.length > 1 ? product.images : [baseImage, baseImage, baseImage];
                                                return allImages.map((imageUrl, index) => `
                                                    <img src="${imageUrl}" alt="${product.title} - Image ${index + 1}" class="product-slide-image" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDI0MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyNDAiIGhlaWdodD0iMjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik05NiA5NkgxNDRWMTQ0SDk2Vjk2WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'">
                                                `).join('');
                                            })()}
                                        </div>
                                        ${(() => {
                                            const imageCount = product.images && product.images.length > 1 ? product.images.length : 3;
                                            return imageCount > 1 ? `
                                                <div class="image-indicators">
                                                    ${Array.from({length: imageCount}, (_, index) => `
                                                        <div class="image-indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></div>
                                                    `).join('')}
                                                </div>
                                            ` : '';
                                        })()}
                                    </div>
                                </div>
                                <div class="product-mobile-info">
                                    <h3 class="product-mobile-brand">${product.vendor || 'Voyage Eyewear'}</h3>
                                    <h4 class="product-mobile-title">${product.title} (${productCode})</h4>
                                    <div class="product-mobile-price">
                                        <span class="mobile-current-price">Rs. ${product.price}</span>
                                        ${product.originalPrice && product.originalPrice > product.price ? `<span class="mobile-original-price">Rs. ${product.originalPrice}</span>` : ''}
                                        ${product.originalPrice && product.originalPrice > product.price ? `<span class="mobile-discount">${Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100)}% Off</span>` : ''}
                                    </div>
                                    <div class="product-mobile-status-line">
                                        <div class="mobile-stock-status">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M9 12l2 2 4-4"/>
                                                <circle cx="12" cy="12" r="10"/>
                                            </svg>
                                            In Stock
                                        </div>
                                        <span class="status-divider">|</span>
                                        <div class="mobile-delivery-info">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                            </svg>
                                            2-3 days
                                        </div>
                                        <span class="status-divider">|</span>
                                        <div class="mobile-rating-info">
                                            <div class="mobile-stars">
                                                ${'★'.repeat(Math.floor(rating))}${'☆'.repeat(5 - Math.floor(rating))}
                                            </div>
                                            <span class="mobile-rating-count">(${reviewCount})</span>
                                        </div>
                                    </div>
                                    <div class="product-mobile-actions">
                                        <button class="mobile-add-to-cart ${!product.available ? 'disabled' : ''}" onclick="event.stopPropagation(); addToCartFromCollection('${product.id}', '${product.title}', ${product.price}, event)" ${!product.available ? 'disabled' : ''}>
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                                <line x1="3" y1="6" x2="21" y2="6"/>
                                                <path d="M16 10a4 4 0 01-8 0"/>
                                            </svg>
                                            ${product.available ? 'Add to Cart' : 'Out of Stock'}
                                        </button>
                                        <button class="mobile-action-btn wishlist-btn" onclick="event.stopPropagation(); toggleWishlist(this, '${product.id}', event)" title="Add to Wishlist">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                            </svg>
                                        </button>
                                        <button class="mobile-action-btn share-btn" onclick="event.stopPropagation(); console.log('Share product:', '${product.title}')" title="Share Product">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                                <polyline points="16,6 12,2 8,6"/>
                                                <line x1="12" y1="2" x2="12" y2="15"/>
                                            </svg>
                                        </button>
                                    </div>
                                                                            </div>
                            </div>
                        `;
                            }
                        }).join('')}
                    </div>
                `;
                
                // Initialize auto-sliding for product images
                setTimeout(() => {
                    initializeProductImageSliders();
                }, 100);
            }
        }
        
        // Initialize auto-sliding product image sliders
        function initializeProductImageSliders() {
            console.log('🎯 Initializing product image sliders with enhanced auto-slide');
            
            const sliders = document.querySelectorAll('.product-image-slider');
            sliders.forEach(slider => {
                const container = slider.querySelector('.product-images-container');
                const images = slider.querySelectorAll('.product-slide-image');
                const indicators = slider.querySelectorAll('.image-indicator');
                
                if (images.length <= 1) {
                    console.log('🎯 Skipping slider - only one image');
                    return; // Skip if only one image
                }
                
                let currentIndex = 0;
                const autoSlideInterval = 3000; // 3 seconds
                let autoSlideTimer = null;
                let isPaused = false;
                
                function slideToIndex(index) {
                    currentIndex = index;
                    const translateX = -index * 100;
                    container.style.transform = `translateX(${translateX}%)`;
                    
                    // Update indicators
                    indicators.forEach((indicator, i) => {
                        indicator.classList.toggle('active', i === index);
                    });
                    
                    console.log(`🎯 Slid to image ${index + 1}/${images.length}`);
                }
                
                function nextSlide() {
                    if (!isPaused) {
                        const nextIndex = (currentIndex + 1) % images.length;
                        slideToIndex(nextIndex);
                    }
                }
                
                function startAutoSlide() {
                    if (autoSlideTimer) clearInterval(autoSlideTimer);
                    autoSlideTimer = setInterval(nextSlide, autoSlideInterval);
                    slider.classList.add('auto-sliding');
                    console.log('▶️ Auto-slide started');
                }
                
                function stopAutoSlide() {
                    if (autoSlideTimer) {
                        clearInterval(autoSlideTimer);
                        autoSlideTimer = null;
                        slider.classList.remove('auto-sliding');
                        console.log('⏸️ Auto-slide paused');
                    }
                }
                
                // Start auto-sliding immediately
                startAutoSlide();
                
                // Pause auto-slide on touch/hover
                slider.addEventListener('mouseenter', () => {
                    isPaused = true;
                    stopAutoSlide();
                });
                
                slider.addEventListener('touchstart', () => {
                    isPaused = true;
                    stopAutoSlide();
                });
                
                // Resume auto-slide on mouse leave/touch end
                slider.addEventListener('mouseleave', () => {
                    isPaused = false;
                    startAutoSlide();
                });
                
                slider.addEventListener('touchend', () => {
                    setTimeout(() => {
                        isPaused = false;
                        startAutoSlide();
                    }, 1000); // Resume after 1 second
                });
                
                // Click indicators to navigate
                indicators.forEach((indicator, index) => {
                    indicator.addEventListener('click', (e) => {
                        e.stopPropagation();
                        stopAutoSlide();
                        slideToIndex(index);
                        setTimeout(() => {
                            if (!isPaused) startAutoSlide();
                        }, 1000); // Resume after 1 second
                    });
                });
                
                // Swipe functionality for touch devices
                let startX = 0;
                let isDragging = false;
                
                slider.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                });
                
                slider.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                });
                
                slider.addEventListener('touchend', (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    if (Math.abs(diffX) > 50) { // Minimum swipe distance
                        if (diffX > 0) {
                            // Swipe left - next image
                            const nextIndex = (currentIndex + 1) % images.length;
                            slideToIndex(nextIndex);
                        } else {
                            // Swipe right - previous image
                            const prevIndex = (currentIndex - 1 + images.length) % images.length;
                            slideToIndex(prevIndex);
                        }
                    }
                });
                
                console.log(`🎯 Enhanced slider initialized for product with ${images.length} images - Auto-slide every ${autoSlideInterval/1000}s`);
            });
        }

        window.closeCollectionPage = function() {
            console.log('📱 Closing collection page');
            
            const collectionPage = document.getElementById('collection-full-page');
            if (collectionPage) {
                collectionPage.classList.remove('active');
                setTimeout(() => {
                    document.body.removeChild(collectionPage);
                    document.body.classList.remove('collection-page-mode');
                    console.log('📱 Collection page removed');
                }, 300);
            }
        }

        // Collection Controls Functions
        let currentSortType = 'featured';
        let currentViewType = 'tile';
        let activeFilters = {};

        window.toggleSortDropdown = function() {
            const dropdown = document.getElementById('sortOptions');
            dropdown?.classList.toggle('show');
        };

        function selectSort(sortType) {
            currentSortType = sortType;
            
            // Update UI
            document.querySelectorAll('.sort-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-sort="${sortType}"]`)?.classList.add('selected');
            
            // Update button label
            const labels = {
                'featured': 'Featured',
                'price-low': 'Price ↑',
                'price-high': 'Price ↓',
                'name': 'Name A-Z',
                'newest': 'Newest'
            };
            const labelElement = document.getElementById('sort-label');
            if (labelElement) labelElement.textContent = labels[sortType];
            
            // Close dropdown
            document.getElementById('sortOptions')?.classList.remove('show');
            
            // Apply sorting
            applySorting();
            console.log('🔄 Sorting applied:', sortType);
        }

        function applySorting() {
            const grid = document.querySelector('.collection-mobile-grid');
            if (!grid) return;

            const cards = Array.from(grid.children);
            const productCards = cards.filter(card => card.classList.contains('collection-mobile-card'));
            const bannerCards = cards.filter(card => card.classList.contains('collection-banner-card'));

            productCards.sort((a, b) => {
                const priceA = parseFloat(a.querySelector('.mobile-current-price')?.textContent.replace(/[^\d.]/g, '') || '0');
                const priceB = parseFloat(b.querySelector('.mobile-current-price')?.textContent.replace(/[^\d.]/g, '') || '0');
                const nameA = a.querySelector('.product-mobile-title')?.textContent || '';
                const nameB = b.querySelector('.product-mobile-title')?.textContent || '';

                switch(currentSortType) {
                    case 'price-low': return priceA - priceB;
                    case 'price-high': return priceB - priceA;
                    case 'name': return nameA.localeCompare(nameB);
                    case 'newest': return Math.random() - 0.5; // Random for demo
                    default: return 0; // Featured - keep original order
                }
            });

            // Clear and rebuild grid with sorted products + banners
            grid.innerHTML = '';
            let bannerIndex = 0;
            productCards.forEach((card, index) => {
                grid.appendChild(card);
                if ((index + 1) % 2 === 0 && bannerIndex < bannerCards.length) {
                    grid.appendChild(bannerCards[bannerIndex]);
                    bannerIndex++;
                }
            });
        }

        window.openFilterModal = function() {
            document.getElementById('filterModal')?.classList.add('show');
            console.log('📂 Filter modal opened');
        };

        window.closeFilterModal = function() {
            document.getElementById('filterModal')?.classList.remove('show');
            console.log('📂 Filter modal closed');
        };

        window.clearFilters = function() {
            // Uncheck all checkboxes
            document.querySelectorAll('#filterModal input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            activeFilters = {};
            applyFilters();
            console.log('🧹 Filters cleared');
        };

        window.applyFilters = function() {
            // Collect selected filters
            activeFilters = {};
            document.querySelectorAll('#filterModal input[type="checkbox"]:checked').forEach(checkbox => {
                const section = checkbox.closest('.filter-section')?.querySelector('h4')?.textContent;
                if (section) {
                    if (!activeFilters[section]) activeFilters[section] = [];
                    activeFilters[section].push(checkbox.value);
                }
            });

            console.log('🔍 Filters applied:', activeFilters);
            
            // Apply filters to products (simplified demo implementation)
            const cards = document.querySelectorAll('.collection-mobile-card');
            cards.forEach(card => {
                let visible = true;
                
                // Price filter example
                if (activeFilters['Price Range']?.length > 0) {
                    const price = parseFloat(card.querySelector('.mobile-current-price')?.textContent.replace(/[^\d.]/g, '') || '0');
                    const priceMatches = activeFilters['Price Range'].some(range => {
                        switch(range) {
                            case '0-50': return price < 50;
                            case '50-100': return price >= 50 && price <= 100;
                            case '100-200': return price >= 100 && price <= 200;
                            case '200+': return price > 200;
                            default: return false;
                        }
                    });
                    if (!priceMatches) visible = false;
                }

                card.style.display = visible ? 'block' : 'none';
            });

            closeFilterModal();
        };

        window.switchView = function(viewType) {
            currentViewType = viewType;
            
            // Update view tabs
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-view="${viewType}"]`)?.classList.add('active');
            
            // Apply view styles
            const grid = document.querySelector('.collection-mobile-grid');
            const cards = document.querySelectorAll('.collection-mobile-card');
            const images = document.querySelectorAll('.product-mobile-image');
            const infos = document.querySelectorAll('.product-mobile-info');
            const actions = document.querySelectorAll('.product-mobile-actions');
            const addToBagBtns = document.querySelectorAll('.mobile-add-to-cart');
            const actionBtns = document.querySelectorAll('.mobile-action-btn');

            if (viewType === 'list') {
                grid?.classList.add('list-view');
                cards.forEach(card => card.classList.add('list-view'));
                images.forEach(img => img.classList.add('list-view'));
                infos.forEach(info => info.classList.add('list-view'));
                actions.forEach(action => action.classList.add('list-view'));
                addToBagBtns.forEach(btn => btn.classList.add('list-view'));
                actionBtns.forEach(btn => btn.classList.add('list-view'));
            } else {
                grid?.classList.remove('list-view');
                cards.forEach(card => card.classList.remove('list-view'));
                images.forEach(img => img.classList.remove('list-view'));
                infos.forEach(info => info.classList.remove('list-view'));
                actions.forEach(action => action.classList.remove('list-view'));
                addToBagBtns.forEach(btn => btn.classList.remove('list-view'));
                actionBtns.forEach(btn => btn.classList.remove('list-view'));
            }

            console.log('👁️ View switched to:', viewType);
        };

        // Initialize event listeners for collection controls
        document.addEventListener('click', function(event) {
            // Close dropdowns when clicking outside
            if (!event.target.closest('.sort-dropdown')) {
                document.getElementById('sortOptions')?.classList.remove('show');
            }
            if (!event.target.closest('.filter-modal') && !event.target.closest('[onclick="openFilterModal()"]')) {
                document.getElementById('filterModal')?.classList.remove('show');
            }
            
            // Handle sort option clicks
            if (event.target.classList.contains('sort-option')) {
                const sortType = event.target.getAttribute('data-sort');
                if (sortType) selectSort(sortType);
            }
        });

        // Navigation stack to track page history
        let navigationStack = [];
        
        // Open product detail page from collection or featured products
        window.openProductFromCollection = function(productHandle, event) {
            console.log('🔍 PRODUCT CLICK DEBUG: Function called with:', {
                productHandle,
                eventExists: !!event,
                eventType: event?.type,
                target: event?.target?.tagName,
                currentTarget: event?.currentTarget?.className
            });
            
            if (event) {
                event.preventDefault();
                event.stopPropagation();
                console.log('🔍 PRODUCT CLICK DEBUG: Event prevented and stopped');
            }
            
            console.log('🔍 Opening product from collection/featured:', productHandle);
            
            // SAVE CURRENT SCROLL POSITION
            const currentScrollY = window.scrollY || document.documentElement.scrollTop;
            console.log('📍 Saving scroll position:', currentScrollY);
            
            // Determine current context (homepage featured products vs collection page)
            const collectionPage = document.getElementById('collection-full-page');
            const isFromCollection = collectionPage && collectionPage.classList.contains('active');
            
            let navigationData;
            
            if (isFromCollection) {
                // From collection page
                const collectionTitle = collectionPage?.querySelector('.collection-mobile-title')?.textContent;
                const collectionHandle = getCurrentCollectionHandle();
                navigationData = {
                    type: 'collection',
                    handle: collectionHandle,
                    title: collectionTitle,
                    scrollPosition: currentScrollY
                };
            } else {
                // From homepage featured products
                navigationData = {
                    type: 'homepage-featured',
                    scrollPosition: currentScrollY,
                    section: 'featured-products'
                };
            }
            
            // Add current context to navigation stack
            navigationStack.push(navigationData);
            console.log('📍 Added to navigation stack:', navigationStack);
            
            // Smooth transition without scroll jump
            if (isFromCollection && collectionPage) {
                collectionPage.style.transition = 'transform 0.15s ease-out, opacity 0.15s ease-out';
                collectionPage.style.transform = 'translateX(-20%)';
                collectionPage.style.opacity = '0.5';
            }
            
            // Open product detail page with NO SCROLL JUMP
            setTimeout(async () => {
                try {
                    console.log('🔍 PRODUCT CLICK DEBUG: About to call showProduct with:', productHandle);
                    // Use the existing product detail page system
                    await showProduct(productHandle);
                    console.log('✅ PRODUCT CLICK DEBUG: Product detail page opened successfully for:', productHandle);
                } catch (error) {
                    console.error('❌ PRODUCT CLICK DEBUG: Error opening product:', error);
                    console.error('❌ PRODUCT CLICK DEBUG: Error stack:', error.stack);
                    showToast('Error opening product details');
                    // Restore previous page if product fails to load
                    if (isFromCollection) {
                        restoreCollectionPage();
                    } else {
                        // For featured products, just restore scroll position without page refresh
                        console.log('📍 Restoring scroll position without page refresh');
                        setTimeout(() => {
                            window.scrollTo({
                                top: currentScrollY,
                                behavior: 'auto'
                            });
                        }, 100);
                    }
                }
            }, isFromCollection ? 75 : 0); // No delay for homepage, small delay for collection
        }
        
        // Get current collection handle
        function getCurrentCollectionHandle() {
            const collectionPage = document.getElementById('collection-full-page');
            if (collectionPage) {
                // Use stored data attribute first, then fallback to title
                const handle = collectionPage.getAttribute('data-collection-handle');
                if (handle) {
                    return handle;
                }
                
                // Fallback: extract from title
                const title = collectionPage.querySelector('.collection-mobile-title')?.textContent?.toLowerCase();
                return title || 'frontpage';
            }
            return 'frontpage';
        }
        
        // Restore collection page smoothly with scroll position
        function restoreCollectionPage() {
            const collectionPage = document.getElementById('collection-full-page');
            if (collectionPage) {
                collectionPage.style.transform = 'translateX(0)';
                collectionPage.style.opacity = '1';
                
                // Restore scroll position from navigation stack
                const lastNavigation = navigationStack[navigationStack.length - 1];
                if (lastNavigation && lastNavigation.scrollPosition !== undefined) {
                    setTimeout(() => {
                        window.scrollTo(0, lastNavigation.scrollPosition);
                        console.log('📍 Restored collection scroll position:', lastNavigation.scrollPosition);
                    }, 100);
                }
            }
        }

        // Restore homepage with scroll position
        function restoreHomepageWithScrollPosition(scrollPosition) {
            console.log('📍 Restoring homepage with scroll position:', scrollPosition);
            
            // Show homepage
            showPage('home');
            
            // Restore scroll position after a brief delay to ensure page is rendered
            setTimeout(() => {
                window.scrollTo({
                    top: scrollPosition,
                    behavior: 'auto' // Use auto for instant restoration
                });
                console.log('📍 Homepage scroll position restored to:', scrollPosition);
            }, 150);
        }

        // Add to cart from collection with event handling
        window.addToCartFromCollection = function(productId, title, price, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('🛒 Adding to cart from collection:', { productId, title, price });
            
            // Use existing add to cart functionality
            addToCart(productId, title, price);
        }

        // Update wishlist function to handle event parameter
        window.toggleWishlist = function(button, productId, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('❤️ Toggling wishlist for product:', productId);
            
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                // Remove from wishlist
                button.classList.remove('active');
                button.title = 'Add to Wishlist';
                console.log('❤️ Removed from wishlist:', productId);
                showToast('Removed from wishlist');
            } else {
                // Add to wishlist
                button.classList.add('active');
                button.title = 'Remove from Wishlist';
                console.log('❤️ Added to wishlist:', productId);
                showToast('Added to wishlist');
            }
        }

        function showCollectionOverlay(handle) {
            // Original overlay behavior for desktop
            showToast(`Opening ${handle} collection...`);
            document.body.classList.add('hide-header');
            showPage('collection');
            loadCollectionProducts(handle);
        }

        // Load products for a specific collection
        async function loadCollectionProducts(collectionHandle) {
            console.log('🔍 DEBUG: loadCollectionProducts called with handle:', collectionHandle);
            
            // Show loading state
            const productsGrid = document.getElementById('collection-products-grid');
            console.log('🔍 DEBUG: collection-products-grid element exists:', !!productsGrid);
            
            if (productsGrid) {
                console.log('🔍 DEBUG: Setting loading state in products grid');
                productsGrid.innerHTML = `
                    <div class="loading-products">
                        <div class="spinner"></div>
                        <p>Loading ${collectionHandle} products...</p>
                    </div>
                `;
                console.log('🔍 DEBUG: Loading state set successfully');
            } else {
                console.error('🔍 ERROR: collection-products-grid element not found!');
                return;
            }
            
            try {
                console.log('🔍 DEBUG: Fetching REAL products for collection:', collectionHandle);
                
                // Try to fetch real products from API first
                let collectionProducts = await fetchRealCollectionProducts(collectionHandle);
                
                // If no real products found, fallback to generated products
                if (!collectionProducts || collectionProducts.length === 0) {
                    console.log('🔍 DEBUG: No real products found, using generated products as fallback');
                    collectionProducts = generateCollectionProducts(collectionHandle);
                }
                
                console.log('🔍 DEBUG: Final products to render:', collectionProducts);
                
                console.log('🔍 DEBUG: About to render products using renderNewCollectionProducts');
                // Render the products using new design
                renderNewCollectionProducts(collectionProducts, collectionHandle);
                console.log('🔍 DEBUG: Finished rendering products');
                
            } catch (error) {
                console.error('🔍 ERROR: Error in loadCollectionProducts:', error);
                console.error('🔍 ERROR: Error stack:', error.stack);
                if (productsGrid) {
                    productsGrid.innerHTML = `
                        <div class="error-message">
                            <p>Failed to load ${collectionHandle} products</p>
                            <button onclick="loadCollectionProducts('${collectionHandle}')" class="retry-btn">Retry</button>
                        </div>
                    `;
                }
            }
        }

        // Fetch real products from Shopify API
        async function fetchRealCollectionProducts(collectionHandle) {
            console.log('🛒 Fetching real products for collection:', collectionHandle);
            
            try {
                // Use the mobile-products endpoint that has collection-specific products
                console.log('🛒 Using mobile-products API endpoint for collection-specific products...');
                const response = await fetch(`${API_BASE}/api/mobile-products`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                if (!response.ok) {
                    console.warn('🛒 Mobile-products API response not ok:', response.status, response.statusText);
                    return null;
                }

                const data = await response.json();
                console.log('🛒 Raw mobile-products API response:', data);

                if (!data.success || !data.collections) {
                    console.warn('🛒 Mobile-products API response missing collections:', data);
                    return null;
                }

                // Find the specific collection by handle
                const targetCollection = data.collections.find(collection => 
                    collection.handle === collectionHandle
                );

                console.log(`🛒 Looking for collection '${collectionHandle}'`);
                console.log('🛒 Available collections:', data.collections.map(c => c.handle));
                
                if (!targetCollection) {
                    console.warn(`🛒 Collection '${collectionHandle}' not found, using frontpage products`);
                    // Fallback to all products if collection not found
                    if (data.products && data.products.length > 0) {
                        return transformProductsToFormat(data.products.slice(0, 8));
                    }
                    return null;
                }

                console.log(`🛒 Found collection '${targetCollection.title}' with ${targetCollection.products.length} products`);
                
                // Use the products from the specific collection
                const collectionProducts = targetCollection.products;
                
                if (!collectionProducts || collectionProducts.length === 0) {
                    console.warn(`🛒 No products found in collection '${collectionHandle}'`);
                    return null;
                }

                // Transform collection products to our format
                const transformedProducts = transformProductsToFormat(collectionProducts);
                
                console.log(`🛒 Transformed ${transformedProducts.length} real products from collection '${collectionHandle}'`);
                return transformedProducts;

            } catch (error) {
                console.error('🛒 Error fetching real collection products:', error);
                return null;
            }
        }

        // Helper function to transform products to our expected format - PRESERVE REAL SHOPIFY PRICING
        function transformProductsToFormat(products) {
            return products.map(product => {
                console.log('💰 TRANSFORM: Processing product pricing:', {
                    productTitle: product.title,
                    rawPrice: product.price,
                    variants: product.variants,
                    hasVariants: !!(product.variants && product.variants.length > 0)
                });
                
                // Parse price from string format
                let price = 0;
                let originalPrice = null; // Start with null - only set if we have real data
                
                if (product.price) {
                    price = parseFloat(product.price) || 0;
                }
                
                // ✅ PRIORITY 1: Use API-provided originalPrice (real Shopify compareAtPrice)
                if (product.originalPrice) {
                    const apiOriginalPrice = parseFloat(product.originalPrice.toString().replace(/[^\d.]/g, ''));
                    if (apiOriginalPrice && apiOriginalPrice > price) {
                        originalPrice = Math.round(apiOriginalPrice);
                        console.log('✅ TRANSFORM: Using API-provided original price (Real Shopify):', {
                            current: price,
                            original: originalPrice,
                            source: 'API.originalPrice',
                            discount: Math.round(((originalPrice - price) / originalPrice) * 100)
                        });
                    }
                }
                
                // ✅ PRIORITY 2: Check for real compare-at price from Shopify variants (backup)
                if (!originalPrice && product.variants && product.variants.length > 0) {
                    const firstVariant = product.variants[0];
                    
                    console.log('💰 TRANSFORM: Checking variant for compare-at price:', {
                        variantPrice: firstVariant.price,
                        compareAtPrice: firstVariant.compareAtPrice,
                        variantData: firstVariant
                    });
                    
                    // If variant has compare-at price, use it
                    if (firstVariant.compareAtPrice && parseFloat(firstVariant.compareAtPrice) > 0) {
                        const compareAtPrice = parseFloat(firstVariant.compareAtPrice);
                        if (compareAtPrice > price) {
                            originalPrice = Math.round(compareAtPrice);
                            console.log('✅ TRANSFORM: Using variant compare-at price:', {
                                current: price,
                                original: originalPrice,
                                source: 'variant.compareAtPrice',
                                discount: Math.round(((originalPrice - price) / originalPrice) * 100)
                            });
                        }
                    }
                }
                
                // If no real compare-at price found, don't generate fake ones
                if (!originalPrice) {
                    console.log('⚠️ TRANSFORM: No compare-at price from Shopify, showing current price only');
                }
                
                const finalProduct = {
                    id: product.id,
                    title: product.title,
                    handle: product.handle,
                    price: Math.round(price),
                    originalPrice: originalPrice, // Will be null if no real compare-at price
                    vendor: product.vendor || 'GoEye',
                    image: product.image || product.images?.[0] || '',
                    description: product.description || '',
                    available: product.available !== false,
                    variants: product.variants || [{
                        id: product.id,
                        title: 'Default',
                        price: price,
                        available: product.available !== false
                    }]
                };
                
                console.log('💰 TRANSFORM: Final product pricing:', {
                    title: finalProduct.title,
                    price: finalProduct.price,
                    originalPrice: finalProduct.originalPrice,
                    willShowComparePrice: !!finalProduct.originalPrice
                });
                
                return finalProduct;
            });
        }

        // Generate products for any collection
        function generateCollectionProducts(collectionHandle) {
            const productImages = [
                'https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400&h=400&fit=crop&q=80',
                'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=400&h=400&fit=crop&q=80',
                'https://images.unsplash.com/photo-1556306831-4b3e6dcabf54?w=400&h=400&fit=crop&q=80',
                'https://images.unsplash.com/photo-1582142306909-195724d33e24?w=400&h=400&fit=crop&q=80',
                'https://images.unsplash.com/photo-1530039623242-6ce4084e6c9e?w=400&h=400&fit=crop&q=80'
            ];
            
            const collectionName = collectionHandle.charAt(0).toUpperCase() + collectionHandle.slice(1);
            
            return [
                {
                    id: `${collectionHandle}-1`,
                    title: `${collectionName} Frame Classic`,
                    handle: `${collectionHandle}-frame-classic`,
                    price: 799,
                    originalPrice: 1999,
                    vendor: 'GoEye',
                    image: productImages[0],
                    description: `Premium ${collectionName.toLowerCase()} collection eyewear`
                },
                {
                    id: `${collectionHandle}-2`,
                    title: `${collectionName} Pro Series`,
                    handle: `${collectionHandle}-pro-series`,
                    price: 999,
                    originalPrice: 2499,
                    vendor: 'GoEye',
                    image: productImages[1],
                    description: `Professional ${collectionName.toLowerCase()} eyewear design`
                },
                {
                    id: `${collectionHandle}-3`,
                    title: `${collectionName} Designer`,
                    handle: `${collectionHandle}-designer`,
                    price: 1299,
                    originalPrice: 2999,
                    vendor: 'GoEye',
                    image: productImages[2],
                    description: `Designer ${collectionName.toLowerCase()} collection frames`
                },
                {
                    id: `${collectionHandle}-4`,
                    title: `${collectionName} Vintage`,
                    handle: `${collectionHandle}-vintage`,
                    price: 899,
                    originalPrice: 2199,
                    vendor: 'GoEye',
                    image: productImages[3],
                    description: `Vintage inspired ${collectionName.toLowerCase()} frames`
                },
                {
                    id: `${collectionHandle}-5`,
                    title: `${collectionName} Sport`,
                    handle: `${collectionHandle}-sport`,
                    price: 1099,
                    originalPrice: 2799,
                    vendor: 'GoEye',
                    image: productImages[4],
                    description: `Active ${collectionName.toLowerCase()} eyewear`
                }
            ];
        }

        // Render collection products with NEW DESIGN based on main-collection.liquid
        function renderNewCollectionProducts(products, collectionHandle) {
            console.log('🔍 DEBUG: renderNewCollectionProducts called');
            console.log('🔍 DEBUG: Products received:', products);
            console.log('🔍 DEBUG: Collection handle:', collectionHandle);
            
            const productsGrid = document.getElementById('collection-products-grid');
            console.log('🔍 DEBUG: collection-products-grid element in render:', !!productsGrid);
            
            if (!productsGrid) {
                console.error('🔍 ERROR: collection-products-grid not found in renderNewCollectionProducts!');
                return;
            }
            
            const collectionName = collectionHandle.charAt(0).toUpperCase() + collectionHandle.slice(1);
            console.log('🔍 DEBUG: Collection name for display:', collectionName);
            
            productsGrid.innerHTML = `
                <div class="collection-page-header">
                    <button class="collection-back-btn" onclick="showPage('home')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <div class="collection-title-info">
                        <h1 class="collection-page-title">${collectionName}</h1>
                        <span class="collection-product-count">${products.length} Products</span>
                    </div>
                    <div class="collection-actions">
                        <button class="collection-action-btn" onclick="openWishlistModal()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                        </button>
                        <button class="collection-action-btn cart-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                <line x1="3" y1="6" x2="21" y2="6"/>
                                <path d="M16 10a4 4 0 01-8 0"/>
                            </svg>
                            <span class="cart-count">${cart.length}</span>
                        </button>
                    </div>
                </div>
                <div class="collection-product-grid">
                    ${products.map(product => `
                        <div class="collection-product-card">
                            <div class="product-image-area">
                                <img src="${product.image}" alt="${product.title}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQwIiBoZWlnaHQ9IjI0MCIgdmlld0JveD0iMCAwIDI0MCAyNDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyNDAiIGhlaWdodD0iMjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik05NiA5NkgxNDRWMTQ0SDk2Vjk2WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'">
                                <div class="product-quick-actions">
                                    <button class="quick-action-btn wishlist-btn" onclick="toggleWishlist(this, '${product.id}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                        </svg>
                                    </button>
                                    <button class="quick-action-btn" onclick="shareProduct('${product.handle}', '${product.title}')">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="18" cy="5" r="3"/>
                                            <circle cx="6" cy="12" r="3"/>
                                            <circle cx="18" cy="19" r="3"/>
                                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="product-details-area">
                                <div class="product-details-top">
                                    <h3 class="product-brand-name">${product.vendor}</h3>
                                    <h4 class="product-item-title">${product.title}</h4>
                                    <div class="product-price-section">
                                        <span class="product-current-price">₹${product.price}</span>
                                        <span class="product-original-price">₹${product.originalPrice}</span>
                                        <span class="product-discount">${Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100)}% OFF</span>
                                    </div>
                                    <div class="product-feature-list">
                                        <div class="product-feature">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 7l-8 8-4-4"/>
                                            </svg>
                                            In Stock
                                        </div>
                                        <div class="product-feature">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                                <line x1="16" y1="2" x2="16" y2="6"/>
                                                <line x1="8" y1="2" x2="8" y2="6"/>
                                                <line x1="3" y1="10" x2="21" y2="10"/>
                                            </svg>
                                            2-3 days delivery
                                        </div>
                                    </div>
                                </div>
                                <div class="product-action-section">
                                    <button class="collection-add-to-cart" onclick="addToCart('${product.id}', '${product.title}', ${product.price})">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                            <line x1="3" y1="6" x2="21" y2="6"/>
                                            <path d="M16 10a4 4 0 01-8 0"/>
                                        </svg>
                                        Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Cart Functions
        function getShopifyCart() {
            try {
                return JSON.parse(localStorage.getItem('shopify-cart')) || null;
            } catch (e) {
                return null;
            }
        }

        function convertShopifyCartToLocal(shopifyCart) {
            if (!shopifyCart || !shopifyCart.items) return [];
            
            return shopifyCart.items.map(item => ({
                id: item.id,
                title: item.product_title,
                price: (item.price / 100).toFixed(2),
                quantity: item.quantity,
                image: item.image,
                variant_id: item.variant_id
            }));
        }

        async function validateShopifyCart() {
            const shopifyCart = getShopifyCart();
            if (!shopifyCart) return;
            
            try {
                const response = await fetch(`${API_BASE}/api/cart`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ action: 'validate', cart: shopifyCart })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.cart) {
                        localStorage.setItem('shopify-cart', JSON.stringify(data.cart));
                        cart = convertShopifyCartToLocal(data.cart);
                        updateCartDisplay();
                    }
                }
            } catch (error) {
                console.error('Cart validation error:', error);
            }
        }

        // Load Header Settings for Icon Colors, Navigation, and Announcement Bar
        async function loadHeaderSettings() {
            try {
                console.log('🎨 Loading header settings for icon colors, navigation, and announcement bar...');
                const response = await fetch(`${API_BASE}/api/header-settings`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.header) {
                        applyHeaderColors(data.header);
                        console.log('✅ Header colors applied successfully');
                    }
                    
                    // Load navigation items
                    if (data.nav_items) {
                        loadNavigationItems(data.nav_items);
                        console.log('✅ Navigation items loaded successfully');
                    }
                    
                    // Load announcement bar
                    if (data.announcement_bar) {
                        loadAnnouncementBar(data.announcement_bar);
                        console.log('✅ Announcement bar loaded successfully');
                    }
                }
            } catch (error) {
                console.log('⚠️ Header settings failed:', error);
                // Load default navigation items on error
                loadDefaultNavigationItems();
            }
        }

        // Load Navigation Items (replaces existing navigation)
        function loadNavigationItems(navItems) {
            const navTabs = document.getElementById('nav-tabs');
            if (!navTabs) return;

            console.log('🎯 Loading dynamic navigation items:', navItems);

            // Always replace if we have items from API
            if (navItems && navItems.length > 0) {
                console.log('📱 Replacing static navigation with dynamic items');
                navTabs.innerHTML = '';

                // Filter enabled items and sort by order
                const enabledItems = navItems.filter(item => item.enabled).sort((a, b) => a.order - b.order);

                if (enabledItems.length > 0) {
                    enabledItems.forEach((item, index) => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        
                        a.href = item.link || '#';
                        a.className = index === 0 ? 'active' : '';
                        
                        // Create icon span
                        const iconSpan = document.createElement('span');
                        iconSpan.className = 'nav-tab-icon';
                        
                        // Get appropriate icon for each tab
                        const iconSVG = getNavIcon(item.title.toLowerCase());
                        iconSpan.innerHTML = iconSVG;
                        
                        a.appendChild(iconSpan);
                        a.appendChild(document.createTextNode(' ' + item.title));
                        
                        // Add click event with proper page loading logic
                        a.addEventListener('click', function(e) {
                            e.preventDefault();
                            // Remove active class from all tabs
                            navTabs.querySelectorAll('a').forEach(tab => tab.classList.remove('active'));
                            // Add active class to clicked tab
                            a.classList.add('active');
                            
                            // Handle page loading based on title
                            const tabText = item.title.toLowerCase().trim();
                            console.log('🎯 Dynamic nav tab clicked:', tabText);
                            
                            if (tabText === 'classic') {
                                console.log('🎨 Loading Classic Collection page...');
                                loadExternalPage('./pages/classic-collection.html');
                            } else if (tabText === 'premium') {
                                console.log('💎 Loading Premium Collection page...');
                                loadExternalPage('./pages/premium-collection.html');
                            } else if (tabText === 'sport') {
                                console.log('🏃 Loading Sport Collection page...');
                                loadExternalPage('./pages/sport-collection.html');
                            } else if (tabText === 'trendy') {
                                console.log('✨ Loading Trendy Collection page...');
                                loadExternalPage('./pages/trendy-collection.html');
                            } else if (tabText === 'all') {
                                console.log('🏠 Returning to home view...');
                                // Close any external pages and return to home
                                closeExternalPage();
                            } else {
                                console.log(`📄 Loading custom page for: ${tabText}`);
                                if (item.link && item.link !== '#') {
                                    loadExternalPage(item.link);
                                } else {
                                    showToast(`${item.title} section coming soon!`);
                                }
                            }
                        });
                        
                        li.appendChild(a);
                        navTabs.appendChild(li);
                    });

                    console.log('✅ Dynamic navigation loaded successfully with', enabledItems.length, 'items');
            } else {
                    console.log('⚠️ No enabled dynamic items, keeping static navigation');
                }
            } else {
                console.log('⚠️ No dynamic items provided, keeping static navigation');
            }
        }

        // Load default navigation items if API fails
        function loadDefaultNavigationItems() {
            console.log('📍 Using default hardcoded navigation (API failed)');
            // Default navigation is already hardcoded in HTML, no need to replace it
        }

        // Get navigation icon SVG based on title
        function getNavIcon(title) {
            const icons = {
                'all': '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>',
                'classic': '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>',
                'premium': '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>',
                'default': '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>'
            };
            return icons[title] || icons['default'];
        }

        // Load Announcement Bar
        function loadAnnouncementBar(announcementData) {
            const announcementBar = document.getElementById('announcement-bar');
            const announcementText = document.getElementById('announcement-text');
            
            if (!announcementBar || !announcementText) return;

            if (announcementData.enabled) {
                // Set announcement text
                announcementText.textContent = announcementData.text || 'Free shipping on orders over $50! 🚚';
                
                // Set CSS variables for colors and animation speed
                const root = document.documentElement;
                root.style.setProperty('--announcement-background-color', announcementData.background_color || '#1E1B4B');
                root.style.setProperty('--announcement-text-color', announcementData.text_color || '#ffffff');
                root.style.setProperty('--announcement-scroll-speed', `${announcementData.scroll_speed || 5000}ms`);
                
                // Show announcement bar
                announcementBar.style.display = 'block';
            } else {
                // Hide announcement bar
                announcementBar.style.display = 'none';
            }
        }

        // Apply Header Colors to Icons
        function applyHeaderColors(settings) {
            const root = document.documentElement;
            
            // Set CSS custom properties for icon colors with proper fallbacks
            root.style.setProperty('--icon-color', settings.icon_color || '#ffffff');
            root.style.setProperty('--icon-hover-color', settings.icon_hover_color || '#ffffff');
            root.style.setProperty('--nav-text-color', settings.nav_text_color || '#6B7280');
            root.style.setProperty('--nav-active-color', settings.nav_active_color || '#1E1B4B');
            
            // Apply specific icon colors with fallbacks
            const menuButton = document.querySelector('.custom-header-left button[title="Menu"]');
            if (menuButton) {
                menuButton.style.color = settings.menu_icon_color || settings.icon_color || '#ffffff';
            }
            
            const cartIcon = document.querySelector('.header-cart-link');
            if (cartIcon) {
                cartIcon.style.color = settings.cart_icon_color || settings.icon_color || '#ffffff';
            }
            
            const wishlistIcon = document.querySelector('a[title="Wishlist"]');
            if (wishlistIcon) {
                wishlistIcon.style.color = settings.wishlist_icon_color || settings.icon_color || '#ffffff';
            }
            
            const accountIcon = document.querySelector('a[title="Account"]');
            if (accountIcon) {
                accountIcon.style.color = settings.account_icon_color || settings.icon_color || '#ffffff';
            }

            // Apply colors to search icon
            const searchIcon = document.querySelector('.custom-header-search button');
            if (searchIcon) {
                searchIcon.style.color = settings.icon_color || '#ffffff';
            }

            // Apply hover effects
            const allIcons = document.querySelectorAll('.custom-header-icons a, .custom-header-icons button, .custom-header-left button, .custom-header-right a');
            allIcons.forEach(icon => {
                icon.addEventListener('mouseenter', () => {
                    icon.style.color = settings.icon_hover_color || '#ffffff';
                });
                icon.addEventListener('mouseleave', () => {
                    // Reset to specific color or default
                    if (icon.title === 'Menu') {
                        icon.style.color = settings.menu_icon_color || settings.icon_color || '#ffffff';
                    } else if (icon.title === 'Cart') {
                        icon.style.color = settings.cart_icon_color || settings.icon_color || '#ffffff';
                    } else if (icon.title === 'Wishlist') {
                        icon.style.color = settings.wishlist_icon_color || settings.icon_color || '#ffffff';
                    } else if (icon.title === 'Account') {
                        icon.style.color = settings.account_icon_color || settings.icon_color || '#ffffff';
                    } else {
                        icon.style.color = settings.icon_color || '#ffffff';
                    }
                });
            });
            
            console.log('🎨 Applied header colors:', {
                icon_color: settings.icon_color || '#ffffff',
                cart_icon_color: settings.cart_icon_color || '#ffffff',
                menu_icon_color: settings.menu_icon_color || '#ffffff'
            });
        }

        // Auto-refresh Eyeglasses and Sunglasses with Image Preloading
        async function autoRefreshCategories() {
            let refreshCount = 0;
            const maxRefreshes = 3;
            const refreshInterval = 5000; // 5 seconds
            
            async function refreshCategorySections() {
                if (refreshCount >= maxRefreshes) return;
                
                try {
                    console.log(`🔄 Auto-refresh categories (${refreshCount + 1}/${maxRefreshes})`);
                    
                    // Refresh both sections in parallel
                    await Promise.all([
                        loadLiveEyeglasses(),
                        loadLiveSunglasses()
                    ]);
                    
                    // Preload category images
                    preloadCategoryImages();
                    
                    refreshCount++;
                    
                    if (refreshCount < maxRefreshes) {
                        setTimeout(refreshCategorySections, refreshInterval);
                    }
            } catch (error) {
                    console.log('⚠️ Auto-refresh failed:', error);
                }
            }
            
            // Start auto-refresh after initial load
            setTimeout(refreshCategorySections, 2000);
        }

        // Preload Category Images for Instant Display
        function preloadCategoryImages() {
            const imageUrls = [
                "https://goeye.in/cdn/shop/files/men.jpg",
                "https://goeye.in/cdn/shop/files/women.jpg", 
                "https://goeye.in/cdn/shop/files/kid-1.jpg",
                "https://goeye.in/cdn/shop/files/kid_copy_2.jpg",
                "https://goeye.in/cdn/shop/files/men_copy.jpg",
                "https://goeye.in/cdn/shop/files/women_copy_2.jpg",
                "https://goeye.in/cdn/shop/files/kid.jpg",
                "https://goeye.in/cdn/shop/files/kid_copy_3.jpg"
            ];
            
            imageUrls.forEach(url => {
                const img = new Image();
                img.src = url;
                console.log('🖼️ Preloaded:', url);
            });
        }

        // Initialize Collections Carousel Auto-Scroll
        function initializeCollectionsCarousel() {
            const collectionsGrid = document.getElementById('collections-grid');
            if (!collectionsGrid) return;
            
            let currentIndex = 0;
            const scrollInterval = 2000; // 2 seconds
            
            function autoScroll() {
                const cards = collectionsGrid.querySelectorAll('.collection-card');
                if (cards.length === 0) return;
                
                const cardWidth = cards[0].offsetWidth + 16; // card width + gap
                const maxScroll = collectionsGrid.scrollWidth - collectionsGrid.clientWidth;
                
                if (currentIndex >= cards.length) {
                    currentIndex = 0;
                    collectionsGrid.scrollTo({ left: 0, behavior: 'smooth' });
                } else {
                    const scrollLeft = currentIndex * cardWidth;
                    if (scrollLeft >= maxScroll) {
                        currentIndex = 0;
                        collectionsGrid.scrollTo({ left: 0, behavior: 'smooth' });
                    } else {
                        collectionsGrid.scrollTo({ left: scrollLeft, behavior: 'smooth' });
                    }
                }
                
                currentIndex++;
            }
            
            // Start auto-scroll
            const intervalId = setInterval(autoScroll, scrollInterval);
            
            // Pause auto-scroll on hover
            collectionsGrid.addEventListener('mouseenter', () => {
                clearInterval(intervalId);
            });
            
            // Resume auto-scroll when mouse leaves
            collectionsGrid.addEventListener('mouseleave', () => {
                setInterval(autoScroll, scrollInterval);
            });
            
            // Pause auto-scroll on touch
            collectionsGrid.addEventListener('touchstart', () => {
                clearInterval(intervalId);
            });
        }

        // TEST FUNCTION - Call this from console to test collections
        window.testCollection = function(handle = 'frontpage') {
            console.log('🧪 TEST: Testing collection functionality for handle:', handle);
            console.log('🧪 TEST: showCollection function exists:', typeof showCollection);
            console.log('🧪 TEST: Current view:', currentView);
            
            try {
                showCollection(handle);
                console.log('🧪 TEST: showCollection called successfully');
            } catch (error) {
                console.error('🧪 TEST ERROR:', error);
            }
        };

        // Test real products API
        window.testRealProducts = async function(collection = 'glam') {
            console.log('🛒 Testing real collection-specific products for:', collection);
            try {
                const products = await fetchRealCollectionProducts(collection);
                console.log('🛒 Collection-specific products response:', products);
                if (products && products.length > 0) {
                    console.log(`✅ Found ${products.length} real products in '${collection}' collection`);
                    console.log('🛒 Sample product:', products[0]);
                    return products;
                } else {
                    console.log(`⚠️ No products found in '${collection}' collection, will use fallback`);
                    return null;
                }
            } catch (error) {
                console.error('❌ Error testing collection products:', error);
                return null;
            }
        };

        // Debug API connection
        window.testAPIConnection = async function() {
            console.log('🔗 Testing API connection...');
            console.log('🔗 API_BASE:', API_BASE);
            
            try {
                // Test the mobile-products endpoint that we're actually using
                const response = await fetch(`${API_BASE}/api/mobile-products`);
                console.log('🔗 Mobile Products API Response status:', response.status);
                const data = await response.json();
                console.log('🔗 Mobile Products API Response data:', data);
                
                if (data.collections) {
                    console.log('🔗 Available collections:');
                    data.collections.forEach(collection => {
                        console.log(`  - ${collection.handle}: "${collection.title}" (${collection.products.length} products)`);
                    });
                }
                
                return data;
            } catch (error) {
                console.error('❌ API Connection error:', error);
                return null;
            }
        };

        // Test smooth navigation flow
        window.testSmoothNavigation = async function(collection = 'glam') {
            console.log('🎬 Testing smooth navigation flow for collection:', collection);
            
            // Step 1: Open collection page
            console.log('📱 Step 1: Opening collection page...');
            showCollection(collection);
            
            // Wait for collection to load
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Step 2: Open first product
            console.log('🔍 Step 2: Opening first product...');
            const collectionPage = document.getElementById('collection-full-page');
            const firstProduct = collectionPage?.querySelector('.collection-mobile-card');
            
            if (firstProduct) {
                firstProduct.click();
                console.log('✅ Clicked first product card');
                
                // Wait for product page to open
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Step 3: Test back navigation
                console.log('🔙 Step 3: Testing back navigation...');
                
                setTimeout(() => {
                    const backButton = document.querySelector('.back-button');
                    if (backButton) {
                        backButton.click();
                        console.log('✅ Clicked back button - should return to collection');
                    } else {
                        console.log('❌ Back button not found');
                    }
                }, 1000);
                
            } else {
                console.log('❌ No products found in collection');
            }
        };

        // Test navigation stack
        window.testNavigationStack = function() {
            console.log('📍 Current navigation stack:', navigationStack);
            console.log('📱 Current collection handle:', getCurrentCollectionHandle());
            
            const collectionPage = document.getElementById('collection-full-page');
            console.log('📄 Collection page exists:', !!collectionPage);
            
            if (collectionPage) {
                console.log('📄 Collection data attribute:', collectionPage.getAttribute('data-collection-handle'));
                console.log('📄 Collection title:', collectionPage.querySelector('.collection-mobile-title')?.textContent);
            }
        };

        // Failsafe function to force open product detail page
        window.forceOpenProductDetailPage = async function(productHandle) {
            console.log('🚨 FORCE OPENING product detail page for:', productHandle);
            
            try {
                // Force close any existing modals
                closeProductModal();
                
                // Hide collection page
                const collectionPage = document.getElementById('collection-full-page');
                if (collectionPage) {
                    collectionPage.style.transform = 'translateX(-30%)';
                    collectionPage.style.opacity = '0.7';
                }
                
                // Force open product detail page
                await showProduct(productHandle);
                console.log('✅ FORCE OPEN: Product detail page opened successfully');
                
            } catch (error) {
                console.error('❌ FORCE OPEN: Failed to open product detail page:', error);
                showToast('Error opening product page');
            }
        };

        // Enhanced mobile card click handler (backup)
        window.handleMobileCardClick = function(element, productHandle) {
            console.log('🔍 BACKUP: Mobile card clicked via backup handler:', productHandle);
            
            // Stop any other event handlers
            event?.preventDefault();
            event?.stopPropagation();
            
            // Force open the product detail page
            window.forceOpenProductDetailPage(productHandle);
        };

        // Initialize Image Slider for Product Detail Pages - ENHANCED
        window.initializeImageSlider = function() {
            console.log('🖼️ ENHANCED: Initializing image slider...');
            
            // Wait for DOM to be ready
            setTimeout(() => {
                console.log('🖼️ ENHANCED: Looking for slider elements...');
                
                const imageContainer = document.querySelector('.image-slider-container');
                const images = document.querySelectorAll('.product-image');
                const dots = document.querySelectorAll('.pagination-dot');
                
                console.log('🖼️ ENHANCED: Slider elements found:', {
                    imageContainer: !!imageContainer,
                    imageCount: images.length,
                    dotsCount: dots.length,
                    containerClass: imageContainer?.className,
                    imagesSelector: '.product-image'
                });
                
                if (!imageContainer) {
                    console.warn('⚠️ ENHANCED: Image container (.image-slider-container) not found');
                    // Try alternative selectors
                    const altContainer = document.querySelector('.product-images') || document.querySelector('.images-container');
                    if (altContainer) {
                        console.log('🖼️ ENHANCED: Found alternative container:', altContainer.className);
                    }
                    return;
                }
                
                if (!images.length) {
                    console.warn('⚠️ ENHANCED: No product images (.product-image) found');
                    // Try alternative image selectors
                    const altImages = document.querySelectorAll('.product-detail-image') || document.querySelectorAll('.slider-image');
                    console.log('🖼️ ENHANCED: Alternative images found:', altImages.length);
                    return;
                }
                
                let currentSlide = 0;
                let startX = 0;
                let isDragging = false;
                let autoSlideInterval = null;
                
                console.log(`🖼️ ENHANCED: Successfully found ${images.length} images for slider`);
            
                // Touch/Swipe handlers
                imageContainer.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    // Stop auto-slide when user interacts
                    if (autoSlideInterval) {
                        clearInterval(autoSlideInterval);
                        autoSlideInterval = null;
                    }
                });
                
                imageContainer.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                });
                
                imageContainer.addEventListener('touchend', (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    
                    const endX = e.changedTouches[0].clientX;
                    const diffX = startX - endX;
                    
                    if (Math.abs(diffX) > 50) { // Minimum swipe distance
                        if (diffX > 0) {
                            nextSlide();
                        } else {
                            prevSlide();
                        }
                    }
                });
                
                // Navigation functions
                window.nextSlide = function() {
                    currentSlide = (currentSlide + 1) % images.length;
                    updateSlider();
                };
                
                window.prevSlide = function() {
                    currentSlide = (currentSlide - 1 + images.length) % images.length;
                    updateSlider();
                };
                
                window.goToSlide = function(index) {
                    currentSlide = index;
                    updateSlider();
                };
                
                function updateSlider() {
                    // Update image positions
                    images.forEach((img, index) => {
                        img.style.transform = `translateX(-${currentSlide * 100}%)`;
                    });
                    
                    // Update pagination dots
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentSlide);
                    });
                    
                    console.log(`🖼️ ENHANCED: Slider updated to slide ${currentSlide + 1}/${images.length}`);
                }
                
                // Auto-slide functionality
                function startAutoSlide() {
                    if (images.length > 1) {
                        autoSlideInterval = setInterval(() => {
                            nextSlide();
                        }, 4000); // Change slide every 4 seconds
                        console.log('🖼️ ENHANCED: Auto-slide started');
                    }
                }
                
                function stopAutoSlide() {
                    if (autoSlideInterval) {
                        clearInterval(autoSlideInterval);
                        autoSlideInterval = null;
                        console.log('🖼️ ENHANCED: Auto-slide stopped');
                    }
                }
                
                // Initialize slider
                updateSlider();
                startAutoSlide();
                
                console.log('✅ ENHANCED: Image slider initialized successfully with', images.length, 'images');
                
            }, 200); // Wait 200ms for DOM to be ready
        };

        // Test real Shopify pricing data - COMPREHENSIVE DEBUG
        window.testRealPricing = async function(collection = 'glam') {
            console.log('💰 TESTING: Real Shopify pricing for collection:', collection);
            console.log('💰 TESTING: ===============================================');
            
            try {
                // Test 1: Direct API call to see raw Shopify data
                console.log('💰 TEST 1: Direct API call to mobile-products...');
                const response = await fetch(`${API_BASE}/api/mobile-products`);
                const data = await response.json();
                
                if (data.success && data.collections) {
                    const targetCollection = data.collections.find(c => c.handle === collection);
                    if (targetCollection) {
                        console.log('💰 RAW SHOPIFY API DATA:');
                        targetCollection.products.forEach((product, index) => {
                            console.log(`💰 Raw Product ${index + 1}:`, {
                                title: product.title,
                                price: product.price,
                                currency: product.currency,
                                variants: product.variants,
                                firstVariantPrice: product.variants?.[0]?.price,
                                firstVariantCompareAt: product.variants?.[0]?.compareAtPrice || 'NOT SET'
                            });
                        });
                    } else {
                        console.error(`💰 Collection '${collection}' not found in API response`);
                    }
                } else {
                    console.error('💰 API response failed or missing collections');
                }
                
                console.log('💰 TEST 2: Transformed products (after fetchRealCollectionProducts)...');
                // Test 2: Check transformed products
                const realProducts = await fetchRealCollectionProducts(collection);
                
                if (realProducts && realProducts.length > 0) {
                    console.log('💰 TRANSFORMED PRODUCTS:');
                    realProducts.forEach((product, index) => {
                        console.log(`💰 Transformed Product ${index + 1}:`, {
                            title: product.title,
                            currentPrice: product.price,
                            originalPrice: product.originalPrice,
                            hasComparePrice: !!product.originalPrice,
                            willShowDiscount: !!(product.originalPrice && product.originalPrice > product.price),
                            transformationWasCorrect: product.originalPrice === null || product.originalPrice > product.price
                        });
                    });
                } else {
                    console.error('💰 No transformed products found');
                }
                
                console.log('💰 TEST 3: Testing a specific product in PDP...');
                // Test 3: Test PDP transformation
                if (realProducts && realProducts.length > 0) {
                    const testProduct = realProducts[0];
                    console.log('💰 TESTING PDP with first product:', testProduct.title);
                    
                    // Simulate PDP transformation
                    console.log('💰 Before PDP transformation:', {
                        price: testProduct.price,
                        originalPrice: testProduct.originalPrice
                    });
                    
                    // Test if PDP would preserve the pricing
                    const enhanced = enhanceProductFromAPI ? enhanceProductFromAPI(testProduct) : testProduct;
                    console.log('💰 After enhancement (if any):', {
                        price: enhanced.price,
                        originalPrice: enhanced.originalPrice
                    });
                }
                
                console.log('💰 TESTING COMPLETE ===============================');
                
            } catch (error) {
                console.error('💰 TESTING ERROR:', error);
            }
        };

        // Quick test to see what's wrong with a specific product
        window.debugSpecificProduct = async function(productHandle) {
            console.log('🔍 DEBUGGING SPECIFIC PRODUCT:', productHandle);
            
            try {
                const product = await findProductByHandle(productHandle);
                console.log('🔍 Found product data:', {
                    title: product?.title,
                    price: product?.price,
                    originalPrice: product?.originalPrice,
                    hasOriginalPrice: !!product?.originalPrice,
                    variants: product?.variants
                });
                
                if (product) {
                    console.log('🔍 Opening product to test PDP pricing...');
                    await showProduct(productHandle);
                }
            } catch (error) {
                console.error('🔍 Error debugging product:', error);
            }
        };

        // Quick test function for immediate debugging
        window.debugProductOpen = function() {
            console.log('🧪 DEBUG: Testing product detail page opening...');
            
            // Test with a known product handle
            const testProduct = {
                id: 'test-product-123',
                handle: 'eyejack-cream-square-eyeglasses-for-men-women-2903fcl2098-c6',
                title: 'Eyejack Cream Square Eyeglasses for Men & Women',
                price: '₹799',
                originalPrice: '₹1199',
                discount: 33,
                image: 'https://cdn.shopify.com/s/files/1/0756/1/products/2903FCL2098-C6_Box.jpg',
                images: ['https://cdn.shopify.com/s/files/1/0756/1/products/2903FCL2098-C6_Box.jpg'],
                description: 'Premium quality eyeglasses with modern design.',
                rating: 4.5,
                ratingCount: 125,
                isNew: true,
                inStock: true
            };
            
            console.log('🧪 DEBUG: Opening test product directly...');
            openProductDetailPage(testProduct);
        };

        // Test product detail opening directly
        window.testProductDetail = async function(handle = 'eyejack-cream-square-eyeglasses-for-men-women-2903fcl2098-c6') {
            console.log('🔍 Testing product detail opening for:', handle);
            
            try {
                console.log('🌐 Fetching product data...');
                const product = await findProductByHandle(handle);
                
                if (product) {
                    console.log('✅ Product found:', product.title);
                    console.log('🎨 Product data:', product);
                    
                    // Open the product detail page
                    await showProduct(handle);
                    
                    console.log('✅ Product detail page should be open now');
                } else {
                    console.log('❌ Product not found for handle:', handle);
                    
                    // Show available products
                    console.log('🔍 Available products in collections:');
                    const response = await fetch(`${API_BASE}/api/mobile-products`);
                    const data = await response.json();
                    
                    if (data.success && data.collections) {
                        data.collections.forEach(collection => {
                            console.log(`📁 Collection: ${collection.title} (${collection.handle})`);
                            collection.products.forEach(product => {
                                console.log(`  - ${product.title} (${product.handle})`);
                            });
                        });
                    }
                }
            } catch (error) {
                console.error('❌ Error testing product detail:', error);
            }
        };

        // Test product opening from specific collection
        window.testProductFromCollection = async function(collectionHandle = 'glam', productIndex = 0) {
            console.log('🔍 Testing product opening from collection:', collectionHandle);
            
            try {
                // First open the collection
                await showCollection(collectionHandle);
                
                // Wait for collection to load
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Find and click the specified product
                const collectionPage = document.getElementById('collection-full-page');
                const productCards = collectionPage?.querySelectorAll('.collection-mobile-card');
                
                if (productCards && productCards[productIndex]) {
                    console.log(`✅ Found product card ${productIndex}, clicking...`);
                    productCards[productIndex].click();
                } else {
                    console.log('❌ Product card not found at index:', productIndex);
                    console.log('📊 Available product cards:', productCards?.length);
                }
            } catch (error) {
                console.error('❌ Error testing product from collection:', error);
            }
        };

                 // Splash Screen Control
         function setupSplashScreen() {
             console.log('🎬 SPLASH: Setting up splash screen...');
             
             const splashScreen = document.getElementById('splash-screen');
             if (!splashScreen) {
                 console.warn('⚠️ SPLASH: Splash screen element not found');
                 return;
             }
             
             // Hide main content initially
             const header = document.querySelector('.custom-header');
             const navigation = document.querySelector('.mobile-navigation');
             
             // Hide all main content sections initially (use opacity for splash)
             hideMainContent(true);
             if (header) header.style.opacity = '0';
             if (navigation) navigation.style.opacity = '0';
             
             // Setup splash screen removal after app loads
             let appLoadingStartTime = Date.now();
             
             // Start initial loading progress
             setTimeout(() => {
                 updateLoadingProgress('Initializing app...', 0);
             }, 300);
             
             // Enhanced loading progress monitoring with animations
             let loadingSteps = {
                 initialization: false,
                 productsLoaded: false,
                 collectionsLoaded: false,
                 stylingApplied: false
             };
             
             const checkAppReady = setInterval(() => {
                 const elapsedTime = Date.now() - appLoadingStartTime;
                 const minimumSplashTime = 3500; // Increased to 3.5 seconds minimum
                 
                 // Check loading progress
                 const productsGrid = document.getElementById('products-grid');
                 const collectionsGrid = document.getElementById('collections-grid');
                 
                 // Update loading steps
                 if (!loadingSteps.initialization && elapsedTime > 500) {
                     loadingSteps.initialization = true;
                     updateLoadingProgress('Initializing app...', 25);
                 }
                 
                 if (!loadingSteps.productsLoaded && productsGrid && productsGrid.children.length > 0) {
                     loadingSteps.productsLoaded = true;
                     updateLoadingProgress('Loading products...', 50);
                 }
                 
                 if (!loadingSteps.collectionsLoaded && collectionsGrid && collectionsGrid.children.length > 0) {
                     loadingSteps.collectionsLoaded = true;
                     updateLoadingProgress('Loading collections...', 75);
                 }
                 
                 if (!loadingSteps.stylingApplied && loadingSteps.productsLoaded && elapsedTime > 2000) {
                     loadingSteps.stylingApplied = true;
                     updateLoadingProgress('Finalizing experience...', 90);
                 }
                 
                 // Check if everything is ready
                 const allStepsComplete = Object.values(loadingSteps).every(step => step);
                 const isContentLoaded = productsGrid && productsGrid.children.length > 0;
                 
                 // Complete loading when all steps done AND minimum time passed
                 if (allStepsComplete && isContentLoaded && elapsedTime >= minimumSplashTime) {
                     updateLoadingProgress('Welcome to GoEye Store!', 100);
                     setTimeout(() => {
                         clearInterval(checkAppReady);
                         hideSplashScreen();
                     }, 800); // Show completion message briefly
                 } else if (elapsedTime >= 8000) {
                     // Force remove after 8 seconds maximum (increased from 5)
                     updateLoadingProgress('Ready!', 100);
                     setTimeout(() => {
                         clearInterval(checkAppReady);
                         hideSplashScreen();
                     }, 500);
                 }
             }, 200); // Check every 200ms for smoother progress
         }
         
         // Update loading progress with animations
         function updateLoadingProgress(message, progress) {
             console.log(`🎬 SPLASH: ${message} (${progress}%)`);
             
             const loadingText = document.querySelector('.loading-text');
             const progressBar = document.querySelector('.progress-bar-fill');
             const progressPercent = document.querySelector('.progress-percent');
             const stepDots = document.querySelectorAll('.step-dot');
             
             if (loadingText) {
                 // Animate text change
                 loadingText.style.opacity = '0.5';
                 setTimeout(() => {
                     loadingText.textContent = message;
                     loadingText.style.opacity = '1';
                 }, 150);
             }
             
             if (progressBar) {
                 progressBar.style.width = `${progress}%`;
             }
             
             if (progressPercent) {
                 progressPercent.textContent = `${progress}%`;
             }
             
             // Update step indicators based on progress
             stepDots.forEach((dot, index) => {
                 dot.classList.remove('active');
                 if (progress >= (index + 1) * 25) {
                     dot.classList.add('active');
                 }
             });
             
             // Add special animations for milestones
             if (progress === 25) {
                 addPulseEffect('.step-dot:nth-child(1)');
             } else if (progress === 50) {
                 addSparkleEffect();
                 addPulseEffect('.step-dot:nth-child(2)');
             } else if (progress === 75) {
                 addPulseEffect('.step-dot:nth-child(3)');
             } else if (progress === 100) {
                 addCompletionAnimation();
                 addPulseEffect('.step-dot:nth-child(4)');
             }
         }
         
         // Add pulse effect to specific elements
         function addPulseEffect(selector) {
             const element = document.querySelector(selector);
             if (element) {
                 element.style.animation = 'stepComplete 0.6s ease-out';
                 setTimeout(() => {
                     element.style.animation = '';
                 }, 600);
             }
         }
         
         // Add sparkle effect for mid-progress
         function addSparkleEffect() {
             const splashContent = document.querySelector('.splash-content');
             if (splashContent) {
                 const sparkle = document.createElement('div');
                 sparkle.className = 'sparkle-effect';
                 sparkle.innerHTML = '✨';
                 sparkle.style.cssText = `
                     position: absolute;
                     top: 40%;
                     right: 20%;
                     font-size: 1.5rem;
                     animation: sparkleFloat 1s ease-out forwards;
                 `;
                 splashContent.appendChild(sparkle);
                 
                 setTimeout(() => {
                     sparkle.remove();
                 }, 1000);
             }
         }
         
         // Add completion animation
         function addCompletionAnimation() {
             const logoSvg = document.querySelector('.logo-svg');
             if (logoSvg) {
                 logoSvg.style.animation = 'logoComplete 0.8s ease-out forwards';
             }
         }
         
         function hideSplashScreen() {
             console.log('🎬 SPLASH: Hiding splash screen and showing app...');
             
             const splashScreen = document.getElementById('splash-screen');
             const header = document.querySelector('.custom-header');
             const navigation = document.querySelector('.mobile-navigation');
             
             if (splashScreen) {
                 splashScreen.classList.add('fade-out');
                 setTimeout(() => {
                     splashScreen.style.display = 'none';
                 }, 500);
             }
             
             // Fade in main content
             setTimeout(() => {
                 showMainContent();
                 if (header) {
                     header.style.transition = 'opacity 0.3s ease';
                     header.style.opacity = '1';
                 }
                 if (navigation) {
                     navigation.style.transition = 'opacity 0.3s ease';
                     navigation.style.opacity = '1';
                 }
                 
                 // Apply consistent styling after app loads
                 setTimeout(() => {
                     applyConsistentStyling();
                 }, 200);
                 
                 console.log('✅ SPLASH: App fully loaded and styled');
             }, 200);
         }
         
         // Android Hardware Back Button Handler
         function setupAndroidBackButton() {
            console.log('📱 ANDROID: Setting up hardware back button handling...');
            
            // Handle browser history (for Android back button)
            window.addEventListener('popstate', function(event) {
                event.preventDefault();
                console.log('📱 ANDROID: Hardware back button pressed');
                handleAndroidBackNavigation();
            });
            
            // Override browser back behavior
            history.pushState(null, null, location.href);
            window.addEventListener('beforeunload', function() {
                history.pushState(null, null, location.href);
            });
        }
        
        // Handle Android back navigation logic
        function handleAndroidBackNavigation() {
            console.log('📱 ANDROID: Handling back navigation, current view:', currentView);
            console.log('📱 ANDROID: Navigation stack:', navigationStack);
            
            // Check if we're in a product detail page
            const productDetailPage = document.querySelector('.product-detail-page');
            if (productDetailPage && productDetailPage.style.display !== 'none') {
                console.log('📱 ANDROID: Closing product detail page');
                
                // Check navigation stack for proper restoration
                if (navigationStack && navigationStack.length > 0) {
                    const previousPage = navigationStack.pop();
                    console.log('📱 ANDROID: Restoring previous page:', previousPage);
                    
                    if (previousPage.type === 'collection') {
                        // Restore collection page with scroll position
                        restoreCollectionPage();
                        closeProductDetailPage();
                        return;
                                         } else if (previousPage.type === 'homepage-featured') {
                         // Restore homepage featured products section without page refresh
                         closeProductDetailPage();
                         // Safe area preserved with zero body manipulation
                         return;
                    }
                }
                
                // Fallback: just close product detail
                closeProductDetailPage();
                return;
            }
            
            // Check if we're in a collection page
            const collectionPage = document.getElementById('collection-full-page');
            if (collectionPage && collectionPage.classList.contains('active')) {
                console.log('📱 ANDROID: Closing collection page');
                closeCollectionPage();
                return;
            }
            
            // Check navigation stack for proper back navigation
            if (navigationStack && navigationStack.length > 0) {
                console.log('📱 ANDROID: Using navigation stack for back navigation');
                const previousPage = navigationStack.pop();
                
                if (previousPage && previousPage.type === 'collection') {
                    restoreCollectionPage();
                    return;
                                 } else if (previousPage && previousPage.type === 'homepage-featured') {
                     // Use the direct restoration function for featured products
                     returnToHomepageFeaturedProducts(previousPage);
                     // Safe area preserved with zero body manipulation
                     return;
                }
            }
            
            // Default: Go to home page
            console.log('📱 ANDROID: Defaulting to home page');
            showPage('home');
            
            // Prevent actual app exit - push state again
            setTimeout(() => {
                history.pushState(null, null, location.href);
            }, 100);
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 GoEye Store Mobile App Started');
            
            // Show splash screen and setup Android back button
            setupSplashScreen();
            setupAndroidBackButton();
            
            // Using pure CSS solution - no JavaScript header adjustment needed
            console.log('✅ Header spacing handled by CSS !important rules');
            
            // Fixed: Ultra-compact cards + Banners + Working auto-sliding + Single-line layout + Collection controls
            console.log('🔧 COLLECTION CONTROLS: Removed play button ▶ + Added Sort/Filter/View controls + Ultra-compact cards (140px) + Auto-sliding + Status & Actions in single lines + Maximum screen utilization');
            
            // Debug: Check if all required elements exist
            const requiredElements = [
                'home-content',
                'collection-content', 
                'collections-content',
                'account-content',
                'collection-products-grid',
                'products-grid'
            ];
            
            console.log('🔍 DEBUG: Checking required elements on DOM load:');
            requiredElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                console.log(`🔍 DEBUG: Element ${elementId} exists:`, !!element);
                if (element) {
                    console.log(`🔍 DEBUG: Element ${elementId} display style:`, element.style.display);
                }
            });
            
            // Ensure we start on home page with header visible
            currentView = 'home';
            document.body.classList.remove('hide-header');
            
            // Initialize slider first (disabled)
            console.log('🎠 Slider disabled - showing clean layout');
            await loadSliderSettings();
            // Skip slider initialization since it's disabled
            
            // Initialize cart from localStorage
            const shopifyCart = getShopifyCart();
            if (shopifyCart) {
                cart = convertShopifyCartToLocal(shopifyCart);
                updateCartDisplay();
                console.log('🛒 Restored Shopify cart from localStorage');
            } else {
                // Also check for regular cart in localStorage and update display
                const localCart = JSON.parse(localStorage.getItem('cart') || '[]');
                if (localCart.length > 0) {
                    cart = localCart;
                    updateCartDisplay();
                    updateCartCount();
                    console.log('🛒 Restored local cart from localStorage');
                }
            }
            
            // Always ensure cart display is updated
            updateCartDisplay();
            
            // Validate cart on startup
            await validateShopifyCart();
            
            // Load collections and products in parallel
            await Promise.all([
                loadCollections(),
                loadProducts(),
                loadLiveEyeglasses(),
                loadLiveSunglasses()
            ]);
            
            // Initialize sections
            initializeSharkTankSection();
            initializeLooksSection();
            initializeNewDropsSection();
            
            // Initialize collections carousel auto-scroll
            initializeCollectionsCarousel();
            
            // Load header settings for icon colors
            await loadHeaderSettings();
            
            // Start auto-refresh for categories
            autoRefreshCategories();
            
            console.log('✅ App initialization complete');
            
            // Initialize new header functionality
            initializeCustomHeader();
            
            // Initialize advanced header features from liquid template
            initializeAdvancedHeader();
            
            // Initialize category section
            initializeCategorySection();
            
            // Initialize sunglasses category section
            initializeSunglassesCategorySection();
            
            // Initialize Shark Tank section
            initializeSharkTankSection();
        });

        // Custom Header JavaScript Functionality (from Liquid Template)
        function initializeCustomHeader() {
            // Gender tabs functionality
            const genderTabs = document.querySelectorAll('.gender-tab');
            genderTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    genderTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    const gender = this.dataset.gender;
                    console.log('Gender tab clicked:', gender);
                    showToast(`Filtering by: ${gender}`);
                });
            });
            
            console.log('✅ Custom header initialized');
        }

        // Advanced Header Functionality from Liquid Template
        function initializeAdvancedHeader() {
            // Menu drawer functionality
            const genderTabs = document.querySelectorAll('.gender-tab');
            
            // Navigation tabs functionality
            console.log('🎯 Setting up static navigation tab handlers...');
            const navTabs = document.querySelectorAll('.nav-tabs a');
            navTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Remove active class from all tabs
                    navTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    const tabText = this.textContent.trim();
                    console.log('📍 Static navigation tab clicked:', tabText);
                
                // Handle different tab actions
                console.log('🎯 Processing static tab click for:', tabText.toLowerCase());
                
                if (tabText.toLowerCase() === 'classic') {
                    console.log('🎨 Loading Classic Collection page...');
                    loadExternalPage('./pages/classic-collection.html');
                } else if (tabText.toLowerCase() === 'premium') {
                    console.log('💎 Loading Premium Collection page...');
                    loadExternalPage('./pages/premium-collection.html');
                } else if (tabText.toLowerCase() === 'sport') {
                    console.log('🏃 Loading Sport Collection page...');
                    loadExternalPage('./pages/sport-collection.html');
                } else if (tabText.toLowerCase() === 'trendy') {
                    console.log('✨ Loading Trendy Collection page...');
                    loadExternalPage('./pages/trendy-collection.html');
                } else if (tabText.toLowerCase() === 'all') {
                    console.log('🏠 Returning to home view...');
                    closeExternalPage();
                } else {
                    console.log('ℹ️ Tab not implemented yet:', tabText);
                    showToast(`${tabText} collection coming soon!`);
                }
                });
            });

            // Gender tabs in drawer
            genderTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    genderTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    const gender = this.dataset.gender;
                    console.log('Drawer gender tab clicked:', gender);
                    showToast(`Gender filter: ${gender}`);
                });
            });

            // Load trending slides from header settings
            loadTrendingSlides();

            // Cart refresh functionality
            function updateCartIcon(cart) {
                const cartCountBubble = document.querySelector('.cart-count-bubble');
                const cartCount = cart.item_count || 0;
                
                if (cartCount > 0) {
                    cartCountBubble.style.display = 'flex';
                    cartCountBubble.textContent = cartCount < 100 ? cartCount : '99+';
                } else {
                    cartCountBubble.style.display = 'none';
                }
            }

            // Function to fetch cart data
            async function fetchCartData() {
                try {
                    // For demo purposes, we'll use localStorage
                    const localCart = JSON.parse(localStorage.getItem('mobile-cart') || '[]');
                    updateCartIcon({ item_count: localCart.length });
                    return { item_count: localCart.length, items: localCart };
            } catch (error) {
                    console.error('Error fetching cart:', error);
                    return { item_count: 0, items: [] };
                }
            }

            // Listen for cart changes
            document.addEventListener('cart:refresh', function() {
                fetchCartData();
            });

            // Search functionality
            const searchForm = document.querySelector('.custom-header-search form');
            if (searchForm) {
                searchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const searchTerm = this.querySelector('input').value;
                    if (searchTerm.trim()) {
                        console.log('Search for:', searchTerm);
                        showToast(`Searching for: ${searchTerm}`);
                    }
                });
            }

            // Start auto-refresh and focus refresh
            startAutoRefresh();
            setupFocusRefresh();

            // Initial cart fetch
            fetchCartData();
            
            console.log('✅ Advanced header initialized with auto-refresh capabilities');
            
            // Add double-tap to refresh functionality
            let lastTap = 0;
            const trendingTitle = document.querySelector('.trending-title');
            if (trendingTitle) {
                trendingTitle.addEventListener('click', function(e) {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    if (tapLength < 500 && tapLength > 0) {
                        // Double tap detected on header title
                        refreshHeaderSettings();
                        e.preventDefault();
                    }
                    lastTap = currentTime;
                });
            }
        }

        // Load trending slides from header settings with cache busting
        async function loadTrendingSlides() {
            try {
                // Add cache busting parameter to always get fresh data
                const cacheBuster = Date.now();
                const response = await fetch(`${API_BASE}/api/header-settings?t=${cacheBuster}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.trending_slides && data.trending_slides.length > 0) {
                        updateTrendingSlides(data.trending_slides.filter(slide => slide.enabled));
            } else {
                        // Fallback to default slides if none found
                        updateTrendingSlides(getDefaultSlides());
                    }
                    if (data.header) {
                        updateHeaderSettings(data.header);
                    }
                    
                    console.log('🔄 Header settings refreshed from API');
                } else {
                    console.warn('Failed to load trending slides, using defaults');
                    updateTrendingSlides(getDefaultSlides());
                }
            } catch (error) {
                console.error('Error loading trending slides:', error);
                // Fallback to default slides on error
                updateTrendingSlides(getDefaultSlides());
            }
        }

        // Auto-refresh header settings every 15 seconds (OPTIMIZED)
        function startAutoRefresh() {
            setInterval(() => {
                console.log('🔄 Auto-refreshing header settings (style-preserving)...');
                loadTrendingSlides();
                loadHeaderSettings(); // Also refresh navigation and announcement bar
                // REMOVED: Auto-refresh collections and products to prevent styling issues
                // Only refresh data sections that don't affect styling
                loadSharkTankData(true); // Auto-refresh Shark Tank section (silent)
            }, 30000); // Increased to 30 seconds for better performance
        }
        
        // Style-preserving product reload function
        function reloadProductsWithStylePreservation() {
            console.log('🎨 STYLE-PRESERVING: Reloading products while maintaining styles...');
            
            // Store current styling state
            const productCards = document.querySelectorAll('.product-card');
            const currentStyles = Array.from(productCards).map(card => {
                const title = card.querySelector('.product-title');
                const discountBadge = card.querySelector('.discount-badge');
                const currentPrice = card.querySelector('.current-price');
                const originalPrice = card.querySelector('.original-price');
                
                return {
                    element: card,
                    titleStyle: title ? title.style.cssText : '',
                    badgeStyle: discountBadge ? discountBadge.style.cssText : '',
                    currentPriceStyle: currentPrice ? currentPrice.style.cssText : '',
                    originalPriceStyle: originalPrice ? originalPrice.style.cssText : ''
                };
            });
            
            // Reload products
            loadProducts(0).then(() => {
                // Wait for DOM to update then restore styles
                setTimeout(() => {
                    console.log('🎨 STYLE-PRESERVING: Restoring consistent styling...');
                    applyConsistentStyling();
                                 }, 100);
             });
         }
        
         // Global function to apply consistent styling (prevents bolding issues)
         function applyConsistentStyling() {
             console.log('🎨 APPLYING: Global consistent styling...');
             
             // Fix all product titles
             const productTitles = document.querySelectorAll('.product-title');
             productTitles.forEach(title => {
                 title.style.fontWeight = 'normal';
                 title.style.fontSize = '1rem';
             });
             
             // Fix all discount badges to red styling
             const discountBadges = document.querySelectorAll('.discount-badge');
             discountBadges.forEach(badge => {
                 badge.style.background = '#fef2f2';
                 badge.style.color = '#dc2626';
                 badge.style.fontWeight = '600';
                 badge.style.fontSize = '0.8rem';
                 badge.style.padding = '2px 6px';
                 badge.style.borderRadius = '4px';
                 badge.style.backgroundImage = 'none';
                 badge.style.boxShadow = 'none';
                 badge.style.textTransform = 'none';
                 badge.style.letterSpacing = 'normal';
             });
             
             // Fix all current prices to blue
             const currentPrices = document.querySelectorAll('.current-price');
             currentPrices.forEach(price => {
                 price.style.color = '#2563eb';
                 price.style.fontWeight = '600';
                 price.style.fontSize = '1.1rem';
             });
             
             // Fix all original prices to gray crossed-out
             const originalPrices = document.querySelectorAll('.original-price');
             originalPrices.forEach(price => {
                 price.style.color = '#6b7280';
                 price.style.textDecoration = 'line-through';
                 price.style.opacity = '0.7';
                 price.style.fontSize = '0.9rem';
             });
             
             console.log('🎨 APPLIED: Consistent styling to', {
                 titles: productTitles.length,
                 discountBadges: discountBadges.length,
                 currentPrices: currentPrices.length,
                 originalPrices: originalPrices.length
             });
        }

        // Refresh when app comes back into focus
        function setupFocusRefresh() {
            let isHidden = false;
            
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    isHidden = true;
                } else if (isHidden) {
                    // App came back into focus, refresh settings
                    console.log('🔄 App focus restored, refreshing all data...');
                    loadTrendingSlides();
                    loadHeaderSettings(); // Also refresh navigation and announcement bar
                    loadCollections(0); // Refresh collections
                    loadProducts(0); // Refresh products
                    loadSharkTankData(true); // Refresh Shark Tank section (silent)
                    loadLooksData(true); // Refresh Looks section (silent)
                loadNewDropsData(true); // Refresh New Drops section (silent)
                    isHidden = false;
                }
            });
        }

        // Manual refresh function (you can trigger this with a gesture)
        function refreshHeaderSettings() {
            console.log('🔄 Manual refresh triggered');
            loadTrendingSlides();
            loadHeaderSettings(); // Also refresh navigation and announcement bar
            loadSharkTankData(true); // Refresh Shark Tank section (silent)
            loadLooksData(true); // Refresh Looks section (silent)
            loadNewDropsData(true); // Refresh New Drops section (silent)
            loadCollections(0); // Refresh collections
            loadProducts(0); // Refresh products
        }

        // Default slides as fallback
        function getDefaultSlides() {
            return [
                {
                    id: "1",
                    title: "Premium Eyeglasses",
                    image_url: "https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=440&h=540&fit=crop&crop=center&q=80",
                    link_url: "/collections/eyeglasses",
                    enabled: true,
                    order: 1,
                },
                {
                    id: "2",
                    title: "Blue Light Blockers",
                    image_url: "https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=440&h=540&fit=crop&crop=center&q=80",
                    link_url: "/collections/blue-light",
                    enabled: true,
                    order: 2,
                },
                {
                    id: "3",
                    title: "Designer Sunglasses",
                    image_url: "https://images.unsplash.com/photo-1556306535-38febf6782e7?w=440&h=540&fit=crop&crop=center&q=80",
                    link_url: "/collections/sunglasses",
                    enabled: true,
                    order: 3,
                },
                {
                    id: "4",
                    title: "Reading Glasses",
                    image_url: "https://images.unsplash.com/photo-1508296695146-257a814070b4?w=440&h=540&fit=crop&crop=center&q=80",
                    link_url: "/collections/reading",
                    enabled: true,
                    order: 4,
                },
                {
                    id: "5",
                    title: "Sports Eyewear",
                    image_url: "https://images.unsplash.com/photo-1583394838336-acd977736f90?w=440&h=540&fit=crop&crop=center&q=80",
                    link_url: "/collections/sports",
                    enabled: true,
                    order: 5,
                },
            ];
        }

        // Extract collection handle from URL (e.g., "/collections/glam" → "glam")
        function extractCollectionFromUrl(url) {
            console.log('🔗 Extracting collection from URL:', url);
            
            if (!url) return null;
            
            // Handle different URL formats
            const patterns = [
                /\/collections\/([^\/\?#]+)/i,  // /collections/handle
                /collections\/([^\/\?#]+)/i,   // collections/handle
                /\/([^\/\?#]+)$/i              // /handle (as fallback)
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    const handle = match[1].toLowerCase();
                    console.log('✅ Extracted collection handle:', handle);
                    return handle;
                }
            }
            
            console.log('❌ Could not extract collection handle from URL:', url);
            return null;
        }

        // Map trending slide titles to collection handles
        function mapSlideToCollection(slideTitle) {
            console.log('🗺️ Mapping slide title to collection:', slideTitle);
            
            // Common collection mappings
            const mappings = {
                // Exact title matches
                'sunglasses': 'sunglasses',
                'eyeglasses': 'eyeglasses', 
                'frames': 'frames',
                'glasses': 'glasses',
                'prescription': 'prescription-glasses',
                'reading': 'reading-glasses',
                'computer': 'computer-glasses',
                'blue light': 'blue-light-glasses',
                'vintage': 'vintage-frames',
                'modern': 'modern-frames',
                'classic': 'classic-frames',
                'premium': 'premium-collection',
                'collection': 'all-products',
                'trending': 'trending-now',
                'new arrival': 'new-arrivals',
                'best seller': 'best-sellers',
                'men': 'mens-eyewear',
                'women': 'womens-eyewear',
                'kids': 'kids-eyewear',
                'sports': 'sports-eyewear',
                'fashion': 'fashion-eyewear'
            };
            
            const lowerTitle = slideTitle.toLowerCase();
            
            // Check for exact matches first
            if (mappings[lowerTitle]) {
                console.log('✅ Found exact mapping:', mappings[lowerTitle]);
                return mappings[lowerTitle];
            }
            
            // Check for partial matches
            for (const [key, value] of Object.entries(mappings)) {
                if (lowerTitle.includes(key) || key.includes(lowerTitle)) {
                    console.log('✅ Found partial mapping:', value);
                    return value;
                }
            }
            
            console.log('❌ No mapping found for:', slideTitle);
            return null;
        }

        // Update trending slides in the UI
        function updateTrendingSlides(slides) {
            const trendingContainer = document.querySelector('.trending-items');
            if (!trendingContainer || slides.length === 0) return;

            trendingContainer.innerHTML = '';

            slides.sort((a, b) => a.order - b.order).forEach(slide => {
                const slideElement = document.createElement('div');
                slideElement.className = 'trending-item';
                slideElement.innerHTML = `
                    <img 
                        src="${slide.image_url}" 
                        alt="${slide.title}"
                        loading="lazy"
                        width="220"
                        height="270"
                        onerror="this.src='https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=440&h=540&fit=crop&q=80'"
                    >
                    <h3 class="trending-item-title">${slide.title}</h3>
                `;

                // Add click handler to open collection
                slideElement.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    console.log('🎯 Trending slide clicked:', slide.title);
                    
                    let collectionHandle = null;
                    
                    // First priority: Use Link URL from admin if available
                    if (slide.link_url && slide.link_url.includes('/collections/')) {
                        collectionHandle = extractCollectionFromUrl(slide.link_url);
                        console.log('✅ Using admin Link URL:', slide.link_url, '→', collectionHandle);
                    }
                    
                    // Second priority: Map slide title to collection
                    if (!collectionHandle) {
                        collectionHandle = mapSlideToCollection(slide.title);
                        console.log('🗺️ Using title mapping:', slide.title, '→', collectionHandle);
                    }
                    
                    // Third priority: Generate handle from title
                    if (!collectionHandle) {
                        collectionHandle = slide.title.toLowerCase()
                            .replace(/[^a-z0-9\s]/g, '')
                            .replace(/\s+/g, '-');
                        console.log('🔄 Using fallback handle:', collectionHandle);
                    }
                    
                    if (collectionHandle) {
                        console.log('📱 Opening collection:', collectionHandle);
                        showCollection(collectionHandle);
                    } else {
                        console.error('❌ Could not determine collection handle for slide:', slide.title);
                    }
                });

                trendingContainer.appendChild(slideElement);
            });
        }

        // Update header settings
        function updateHeaderSettings(settings) {
            // Update trending title and subtitle
            const trendingTitle = document.querySelector('.trending-title');
            if (trendingTitle && settings.trending_title && settings.trending_subtitle) {
                trendingTitle.innerHTML = `${settings.trending_title} <span>${settings.trending_subtitle}</span>`;
            }

            // Update logo if provided
            const logo = document.querySelector('.custom-header-logo img');
            if (logo && settings.logo_url) {
                logo.src = settings.logo_url;
            }

            // Update offer button
            const offerButton = document.querySelector('.offer-button span');
            if (offerButton && settings.offer_button_text) {
                offerButton.textContent = settings.offer_button_text;
            }

            const offerButtonLink = document.querySelector('.offer-button');
            if (offerButtonLink && settings.offer_button_link) {
                offerButtonLink.href = settings.offer_button_link;
            }

            if (offerButtonLink && !settings.enable_offer_button) {
                offerButtonLink.style.display = 'none';
            }

            // Apply color settings from Colors & Design tab
            const headerElement = document.querySelector('.custom-header');
            if (headerElement && settings) {
                // Apply CSS custom properties for colors
                if (settings.header_background_color) {
                    headerElement.style.setProperty('--header-background-color', settings.header_background_color);
                    headerElement.style.backgroundColor = settings.header_background_color;
                }
                
                if (settings.nav_text_color) {
                    headerElement.style.setProperty('--nav-text-color', settings.nav_text_color);
                }
                
                if (settings.nav_active_color) {
                    headerElement.style.setProperty('--nav-active-color', settings.nav_active_color);
                }

                console.log('🎨 Applied color settings:', {
                    background: settings.header_background_color,
                    navText: settings.nav_text_color,
                    navActive: settings.nav_active_color
                });
            }

            // Apply colors to specific elements for immediate effect
            if (settings.header_background_color) {
                const headerWrapper = document.querySelector('.custom-header-wrapper');
                const trendingSection = document.querySelector('.trending-section');
                
                if (headerWrapper) {
                    headerWrapper.style.backgroundColor = settings.header_background_color;
                }
                
                // Update navigation background
                const navTabs = document.querySelector('.nav-tabs');
                if (navTabs && settings.header_background_color) {
                    navTabs.style.backgroundColor = settings.header_background_color;
                }
            }

            // Update navigation text colors
            if (settings.nav_text_color) {
                const navLinks = document.querySelectorAll('.nav-tabs a');
                navLinks.forEach(link => {
                    if (!link.classList.contains('active')) {
                        link.style.color = settings.nav_text_color;
                    }
                });
            }

            // Update active navigation color
            if (settings.nav_active_color) {
                const activeNavLinks = document.querySelectorAll('.nav-tabs a.active');
                activeNavLinks.forEach(link => {
                    link.style.color = settings.nav_active_color;
                });
            }

            console.log('✅ Header settings and colors updated from admin interface');
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('App error:', e.error);
        });

        // Prevent zoom on double tap (iOS Safari)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Service Worker Registration (optional, for offline support)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Uncomment when you have a service worker file
                // navigator.serviceWorker.register('/sw.js')
                //     .then(registration => console.log('SW registered'))
                //     .catch(error => console.log('SW registration failed'));
            });
        }

        console.log('📱 GoEye Store Mobile App - All scripts loaded');
        
        // Load header settings on page load
        loadHeaderSettings();
        
        // Load collections and products on page load
        loadCollections(0);
        loadProducts(0);
        
        // Initialize sale banner system
        initializeSaleBannerSystem();
        
        // Start auto-refresh system
        startAutoRefresh();
        setupFocusRefresh();
        
        // Handle product link clicks
        function handleProductClick(productId, linkType, link, brand, price, image, offer) {
            console.log('🔍 Product clicked:', { productId, linkType, link, brand });
            
            // Prevent default action
            event.preventDefault();
            
            if (linkType === 'none' || !link) {
                // Show product details modal
                showProductModal(productId, brand, price, image, offer);
            } else if (linkType === 'product') {
                // Navigate to another product
                console.log('🔗 Navigating to product:', link);
                // You can implement product navigation here
                showToast(`Navigating to product: ${link}`);
            } else if (linkType === 'collection') {
                // Navigate to collection
                console.log('🔗 Navigating to collection:', link);
                // You can implement collection navigation here
                showToast(`Navigating to collection: ${link}`);
            } else if (linkType === 'external') {
                // Open external link
                console.log('🔗 Opening external link:', link);
                if (link.startsWith('http://') || link.startsWith('https://')) {
                    window.open(link, '_blank');
                } else {
                    showToast('Invalid external link');
                }
            }
        }
        
        // Show product details modal
        function showProductModal(productId, brand, price, image, offer) {
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'product-modal';
            modal.innerHTML = `
                <div class="product-modal-overlay" onclick="closeProductModal()"></div>
                <div class="product-modal-content">
                    <div class="product-modal-header">
                        <h2>${brand}</h2>
                        <button class="close-button" onclick="closeProductModal()">×</button>
                    </div>
                    <div class="product-modal-body">
                        <div class="product-modal-image">
                            <img src="${image || 'https://images.unsplash.com/photo-1574258495973-f010dfbb5371?w=300&h=300&fit=crop'}" alt="${brand}">
                        </div>
                        <div class="product-modal-info">
                            <h3>${brand}</h3>
                            <p class="product-modal-price">₹${price}</p>
                            <p class="product-modal-offer">${offer || 'Free shipping'}</p>
                            <button class="add-to-cart-btn" onclick="addToCart('${productId}', '${brand}', '${price}', '${image}')">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Add styles
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            document.body.appendChild(modal);
        }
        
        // Close product modal
        function closeProductModal() {
            const modal = document.querySelector('.product-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Add to cart functionality
        function addToCart(productId, brand, price, image) {
            console.log('🛒 [Regular Cart] Adding to cart:', { productId, brand, price });
            
            // Get existing cart or create new one
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            
            // Check if product already exists in cart
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
                console.log('🔄 Updated existing item quantity:', existingItem.quantity);
            } else {
                cart.push({
                    id: productId,
                    brand: brand,
                    price: price,
                    image: image,
                    quantity: 1
                });
                console.log('➕ Added new item to cart');
            }
            
            // Save to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            console.log('💾 Saved to localStorage[cart]:', cart);
            
            // Update cart display immediately
            updateCartDisplay();
            updateCartCount();
            
            // Show success message
            showToast(`${brand} added to cart!`);
            
            // Close modal
            closeProductModal();
        }
        
        // Show toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 12px 24px;
                border-radius: 6px;
                z-index: 1001;
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            
            document.body.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 100);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
        
        console.log('🔄 Auto-refresh system activated for navigation, announcement bar, collections and products');

        // ====================
        // SALE BANNER SYSTEM - REBUILT FROM SCRATCH  
        // ====================
        
        // Global banner data storage
        window.saleBannerData = {
            eyeglasses: null,
            sunglasses: null
        };
        
        // Create sale banner HTML element
        function createSaleBannerElement(bannerData, sectionType = 'eyeglasses') {
            if (!bannerData || !bannerData.enabled || !bannerData.line1 || !bannerData.line2) {
                console.log('❌ Banner data invalid or disabled:', bannerData);
                return null;
            }
            
            console.log('✅ Creating sale banner element:', bannerData);
            
            const bannerElement = document.createElement('div');
            bannerElement.className = 'sale-banner-new';
            bannerElement.setAttribute('data-section', sectionType);
            
            bannerElement.style.cssText = `
                background-color: ${bannerData.backgroundColor || '#000000'};
                color: white;
                text-align: center;
                padding: 16px 20px;
                margin: 0 0 20px 0;
                width: 100%;
                font-family: Arial, sans-serif;
                font-weight: bold;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
                display: block;
                z-index: 10;
            `;
            
            bannerElement.innerHTML = `
                <div style="font-size: 14px; margin-bottom: 4px; letter-spacing: 0.5px;">
                    ${bannerData.line1}
                </div>
                <div style="font-size: 22px; font-weight: 900; letter-spacing: 1px; text-transform: uppercase;">
                    ${bannerData.line2}
                </div>
            `;
            
            return bannerElement;
        }
        
        // Show banner in drawer when category is opened
        function showBannerInDrawer(categoryType, sectionType = 'eyeglasses') {
            console.log(`🎯 Showing banner in drawer for ${categoryType} (${sectionType})`);
            
            const bannerData = window.saleBannerData[sectionType];
            if (!bannerData || !bannerData.enabled) {
                console.log('❌ No banner data available for section:', sectionType);
                return;
            }
            
            // Find the drawer content area
            const drawer = sectionType === 'eyeglasses' 
                ? document.querySelector('#category-drawer')
                : document.querySelector('#sunglasses-category-drawer');
            const drawerContent = drawer?.querySelector('.drawer-content');
            
            if (!drawerContent) {
                console.log('❌ Drawer content not found');
                return;
            }
            
            // Remove any existing banners
            const existingBanners = drawerContent.querySelectorAll('.sale-banner-new');
            existingBanners.forEach(banner => banner.remove());
            
            // Create and insert the banner at the top of drawer content
            const bannerElement = createSaleBannerElement(bannerData, sectionType);
            if (bannerElement) {
                drawerContent.insertBefore(bannerElement, drawerContent.firstChild);
                console.log('✅ Banner added to drawer:', categoryType);
            }
        }
        
        // Load banner data from API
        async function loadSaleBannerData() {
            console.log('🔄 Loading sale banner data from APIs...');
            
            try {
                // Load eyeglasses banner data
                const eyeglassesResponse = await fetch(`${API_BASE}/api/live-eyeglasses`);
                if (eyeglassesResponse.ok) {
                    const eyeglassesData = await eyeglassesResponse.json();
                    if (eyeglassesData.success && eyeglassesData.saleBanner) {
                        // Parse if it's a JSON string
                        const bannerData = typeof eyeglassesData.saleBanner === 'string' 
                            ? JSON.parse(eyeglassesData.saleBanner) 
                            : eyeglassesData.saleBanner;
                        
                        window.saleBannerData.eyeglasses = bannerData;
                        console.log('✅ Eyeglasses banner data loaded:', bannerData);
                    }
                }
                
                // Load sunglasses banner data
                const sunglassesResponse = await fetch(`${API_BASE}/api/live-sunglasses`);
                if (sunglassesResponse.ok) {
                    const sunglassesData = await sunglassesResponse.json();
                    if (sunglassesData.success && sunglassesData.saleBanner) {
                        // Parse if it's a JSON string
                        const bannerData = typeof sunglassesData.saleBanner === 'string' 
                            ? JSON.parse(sunglassesData.saleBanner) 
                            : sunglassesData.saleBanner;
                            
                        window.saleBannerData.sunglasses = bannerData;
                        console.log('✅ Sunglasses banner data loaded:', bannerData);
                    }
                }
                
                console.log('🎉 Sale banner data loading completed');
                return true;
                
            } catch (error) {
                console.error('❌ Error loading sale banner data:', error);
                return false;
            }
        }
        
        // Initialize sale banner system
        async function initializeSaleBannerSystem() {
            console.log('🚀 Initializing sale banner system...');
            
            // Load banner data from APIs
            const loaded = await loadSaleBannerData();
            if (!loaded) {
                console.log('❌ Failed to load banner data');
                return;
            }
            
            console.log('✅ Sale banner system initialized successfully');
        }

        // New Drops Functions
        async function loadNewDropsData(silent = false) {
            try {
                const response = await fetch(`${API_BASE}/api/live-new-drops`);
                const data = await response.json();
                
                if (data.enabled) {
                    renderNewDropsSection(data);
                    
                    if (!silent) {
                        console.log('New Drops data loaded successfully');
                    }
                } else {
                    hideNewDropsSection();
                }
            } catch (error) {
                console.error('Error loading new drops data:', error);
                if (!silent) {
                    hideNewDropsSection();
                }
            }
        }

        function renderNewDropsSection(data) {
            const section = document.getElementById('new-drops-section');
            const title = document.getElementById('new-drops-title');
            const subtitle = document.getElementById('new-drops-subtitle');
            const slideshow = document.getElementById('banner-slideshow');
            
            if (!section || !title || !subtitle || !slideshow) return;
            
            // Update header
            title.textContent = data.title || 'New Drops';
            subtitle.textContent = data.subtitle || 'Fresh collections every 15 days';
            
            // Show section
            section.style.display = 'block';
            
            // Render slides
            if (data.slides && data.slides.length > 0) {
                let slidesHTML = '';
                let progressHTML = '';
                
                data.slides.forEach((slide, index) => {
                    const isActive = index === 0 ? ' active' : '';
                    const logos = [];
                    
                    // Add logos
                    if (slide.logo_1) {
                        logos.push(`<div class="banner-logo position-${slide.logo_1_position}" style="max-width: ${slide.logo_1_size}px; max-height: ${slide.logo_1_size}px;">
                            <img src="${slide.logo_1}" alt="Logo 1" loading="lazy">
                        </div>`);
                    }
                    if (slide.logo_2) {
                        logos.push(`<div class="banner-logo position-${slide.logo_2_position}" style="max-width: ${slide.logo_2_size}px; max-height: ${slide.logo_2_size}px;">
                            <img src="${slide.logo_2}" alt="Logo 2" loading="lazy">
                        </div>`);
                    }
                    if (slide.logo_3) {
                        logos.push(`<div class="banner-logo position-${slide.logo_3_position}" style="max-width: ${slide.logo_3_size}px; max-height: ${slide.logo_3_size}px;">
                            <img src="${slide.logo_3}" alt="Logo 3" loading="lazy">
                        </div>`);
                    }
                    
                    const logoHTML = logos.length > 0 ? `<div class="logo-container">${logos.join('<div class="logo-divider">|</div>')}</div>` : '';
                    
                    const contentOverlay = (slide.slide_heading || slide.slide_subheading || slide.button_text) ? `
                        <div class="banner-content-overlay">
                            ${slide.slide_heading ? `<h3 class="banner-slide-heading">${slide.slide_heading}</h3>` : ''}
                            ${slide.slide_subheading ? `<p class="banner-slide-subheading">${slide.slide_subheading}</p>` : ''}
                            ${slide.button_text ? `<div class="shop-now-button">${slide.button_text}</div>` : ''}
                        </div>
                    ` : '';
                    
                    slidesHTML += `
                        <a href="${slide.slide_link || '#'}" class="banner-slide${isActive}">
                            <div class="banner-image-container">
                                ${logoHTML}
                                ${contentOverlay}
                                <img src="${slide.slide_image || slide.slide_link}" 
                                     alt="${slide.slide_heading || 'New Drop'}" 
                                     loading="${index === 0 ? 'eager' : 'lazy'}" 
                                     class="banner-image">
                            </div>
                        </a>
                    `;
                    
                    progressHTML += `<div class="progress-dash${isActive}" data-index="${index}"></div>`;
                });
                
                slideshow.innerHTML = `
                    ${slidesHTML}
                    <div class="banner-progress-container">
                        ${progressHTML}
                    </div>
                `;
                
                // Initialize slideshow
                initializeNewDropsSlideshow(data.slide_interval || 3);
            }
        }

        function hideNewDropsSection() {
            const section = document.getElementById('new-drops-section');
            if (section) {
                section.style.display = 'none';
            }
        }

        function initializeNewDropsSlideshow(intervalSeconds) {
            const slideshow = document.getElementById('banner-slideshow');
            if (!slideshow) return;

            const slides = slideshow.querySelectorAll('.banner-slide');
            const progressDashes = slideshow.querySelectorAll('.progress-dash');
            
            if (slides.length <= 1) return;

            let currentIndex = 0;
            const intervalDuration = intervalSeconds * 1000;

            function showSlide(index) {
                currentIndex = (index + slides.length) % slides.length;

                slides.forEach((slide, i) => {
                    if (i === currentIndex) {
                        slide.classList.add('active');
                    } else {
                        slide.classList.remove('active');
                    }
                });

                progressDashes.forEach((dash, i) => {
                    if (i === currentIndex) {
                        dash.classList.add('active');
                    } else {
                        dash.classList.remove('active');
                    }
                });
            }

            function startSlideshow() {
                showSlide(currentIndex);
                return setInterval(() => {
                    showSlide(currentIndex + 1);
                }, intervalDuration);
            }

            let slideInterval = startSlideshow();

            // Handle visibility change
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    clearInterval(slideInterval);
                } else {
                    slideInterval = startSlideshow();
                }
            });
        }

        async function initializeNewDropsSection() {
            await loadNewDropsData();
        }

    </script>
</body>
</html> 